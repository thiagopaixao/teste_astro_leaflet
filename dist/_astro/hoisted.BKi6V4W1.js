import{c as ye,L as Le}from"./leaflet-src.C0hSXGgz.js";(()=>{var W=Object.create,ft=Object.defineProperty,Rt=Object.getOwnPropertyDescriptor,Lt=Object.getOwnPropertyNames,vt=Object.getPrototypeOf,Ot=Object.prototype.hasOwnProperty,S=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ji=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Lt(e))!Ot.call(t,n)&&n!==i&&ft(t,n,{get:()=>e[n],enumerable:!(r=Rt(e,n))||r.enumerable});return t},_t=(t,e,i)=>(i=t!=null?W(vt(t)):{},Ji(e||!t||!t.__esModule?ft(i,"default",{value:t,enumerable:!0}):i,t)),Xi=S((t,e)=>{function i(){this.__data__=[],this.size=0}e.exports=i}),Yt=S((t,e)=>{function i(r,n){return r===n||r!==r&&n!==n}e.exports=i}),$t=S((t,e)=>{var i=Yt();function r(n,a){for(var s=n.length;s--;)if(i(n[s][0],a))return s;return-1}e.exports=r}),Yi=S((t,e)=>{var i=$t(),r=Array.prototype,n=r.splice;function a(s){var o=this.__data__,u=i(o,s);if(u<0)return!1;var h=o.length-1;return u==h?o.pop():n.call(o,u,1),--this.size,!0}e.exports=a}),$i=S((t,e)=>{var i=$t();function r(n){var a=this.__data__,s=i(a,n);return s<0?void 0:a[s][1]}e.exports=r}),Zi=S((t,e)=>{var i=$t();function r(n){return i(this.__data__,n)>-1}e.exports=r}),Wi=S((t,e)=>{var i=$t();function r(n,a){var s=this.__data__,o=i(s,n);return o<0?(++this.size,s.push([n,a])):s[o][1]=a,this}e.exports=r}),Zt=S((t,e)=>{var i=Xi(),r=Yi(),n=$i(),a=Zi(),s=Wi();function o(u){var h=-1,y=u==null?0:u.length;for(this.clear();++h<y;){var _=u[h];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,e.exports=o}),Qi=S((t,e)=>{var i=Zt();function r(){this.__data__=new i,this.size=0}e.exports=r}),tr=S((t,e)=>{function i(r){var n=this.__data__,a=n.delete(r);return this.size=n.size,a}e.exports=i}),er=S((t,e)=>{function i(r){return this.__data__.get(r)}e.exports=i}),ir=S((t,e)=>{function i(r){return this.__data__.has(r)}e.exports=i}),$e=S((t,e)=>{var i=typeof ye=="object"&&ye&&ye.Object===Object&&ye;e.exports=i}),Dt=S((t,e)=>{var i=$e(),r=typeof self=="object"&&self&&self.Object===Object&&self,n=i||r||Function("return this")();e.exports=n}),ke=S((t,e)=>{var i=Dt(),r=i.Symbol;e.exports=r}),rr=S((t,e)=>{var i=ke(),r=Object.prototype,n=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;function o(u){var h=n.call(u,s),y=u[s];try{u[s]=void 0;var _=!0}catch{}var w=a.call(u);return _&&(h?u[s]=y:delete u[s]),w}e.exports=o}),nr=S((t,e)=>{var i=Object.prototype,r=i.toString;function n(a){return r.call(a)}e.exports=n}),It=S((t,e)=>{var i=ke(),r=rr(),n=nr(),a="[object Null]",s="[object Undefined]",o=i?i.toStringTag:void 0;function u(h){return h==null?h===void 0?s:a:o&&o in Object(h)?r(h):n(h)}e.exports=u}),Et=S((t,e)=>{function i(r){var n=typeof r;return r!=null&&(n=="object"||n=="function")}e.exports=i}),Me=S((t,e)=>{var i=It(),r=Et(),n="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",o="[object Proxy]";function u(h){if(!r(h))return!1;var y=i(h);return y==a||y==s||y==n||y==o}e.exports=u}),ar=S((t,e)=>{var i=Dt(),r=i["__core-js_shared__"];e.exports=r}),sr=S((t,e)=>{var i=ar(),r=function(){var a=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function n(a){return!!r&&r in a}e.exports=n}),or=S((t,e)=>{var i=Function.prototype,r=i.toString;function n(a){if(a!=null){try{return r.call(a)}catch{}try{return a+""}catch{}}return""}e.exports=n}),ur=S((t,e)=>{var i=Me(),r=sr(),n=Et(),a=or(),s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,u=Function.prototype,h=Object.prototype,y=u.toString,_=h.hasOwnProperty,w=RegExp("^"+y.call(_).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(T){if(!n(T)||r(T))return!1;var R=i(T)?w:o;return R.test(a(T))}e.exports=A}),lr=S((t,e)=>{function i(r,n){return r?.[n]}e.exports=i}),Ee=S((t,e)=>{var i=ur(),r=lr();function n(a,s){var o=r(a,s);return i(o)?o:void 0}e.exports=n}),Ze=S((t,e)=>{var i=Ee(),r=Dt(),n=i(r,"Map");e.exports=n}),Wt=S((t,e)=>{var i=Ee(),r=i(Object,"create");e.exports=r}),hr=S((t,e)=>{var i=Wt();function r(){this.__data__=i?i(null):{},this.size=0}e.exports=r}),pr=S((t,e)=>{function i(r){var n=this.has(r)&&delete this.__data__[r];return this.size-=n?1:0,n}e.exports=i}),cr=S((t,e)=>{var i=Wt(),r="__lodash_hash_undefined__",n=Object.prototype,a=n.hasOwnProperty;function s(o){var u=this.__data__;if(i){var h=u[o];return h===r?void 0:h}return a.call(u,o)?u[o]:void 0}e.exports=s}),dr=S((t,e)=>{var i=Wt(),r=Object.prototype,n=r.hasOwnProperty;function a(s){var o=this.__data__;return i?o[s]!==void 0:n.call(o,s)}e.exports=a}),gr=S((t,e)=>{var i=Wt(),r="__lodash_hash_undefined__";function n(a,s){var o=this.__data__;return this.size+=this.has(a)?0:1,o[a]=i&&s===void 0?r:s,this}e.exports=n}),fr=S((t,e)=>{var i=hr(),r=pr(),n=cr(),a=dr(),s=gr();function o(u){var h=-1,y=u==null?0:u.length;for(this.clear();++h<y;){var _=u[h];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,e.exports=o}),_r=S((t,e)=>{var i=fr(),r=Zt(),n=Ze();function a(){this.size=0,this.__data__={hash:new i,map:new(n||r),string:new i}}e.exports=a}),mr=S((t,e)=>{function i(r){var n=typeof r;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?r!=="__proto__":r===null}e.exports=i}),Qt=S((t,e)=>{var i=mr();function r(n,a){var s=n.__data__;return i(a)?s[typeof a=="string"?"string":"hash"]:s.map}e.exports=r}),yr=S((t,e)=>{var i=Qt();function r(n){var a=i(this,n).delete(n);return this.size-=a?1:0,a}e.exports=r}),Lr=S((t,e)=>{var i=Qt();function r(n){return i(this,n).get(n)}e.exports=r}),vr=S((t,e)=>{var i=Qt();function r(n){return i(this,n).has(n)}e.exports=r}),Cr=S((t,e)=>{var i=Qt();function r(n,a){var s=i(this,n),o=s.size;return s.set(n,a),this.size+=s.size==o?0:1,this}e.exports=r}),We=S((t,e)=>{var i=_r(),r=yr(),n=Lr(),a=vr(),s=Cr();function o(u){var h=-1,y=u==null?0:u.length;for(this.clear();++h<y;){var _=u[h];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,e.exports=o}),br=S((t,e)=>{var i=Zt(),r=Ze(),n=We(),a=200;function s(o,u){var h=this.__data__;if(h instanceof i){var y=h.__data__;if(!r||y.length<a-1)return y.push([o,u]),this.size=++h.size,this;h=this.__data__=new n(y)}return h.set(o,u),this.size=h.size,this}e.exports=s}),kr=S((t,e)=>{var i=Zt(),r=Qi(),n=tr(),a=er(),s=ir(),o=br();function u(h){var y=this.__data__=new i(h);this.size=y.size}u.prototype.clear=r,u.prototype.delete=n,u.prototype.get=a,u.prototype.has=s,u.prototype.set=o,e.exports=u}),Qe=S((t,e)=>{var i=Ee(),r=function(){try{var n=i(Object,"defineProperty");return n({},"",{}),n}catch{}}();e.exports=r}),Be=S((t,e)=>{var i=Qe();function r(n,a,s){a=="__proto__"&&i?i(n,a,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[a]=s}e.exports=r}),ti=S((t,e)=>{var i=Be(),r=Yt();function n(a,s,o){(o!==void 0&&!r(a[s],o)||o===void 0&&!(s in a))&&i(a,s,o)}e.exports=n}),Mr=S((t,e)=>{function i(r){return function(n,a,s){for(var o=-1,u=Object(n),h=s(n),y=h.length;y--;){var _=h[r?y:++o];if(a(u[_],_,u)===!1)break}return n}}e.exports=i}),Er=S((t,e)=>{var i=Mr(),r=i();e.exports=r}),Br=S((t,e)=>{var i=Dt(),r=typeof t=="object"&&t&&!t.nodeType&&t,n=r&&typeof e=="object"&&e&&!e.nodeType&&e,a=n&&n.exports===r,s=a?i.Buffer:void 0,o=s?s.allocUnsafe:void 0;function u(h,y){if(y)return h.slice();var _=h.length,w=o?o(_):new h.constructor(_);return h.copy(w),w}e.exports=u}),xr=S((t,e)=>{var i=Dt(),r=i.Uint8Array;e.exports=r}),wr=S((t,e)=>{var i=xr();function r(n){var a=new n.constructor(n.byteLength);return new i(a).set(new i(n)),a}e.exports=r}),Dr=S((t,e)=>{var i=wr();function r(n,a){var s=a?i(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.length)}e.exports=r}),Pr=S((t,e)=>{function i(r,n){var a=-1,s=r.length;for(n||(n=Array(s));++a<s;)n[a]=r[a];return n}e.exports=i}),Ar=S((t,e)=>{var i=Et(),r=Object.create,n=function(){function a(){}return function(s){if(!i(s))return{};if(r)return r(s);a.prototype=s;var o=new a;return a.prototype=void 0,o}}();e.exports=n}),Sr=S((t,e)=>{function i(r,n){return function(a){return r(n(a))}}e.exports=i}),ei=S((t,e)=>{var i=Sr(),r=i(Object.getPrototypeOf,Object);e.exports=r}),ii=S((t,e)=>{var i=Object.prototype;function r(n){var a=n&&n.constructor,s=typeof a=="function"&&a.prototype||i;return n===s}e.exports=r}),Fr=S((t,e)=>{var i=Ar(),r=ei(),n=ii();function a(s){return typeof s.constructor=="function"&&!n(s)?i(r(s)):{}}e.exports=a}),Pt=S((t,e)=>{function i(r){return r!=null&&typeof r=="object"}e.exports=i}),Tr=S((t,e)=>{var i=It(),r=Pt(),n="[object Arguments]";function a(s){return r(s)&&i(s)==n}e.exports=a}),ri=S((t,e)=>{var i=Tr(),r=Pt(),n=Object.prototype,a=n.hasOwnProperty,s=n.propertyIsEnumerable,o=i(function(){return arguments}())?i:function(u){return r(u)&&a.call(u,"callee")&&!s.call(u,"callee")};e.exports=o}),Gt=S((t,e)=>{var i=Array.isArray;e.exports=i}),ni=S((t,e)=>{var i=9007199254740991;function r(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=i}e.exports=r}),xe=S((t,e)=>{var i=Me(),r=ni();function n(a){return a!=null&&r(a.length)&&!i(a)}e.exports=n}),Rr=S((t,e)=>{var i=xe(),r=Pt();function n(a){return r(a)&&i(a)}e.exports=n}),Or=S((t,e)=>{function i(){return!1}e.exports=i}),ai=S((t,e)=>{var i=Dt(),r=Or(),n=typeof t=="object"&&t&&!t.nodeType&&t,a=n&&typeof e=="object"&&e&&!e.nodeType&&e,s=a&&a.exports===n,o=s?i.Buffer:void 0,u=o?o.isBuffer:void 0,h=u||r;e.exports=h}),Ir=S((t,e)=>{var i=It(),r=ei(),n=Pt(),a="[object Object]",s=Function.prototype,o=Object.prototype,u=s.toString,h=o.hasOwnProperty,y=u.call(Object);function _(w){if(!n(w)||i(w)!=a)return!1;var A=r(w);if(A===null)return!0;var T=h.call(A,"constructor")&&A.constructor;return typeof T=="function"&&T instanceof T&&u.call(T)==y}e.exports=_}),Gr=S((t,e)=>{var i=It(),r=ni(),n=Pt(),a="[object Arguments]",s="[object Array]",o="[object Boolean]",u="[object Date]",h="[object Error]",y="[object Function]",_="[object Map]",w="[object Number]",A="[object Object]",T="[object RegExp]",R="[object Set]",I="[object String]",z="[object WeakMap]",m="[object ArrayBuffer]",v="[object DataView]",M="[object Float32Array]",P="[object Float64Array]",E="[object Int8Array]",D="[object Int16Array]",l="[object Int32Array]",p="[object Uint8Array]",d="[object Uint8ClampedArray]",c="[object Uint16Array]",g="[object Uint32Array]",f={};f[M]=f[P]=f[E]=f[D]=f[l]=f[p]=f[d]=f[c]=f[g]=!0,f[a]=f[s]=f[m]=f[o]=f[v]=f[u]=f[h]=f[y]=f[_]=f[w]=f[A]=f[T]=f[R]=f[I]=f[z]=!1;function b(C){return n(C)&&r(C.length)&&!!f[i(C)]}e.exports=b}),jr=S((t,e)=>{function i(r){return function(n){return r(n)}}e.exports=i}),Nr=S((t,e)=>{var i=$e(),r=typeof t=="object"&&t&&!t.nodeType&&t,n=r&&typeof e=="object"&&e&&!e.nodeType&&e,a=n&&n.exports===r,s=a&&i.process,o=function(){try{var u=n&&n.require&&n.require("util").types;return u||s&&s.binding&&s.binding("util")}catch{}}();e.exports=o}),si=S((t,e)=>{var i=Gr(),r=jr(),n=Nr(),a=n&&n.isTypedArray,s=a?r(a):i;e.exports=s}),oi=S((t,e)=>{function i(r,n){if(!(n==="constructor"&&typeof r[n]=="function")&&n!="__proto__")return r[n]}e.exports=i}),zr=S((t,e)=>{var i=Be(),r=Yt(),n=Object.prototype,a=n.hasOwnProperty;function s(o,u,h){var y=o[u];(!(a.call(o,u)&&r(y,h))||h===void 0&&!(u in o))&&i(o,u,h)}e.exports=s}),Ur=S((t,e)=>{var i=zr(),r=Be();function n(a,s,o,u){var h=!o;o||(o={});for(var y=-1,_=s.length;++y<_;){var w=s[y],A=u?u(o[w],a[w],w,o,a):void 0;A===void 0&&(A=a[w]),h?r(o,w,A):i(o,w,A)}return o}e.exports=n}),Vr=S((t,e)=>{function i(r,n){for(var a=-1,s=Array(r);++a<r;)s[a]=n(a);return s}e.exports=i}),ui=S((t,e)=>{var i=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function n(a,s){var o=typeof a;return s=s??i,!!s&&(o=="number"||o!="symbol"&&r.test(a))&&a>-1&&a%1==0&&a<s}e.exports=n}),Kr=S((t,e)=>{var i=Vr(),r=ri(),n=Gt(),a=ai(),s=ui(),o=si(),u=Object.prototype,h=u.hasOwnProperty;function y(_,w){var A=n(_),T=!A&&r(_),R=!A&&!T&&a(_),I=!A&&!T&&!R&&o(_),z=A||T||R||I,m=z?i(_.length,String):[],v=m.length;for(var M in _)(w||h.call(_,M))&&!(z&&(M=="length"||R&&(M=="offset"||M=="parent")||I&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||s(M,v)))&&m.push(M);return m}e.exports=y}),qr=S((t,e)=>{function i(r){var n=[];if(r!=null)for(var a in Object(r))n.push(a);return n}e.exports=i}),Hr=S((t,e)=>{var i=Et(),r=ii(),n=qr(),a=Object.prototype,s=a.hasOwnProperty;function o(u){if(!i(u))return n(u);var h=r(u),y=[];for(var _ in u)_=="constructor"&&(h||!s.call(u,_))||y.push(_);return y}e.exports=o}),li=S((t,e)=>{var i=Kr(),r=Hr(),n=xe();function a(s){return n(s)?i(s,!0):r(s)}e.exports=a}),Jr=S((t,e)=>{var i=Ur(),r=li();function n(a){return i(a,r(a))}e.exports=n}),Xr=S((t,e)=>{var i=ti(),r=Br(),n=Dr(),a=Pr(),s=Fr(),o=ri(),u=Gt(),h=Rr(),y=ai(),_=Me(),w=Et(),A=Ir(),T=si(),R=oi(),I=Jr();function z(m,v,M,P,E,D,l){var p=R(m,M),d=R(v,M),c=l.get(d);if(c){i(m,M,c);return}var g=D?D(p,d,M+"",m,v,l):void 0,f=g===void 0;if(f){var b=u(d),C=!b&&y(d),k=!b&&!C&&T(d);g=d,b||C||k?u(p)?g=p:h(p)?g=a(p):C?(f=!1,g=r(d,!0)):k?(f=!1,g=n(d,!0)):g=[]:A(d)||o(d)?(g=p,o(p)?g=I(p):(!w(p)||_(p))&&(g=s(d))):f=!1}f&&(l.set(d,g),E(g,d,P,D,l),l.delete(d)),i(m,M,g)}e.exports=z}),Yr=S((t,e)=>{var i=kr(),r=ti(),n=Er(),a=Xr(),s=Et(),o=li(),u=oi();function h(y,_,w,A,T){y!==_&&n(_,function(R,I){if(T||(T=new i),s(R))a(y,_,I,w,h,A,T);else{var z=A?A(u(y,I),R,I+"",y,_,T):void 0;z===void 0&&(z=R),r(y,I,z)}},o)}e.exports=h}),hi=S((t,e)=>{function i(r){return r}e.exports=i}),$r=S((t,e)=>{function i(r,n,a){switch(a.length){case 0:return r.call(n);case 1:return r.call(n,a[0]);case 2:return r.call(n,a[0],a[1]);case 3:return r.call(n,a[0],a[1],a[2])}return r.apply(n,a)}e.exports=i}),Zr=S((t,e)=>{var i=$r(),r=Math.max;function n(a,s,o){return s=r(s===void 0?a.length-1:s,0),function(){for(var u=arguments,h=-1,y=r(u.length-s,0),_=Array(y);++h<y;)_[h]=u[s+h];h=-1;for(var w=Array(s+1);++h<s;)w[h]=u[h];return w[s]=o(_),i(a,this,w)}}e.exports=n}),Wr=S((t,e)=>{function i(r){return function(){return r}}e.exports=i}),Qr=S((t,e)=>{var i=Wr(),r=Qe(),n=hi(),a=r?function(s,o){return r(s,"toString",{configurable:!0,enumerable:!1,value:i(o),writable:!0})}:n;e.exports=a}),tn=S((t,e)=>{var i=800,r=16,n=Date.now;function a(s){var o=0,u=0;return function(){var h=n(),y=r-(h-u);if(u=h,y>0){if(++o>=i)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}e.exports=a}),en=S((t,e)=>{var i=Qr(),r=tn(),n=r(i);e.exports=n}),rn=S((t,e)=>{var i=hi(),r=Zr(),n=en();function a(s,o){return n(r(s,o,i),s+"")}e.exports=a}),nn=S((t,e)=>{var i=Yt(),r=xe(),n=ui(),a=Et();function s(o,u,h){if(!a(h))return!1;var y=typeof u;return(y=="number"?r(h)&&n(u,h.length):y=="string"&&u in h)?i(h[u],o):!1}e.exports=s}),an=S((t,e)=>{var i=rn(),r=nn();function n(a){return i(function(s,o){var u=-1,h=o.length,y=h>1?o[h-1]:void 0,_=h>2?o[2]:void 0;for(y=a.length>3&&typeof y=="function"?(h--,y):void 0,_&&r(o[0],o[1],_)&&(y=h<3?void 0:y,h=1),s=Object(s);++u<h;){var w=o[u];w&&a(s,w,u,y)}return s})}e.exports=n}),we=S((t,e)=>{var i=Yr(),r=an(),n=r(function(a,s,o){i(a,s,o)});e.exports=n}),De=S((t,e)=>{var i=It(),r=Pt(),n="[object Symbol]";function a(s){return typeof s=="symbol"||r(s)&&i(s)==n}e.exports=a}),sn=S((t,e)=>{var i=Gt(),r=De(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function s(o,u){if(i(o))return!1;var h=typeof o;return h=="number"||h=="symbol"||h=="boolean"||o==null||r(o)?!0:a.test(o)||!n.test(o)||u!=null&&o in Object(u)}e.exports=s}),on=S((t,e)=>{var i=We(),r="Expected a function";function n(a,s){if(typeof a!="function"||s!=null&&typeof s!="function")throw new TypeError(r);var o=function(){var u=arguments,h=s?s.apply(this,u):u[0],y=o.cache;if(y.has(h))return y.get(h);var _=a.apply(this,u);return o.cache=y.set(h,_)||y,_};return o.cache=new(n.Cache||i),o}n.Cache=i,e.exports=n}),un=S((t,e)=>{var i=on(),r=500;function n(a){var s=i(a,function(u){return o.size===r&&o.clear(),u}),o=s.cache;return s}e.exports=n}),ln=S((t,e)=>{var i=un(),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,a=i(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(r,function(u,h,y,_){o.push(y?_.replace(n,"$1"):h||u)}),o});e.exports=a}),hn=S((t,e)=>{function i(r,n){for(var a=-1,s=r==null?0:r.length,o=Array(s);++a<s;)o[a]=n(r[a],a,r);return o}e.exports=i}),pn=S((t,e)=>{var i=ke(),r=hn(),n=Gt(),a=De(),s=1/0,o=i?i.prototype:void 0,u=o?o.toString:void 0;function h(y){if(typeof y=="string")return y;if(n(y))return r(y,h)+"";if(a(y))return u?u.call(y):"";var _=y+"";return _=="0"&&1/y==-s?"-0":_}e.exports=h}),cn=S((t,e)=>{var i=pn();function r(n){return n==null?"":i(n)}e.exports=r}),dn=S((t,e)=>{var i=Gt(),r=sn(),n=ln(),a=cn();function s(o,u){return i(o)?o:r(o,u)?[o]:n(a(o))}e.exports=s}),gn=S((t,e)=>{var i=De(),r=1/0;function n(a){if(typeof a=="string"||i(a))return a;var s=a+"";return s=="0"&&1/a==-r?"-0":s}e.exports=n}),fn=S((t,e)=>{var i=dn(),r=gn();function n(a,s){s=i(s,a);for(var o=0,u=s.length;a!=null&&o<u;)a=a[r(s[o++])];return o&&o==u?a:void 0}e.exports=n}),te=S((t,e)=>{var i=fn();function r(n,a,s){var o=n==null?void 0:i(n,a);return o===void 0?s:o}e.exports=r}),_n=S((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?e.exports=r():(i=i||self).RBush=r()})(t,function(){function i(m,v,M,P,E){(function D(l,p,d,c,g){for(;c>d;){if(c-d>600){var f=c-d+1,b=p-d+1,C=Math.log(f),k=.5*Math.exp(2*C/3),x=.5*Math.sqrt(C*k*(f-k)/f)*(b-f/2<0?-1:1),B=Math.max(d,Math.floor(p-b*k/f+x)),F=Math.min(c,Math.floor(p+(f-b)*k/f+x));D(l,p,B,F,g)}var O=l[p],G=d,j=c;for(r(l,d,p),g(l[c],O)>0&&r(l,d,c);G<j;){for(r(l,G,j),G++,j--;g(l[G],O)<0;)G++;for(;g(l[j],O)>0;)j--}g(l[d],O)===0?r(l,d,j):r(l,++j,c),j<=p&&(d=j+1),p<=j&&(c=j-1)}})(m,v,M||0,P||m.length-1,E||n)}function r(m,v,M){var P=m[v];m[v]=m[M],m[M]=P}function n(m,v){return m<v?-1:m>v?1:0}var a=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,v,M){if(!M)return v.indexOf(m);for(var P=0;P<v.length;P++)if(M(m,v[P]))return P;return-1}function o(m,v){u(m,0,m.children.length,v,m)}function u(m,v,M,P,E){E||(E=I(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var D=v;D<M;D++){var l=m.children[D];h(E,m.leaf?P(l):l)}return E}function h(m,v){return m.minX=Math.min(m.minX,v.minX),m.minY=Math.min(m.minY,v.minY),m.maxX=Math.max(m.maxX,v.maxX),m.maxY=Math.max(m.maxY,v.maxY),m}function y(m,v){return m.minX-v.minX}function _(m,v){return m.minY-v.minY}function w(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function A(m){return m.maxX-m.minX+(m.maxY-m.minY)}function T(m,v){return m.minX<=v.minX&&m.minY<=v.minY&&v.maxX<=m.maxX&&v.maxY<=m.maxY}function R(m,v){return v.minX<=m.maxX&&v.minY<=m.maxY&&v.maxX>=m.minX&&v.maxY>=m.minY}function I(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(m,v,M,P,E){for(var D=[v,M];D.length;)if(!((M=D.pop())-(v=D.pop())<=P)){var l=v+Math.ceil((M-v)/P/2)*P;i(m,l,v,M,E),D.push(v,l,l,M)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(m){var v=this.data,M=[];if(!R(m,v))return M;for(var P=this.toBBox,E=[];v;){for(var D=0;D<v.children.length;D++){var l=v.children[D],p=v.leaf?P(l):l;R(m,p)&&(v.leaf?M.push(l):T(m,p)?this._all(l,M):E.push(l))}v=E.pop()}return M},a.prototype.collides=function(m){var v=this.data;if(!R(m,v))return!1;for(var M=[];v;){for(var P=0;P<v.children.length;P++){var E=v.children[P],D=v.leaf?this.toBBox(E):E;if(R(m,D)){if(v.leaf||T(m,D))return!0;M.push(E)}}v=M.pop()}return!1},a.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var v=0;v<m.length;v++)this.insert(m[v]);return this}var M=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){var P=this.data;this.data=M,M=P}this._insert(M,this.data.height-M.height-1,!0)}else this.data=M;return this},a.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},a.prototype.clear=function(){return this.data=I([]),this},a.prototype.remove=function(m,v){if(!m)return this;for(var M,P,E,D=this.data,l=this.toBBox(m),p=[],d=[];D||p.length;){if(D||(D=p.pop(),P=p[p.length-1],M=d.pop(),E=!0),D.leaf){var c=s(m,D.children,v);if(c!==-1)return D.children.splice(c,1),p.push(D),this._condense(p),this}E||D.leaf||!T(D,l)?P?(M++,D=P.children[M],E=!1):D=null:(p.push(D),d.push(M),M=0,P=D,D=D.children[0])}return this},a.prototype.toBBox=function(m){return m},a.prototype.compareMinX=function(m,v){return m.minX-v.minX},a.prototype.compareMinY=function(m,v){return m.minY-v.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(m){return this.data=m,this},a.prototype._all=function(m,v){for(var M=[];m;)m.leaf?v.push.apply(v,m.children):M.push.apply(M,m.children),m=M.pop();return v},a.prototype._build=function(m,v,M,P){var E,D=M-v+1,l=this._maxEntries;if(D<=l)return o(E=I(m.slice(v,M+1)),this.toBBox),E;P||(P=Math.ceil(Math.log(D)/Math.log(l)),l=Math.ceil(D/Math.pow(l,P-1))),(E=I([])).leaf=!1,E.height=P;var p=Math.ceil(D/l),d=p*Math.ceil(Math.sqrt(l));z(m,v,M,d,this.compareMinX);for(var c=v;c<=M;c+=d){var g=Math.min(c+d-1,M);z(m,c,g,p,this.compareMinY);for(var f=c;f<=g;f+=p){var b=Math.min(f+p-1,g);E.children.push(this._build(m,f,b,P-1))}}return o(E,this.toBBox),E},a.prototype._chooseSubtree=function(m,v,M,P){for(;P.push(v),!v.leaf&&P.length-1!==M;){for(var E=1/0,D=1/0,l=void 0,p=0;p<v.children.length;p++){var d=v.children[p],c=w(d),g=(f=m,b=d,(Math.max(b.maxX,f.maxX)-Math.min(b.minX,f.minX))*(Math.max(b.maxY,f.maxY)-Math.min(b.minY,f.minY))-c);g<D?(D=g,E=c<E?c:E,l=d):g===D&&c<E&&(E=c,l=d)}v=l||v.children[0]}var f,b;return v},a.prototype._insert=function(m,v,M){var P=M?m:this.toBBox(m),E=[],D=this._chooseSubtree(P,this.data,v,E);for(D.children.push(m),h(D,P);v>=0&&E[v].children.length>this._maxEntries;)this._split(E,v),v--;this._adjustParentBBoxes(P,E,v)},a.prototype._split=function(m,v){var M=m[v],P=M.children.length,E=this._minEntries;this._chooseSplitAxis(M,E,P);var D=this._chooseSplitIndex(M,E,P),l=I(M.children.splice(D,M.children.length-D));l.height=M.height,l.leaf=M.leaf,o(M,this.toBBox),o(l,this.toBBox),v?m[v-1].children.push(l):this._splitRoot(M,l)},a.prototype._splitRoot=function(m,v){this.data=I([m,v]),this.data.height=m.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(m,v,M){for(var P,E,D,l,p,d,c,g=1/0,f=1/0,b=v;b<=M-v;b++){var C=u(m,0,b,this.toBBox),k=u(m,b,M,this.toBBox),x=(E=C,D=k,l=void 0,p=void 0,d=void 0,c=void 0,l=Math.max(E.minX,D.minX),p=Math.max(E.minY,D.minY),d=Math.min(E.maxX,D.maxX),c=Math.min(E.maxY,D.maxY),Math.max(0,d-l)*Math.max(0,c-p)),B=w(C)+w(k);x<g?(g=x,P=b,f=B<f?B:f):x===g&&B<f&&(f=B,P=b)}return P||M-v},a.prototype._chooseSplitAxis=function(m,v,M){var P=m.leaf?this.compareMinX:y,E=m.leaf?this.compareMinY:_;this._allDistMargin(m,v,M,P)<this._allDistMargin(m,v,M,E)&&m.children.sort(P)},a.prototype._allDistMargin=function(m,v,M,P){m.children.sort(P);for(var E=this.toBBox,D=u(m,0,v,E),l=u(m,M-v,M,E),p=A(D)+A(l),d=v;d<M-v;d++){var c=m.children[d];h(D,m.leaf?E(c):c),p+=A(D)}for(var g=M-v-1;g>=v;g--){var f=m.children[g];h(l,m.leaf?E(f):f),p+=A(l)}return p},a.prototype._adjustParentBBoxes=function(m,v,M){for(var P=M;P>=0;P--)h(v[P],m)},a.prototype._condense=function(m){for(var v=m.length-1,M=void 0;v>=0;v--)m[v].children.length===0?v>0?(M=m[v-1].children).splice(M.indexOf(m[v]),1):this.clear():o(m[v],this.toBBox)},a})}),pi=S(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=63710088e-1,t.factors={centimeters:t.earthRadius*100,centimetres:t.earthRadius*100,degrees:t.earthRadius/111325,feet:t.earthRadius*3.28084,inches:t.earthRadius*39.37,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:t.earthRadius*1e3,millimetres:t.earthRadius*1e3,nauticalmiles:t.earthRadius/1852,radians:1,yards:t.earthRadius*1.0936},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(c,g,f){f===void 0&&(f={});var b={type:"Feature"};return(f.id===0||f.id)&&(b.id=f.id),f.bbox&&(b.bbox=f.bbox),b.properties=g||{},b.geometry=c,b}t.feature=e;function i(c,g,f){switch(c){case"Point":return r(g).geometry;case"LineString":return o(g).geometry;case"Polygon":return a(g).geometry;case"MultiPoint":return _(g).geometry;case"MultiLineString":return y(g).geometry;case"MultiPolygon":return w(g).geometry;default:throw new Error(c+" is invalid")}}t.geometry=i;function r(c,g,f){if(f===void 0&&(f={}),!c)throw new Error("coordinates is required");if(!Array.isArray(c))throw new Error("coordinates must be an Array");if(c.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!D(c[0])||!D(c[1]))throw new Error("coordinates must contain numbers");var b={type:"Point",coordinates:c};return e(b,g,f)}t.point=r;function n(c,g,f){return f===void 0&&(f={}),h(c.map(function(b){return r(b,g)}),f)}t.points=n;function a(c,g,f){f===void 0&&(f={});for(var b=0,C=c;b<C.length;b++){var k=C[b];if(k.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var x=0;x<k[k.length-1].length;x++)if(k[k.length-1][x]!==k[0][x])throw new Error("First and last Position are not equivalent.")}var B={type:"Polygon",coordinates:c};return e(B,g,f)}t.polygon=a;function s(c,g,f){return f===void 0&&(f={}),h(c.map(function(b){return a(b,g)}),f)}t.polygons=s;function o(c,g,f){if(f===void 0&&(f={}),c.length<2)throw new Error("coordinates must be an array of two or more positions");var b={type:"LineString",coordinates:c};return e(b,g,f)}t.lineString=o;function u(c,g,f){return f===void 0&&(f={}),h(c.map(function(b){return o(b,g)}),f)}t.lineStrings=u;function h(c,g){g===void 0&&(g={});var f={type:"FeatureCollection"};return g.id&&(f.id=g.id),g.bbox&&(f.bbox=g.bbox),f.features=c,f}t.featureCollection=h;function y(c,g,f){f===void 0&&(f={});var b={type:"MultiLineString",coordinates:c};return e(b,g,f)}t.multiLineString=y;function _(c,g,f){f===void 0&&(f={});var b={type:"MultiPoint",coordinates:c};return e(b,g,f)}t.multiPoint=_;function w(c,g,f){f===void 0&&(f={});var b={type:"MultiPolygon",coordinates:c};return e(b,g,f)}t.multiPolygon=w;function A(c,g,f){f===void 0&&(f={});var b={type:"GeometryCollection",geometries:c};return e(b,g,f)}t.geometryCollection=A;function T(c,g){if(g===void 0&&(g=0),g&&!(g>=0))throw new Error("precision must be a positive number");var f=Math.pow(10,g||0);return Math.round(c*f)/f}t.round=T;function R(c,g){g===void 0&&(g="kilometers");var f=t.factors[g];if(!f)throw new Error(g+" units is invalid");return c*f}t.radiansToLength=R;function I(c,g){g===void 0&&(g="kilometers");var f=t.factors[g];if(!f)throw new Error(g+" units is invalid");return c/f}t.lengthToRadians=I;function z(c,g){return v(I(c,g))}t.lengthToDegrees=z;function m(c){var g=c%360;return g<0&&(g+=360),g}t.bearingToAzimuth=m;function v(c){var g=c%(2*Math.PI);return g*180/Math.PI}t.radiansToDegrees=v;function M(c){var g=c%360;return g*Math.PI/180}t.degreesToRadians=M;function P(c,g,f){if(g===void 0&&(g="kilometers"),f===void 0&&(f="kilometers"),!(c>=0))throw new Error("length must be a positive number");return R(I(c,g),f)}t.convertLength=P;function E(c,g,f){if(g===void 0&&(g="meters"),f===void 0&&(f="kilometers"),!(c>=0))throw new Error("area must be a positive number");var b=t.areaFactors[g];if(!b)throw new Error("invalid original units");var C=t.areaFactors[f];if(!C)throw new Error("invalid final units");return c/b*C}t.convertArea=E;function D(c){return!isNaN(c)&&c!==null&&!Array.isArray(c)}t.isNumber=D;function l(c){return!!c&&c.constructor===Object}t.isObject=l;function p(c){if(!c)throw new Error("bbox is required");if(!Array.isArray(c))throw new Error("bbox must be an Array");if(c.length!==4&&c.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");c.forEach(function(g){if(!D(g))throw new Error("bbox must only contain numbers")})}t.validateBBox=p;function d(c){if(!c)throw new Error("id is required");if(["string","number"].indexOf(typeof c)===-1)throw new Error("id must be a number or a string")}t.validateId=d}),ci=S(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=pi();function i(v,M,P){if(v!==null)for(var E,D,l,p,d,c,g,f=0,b=0,C,k=v.type,x=k==="FeatureCollection",B=k==="Feature",F=x?v.features.length:1,O=0;O<F;O++){g=x?v.features[O].geometry:B?v.geometry:v,C=g?g.type==="GeometryCollection":!1,d=C?g.geometries.length:1;for(var G=0;G<d;G++){var j=0,K=0;if(p=C?g.geometries[G]:g,p!==null){c=p.coordinates;var q=p.type;switch(f=P&&(q==="Polygon"||q==="MultiPolygon")?1:0,q){case null:break;case"Point":if(M(c,b,O,j,K)===!1)return!1;b++,j++;break;case"LineString":case"MultiPoint":for(E=0;E<c.length;E++){if(M(c[E],b,O,j,K)===!1)return!1;b++,q==="MultiPoint"&&j++}q==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(E=0;E<c.length;E++){for(D=0;D<c[E].length-f;D++){if(M(c[E][D],b,O,j,K)===!1)return!1;b++}q==="MultiLineString"&&j++,q==="Polygon"&&K++}q==="Polygon"&&j++;break;case"MultiPolygon":for(E=0;E<c.length;E++){for(K=0,D=0;D<c[E].length;D++){for(l=0;l<c[E][D].length-f;l++){if(M(c[E][D][l],b,O,j,K)===!1)return!1;b++}K++}j++}break;case"GeometryCollection":for(E=0;E<p.geometries.length;E++)if(i(p.geometries[E],M,P)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(v,M,P,E){var D=P;return i(v,function(l,p,d,c,g){p===0&&P===void 0?D=l:D=M(D,l,p,d,c,g)},E),D}function n(v,M){var P;switch(v.type){case"FeatureCollection":for(P=0;P<v.features.length&&M(v.features[P].properties,P)!==!1;P++);break;case"Feature":M(v.properties,0);break}}function a(v,M,P){var E=P;return n(v,function(D,l){l===0&&P===void 0?E=D:E=M(E,D,l)}),E}function s(v,M){if(v.type==="Feature")M(v,0);else if(v.type==="FeatureCollection")for(var P=0;P<v.features.length&&M(v.features[P],P)!==!1;P++);}function o(v,M,P){var E=P;return s(v,function(D,l){l===0&&P===void 0?E=D:E=M(E,D,l)}),E}function u(v){var M=[];return i(v,function(P){M.push(P)}),M}function h(v,M){var P,E,D,l,p,d,c,g,f,b,C=0,k=v.type==="FeatureCollection",x=v.type==="Feature",B=k?v.features.length:1;for(P=0;P<B;P++){for(d=k?v.features[P].geometry:x?v.geometry:v,g=k?v.features[P].properties:x?v.properties:{},f=k?v.features[P].bbox:x?v.bbox:void 0,b=k?v.features[P].id:x?v.id:void 0,c=d?d.type==="GeometryCollection":!1,p=c?d.geometries.length:1,D=0;D<p;D++){if(l=c?d.geometries[D]:d,l===null){if(M(null,C,g,f,b)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(M(l,C,g,f,b)===!1)return!1;break}case"GeometryCollection":{for(E=0;E<l.geometries.length;E++)if(M(l.geometries[E],C,g,f,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function y(v,M,P){var E=P;return h(v,function(D,l,p,d,c){l===0&&P===void 0?E=D:E=M(E,D,l,p,d,c)}),E}function _(v,M){h(v,function(P,E,D,l,p){var d=P===null?null:P.type;switch(d){case null:case"Point":case"LineString":case"Polygon":return M(e.feature(P,D,{bbox:l,id:p}),E,0)===!1?!1:void 0}var c;switch(d){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var g=0;g<P.coordinates.length;g++){var f=P.coordinates[g],b={type:c,coordinates:f};if(M(e.feature(b,D),E,g)===!1)return!1}})}function w(v,M,P){var E=P;return _(v,function(D,l,p){l===0&&p===0&&P===void 0?E=D:E=M(E,D,l,p)}),E}function A(v,M){_(v,function(P,E,D){var l=0;if(P.geometry){var p=P.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var d,c=0,g=0,f=0;if(i(P,function(b,C,k,x,B){if(d===void 0||E>c||x>g||B>f){d=b,c=E,g=x,f=B,l=0;return}var F=e.lineString([d,b],P.properties);if(M(F,E,D,B,l)===!1)return!1;l++,d=b})===!1)return!1}}})}function T(v,M,P){var E=P,D=!1;return A(v,function(l,p,d,c,g){D===!1&&P===void 0?E=l:E=M(E,l,p,d,c,g),D=!0}),E}function R(v,M){if(!v)throw new Error("geojson is required");_(v,function(P,E,D){if(P.geometry!==null){var l=P.geometry.type,p=P.geometry.coordinates;switch(l){case"LineString":if(M(P,E,D,0,0)===!1)return!1;break;case"Polygon":for(var d=0;d<p.length;d++)if(M(e.lineString(p[d],P.properties),E,D,d)===!1)return!1;break}}})}function I(v,M,P){var E=P;return R(v,function(D,l,p,d){l===0&&P===void 0?E=D:E=M(E,D,l,p,d)}),E}function z(v,M){if(M=M||{},!e.isObject(M))throw new Error("options is invalid");var P=M.featureIndex||0,E=M.multiFeatureIndex||0,D=M.geometryIndex||0,l=M.segmentIndex||0,p=M.properties,d;switch(v.type){case"FeatureCollection":P<0&&(P=v.features.length+P),p=p||v.features[P].properties,d=v.features[P].geometry;break;case"Feature":p=p||v.properties,d=v.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=v;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var c=d.coordinates;switch(d.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=c.length+l-1),e.lineString([c[l],c[l+1]],p,M);case"Polygon":return D<0&&(D=c.length+D),l<0&&(l=c[D].length+l-1),e.lineString([c[D][l],c[D][l+1]],p,M);case"MultiLineString":return E<0&&(E=c.length+E),l<0&&(l=c[E].length+l-1),e.lineString([c[E][l],c[E][l+1]],p,M);case"MultiPolygon":return E<0&&(E=c.length+E),D<0&&(D=c[E].length+D),l<0&&(l=c[E][D].length-l-1),e.lineString([c[E][D][l],c[E][D][l+1]],p,M)}throw new Error("geojson is invalid")}function m(v,M){if(M=M||{},!e.isObject(M))throw new Error("options is invalid");var P=M.featureIndex||0,E=M.multiFeatureIndex||0,D=M.geometryIndex||0,l=M.coordIndex||0,p=M.properties,d;switch(v.type){case"FeatureCollection":P<0&&(P=v.features.length+P),p=p||v.features[P].properties,d=v.features[P].geometry;break;case"Feature":p=p||v.properties,d=v.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=v;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var c=d.coordinates;switch(d.type){case"Point":return e.point(c,p,M);case"MultiPoint":return E<0&&(E=c.length+E),e.point(c[E],p,M);case"LineString":return l<0&&(l=c.length+l),e.point(c[l],p,M);case"Polygon":return D<0&&(D=c.length+D),l<0&&(l=c[D].length+l),e.point(c[D][l],p,M);case"MultiLineString":return E<0&&(E=c.length+E),l<0&&(l=c[E].length+l),e.point(c[E][l],p,M);case"MultiPolygon":return E<0&&(E=c.length+E),D<0&&(D=c[E].length+D),l<0&&(l=c[E][D].length-l),e.point(c[E][D][l],p,M)}throw new Error("geojson is invalid")}t.coordAll=u,t.coordEach=i,t.coordReduce=r,t.featureEach=s,t.featureReduce=o,t.findPoint=m,t.findSegment=z,t.flattenEach=_,t.flattenReduce=w,t.geomEach=h,t.geomReduce=y,t.lineEach=R,t.lineReduce=I,t.propEach=n,t.propReduce=a,t.segmentEach=A,t.segmentReduce=T}),mn=S(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=ci();function i(r){var n=[1/0,1/0,-1/0,-1/0];return e.coordEach(r,function(a){n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}i.default=i,t.default=i}),di=S((t,e)=>{var i=_n(),r=pi(),n=ci(),a=mn().default,s=n.featureEach;n.coordEach,r.polygon;var o=r.featureCollection;function u(h){var y=new i(h);return y.insert=function(_){if(_.type!=="Feature")throw new Error("invalid feature");return _.bbox=_.bbox?_.bbox:a(_),i.prototype.insert.call(this,_)},y.load=function(_){var w=[];return Array.isArray(_)?_.forEach(function(A){if(A.type!=="Feature")throw new Error("invalid features");A.bbox=A.bbox?A.bbox:a(A),w.push(A)}):s(_,function(A){if(A.type!=="Feature")throw new Error("invalid features");A.bbox=A.bbox?A.bbox:a(A),w.push(A)}),i.prototype.load.call(this,w)},y.remove=function(_,w){if(_.type!=="Feature")throw new Error("invalid feature");return _.bbox=_.bbox?_.bbox:a(_),i.prototype.remove.call(this,_,w)},y.clear=function(){return i.prototype.clear.call(this)},y.search=function(_){var w=i.prototype.search.call(this,this.toBBox(_));return o(w)},y.collides=function(_){return i.prototype.collides.call(this,this.toBBox(_))},y.all=function(){var _=i.prototype.all.call(this);return o(_)},y.toJSON=function(){return i.prototype.toJSON.call(this)},y.fromJSON=function(_){return i.prototype.fromJSON.call(this,_)},y.toBBox=function(_){var w;if(_.bbox)w=_.bbox;else if(Array.isArray(_)&&_.length===4)w=_;else if(Array.isArray(_)&&_.length===6)w=[_[0],_[1],_[3],_[4]];else if(_.type==="Feature")w=a(_);else if(_.type==="FeatureCollection")w=a(_);else throw new Error("invalid geojson");return{minX:w[0],minY:w[1],maxX:w[2],maxY:w[3]}},y}e.exports=u,e.exports.default=u});Array.prototype.findIndex=Array.prototype.findIndex||function(t){if(this===null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof t!="function")throw new TypeError("callback must be a function");for(var e=Object(this),i=e.length>>>0,r=arguments[1],n=0;n<i;n++)if(t.call(r,e[n],n,e))return n;return-1},Array.prototype.find=Array.prototype.find||function(t){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof t!="function")throw new TypeError("callback must be a function");for(var e=Object(this),i=e.length>>>0,r=arguments[1],n=0;n<i;n++){var a=e[n];if(t.call(r,a,n,e))return a}},typeof Object.assign!="function"&&(Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i!=null)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),function(t){t.forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(r===0)return!1;var n=e|0,a=Math.max(n>=0?n:r-Math.abs(n),0);function s(o,u){return o===u||typeof o=="number"&&typeof u=="number"&&isNaN(o)&&isNaN(u)}for(;a<r;){if(s(i[a],t))return!0;a++}return!1}});var yn={name:"@geoman-io/leaflet-geoman-free",version:"2.17.0",description:"A Leaflet Plugin For Editing Geometry Layers in Leaflet 1.0",keywords:["leaflet","geoman","polygon management","geometry editing","map data","map overlay","polygon","geojson","leaflet-draw","data-field-geojson","ui-leaflet-draw"],files:["dist"],main:"dist/leaflet-geoman.js",types:"dist/leaflet-geoman.d.ts",dependencies:{"@turf/boolean-contains":"^6.5.0","@turf/kinks":"^6.5.0","@turf/line-intersect":"^6.5.0","@turf/line-split":"^6.5.0",lodash:"4.17.21","polyclip-ts":"^0.16.5"},devDependencies:{"@types/leaflet":"^1.7.9","cross-env":"^7.0.3",cypress:"6.9.1","cypress-wait-until":"1.7.1",esbuild:"^0.20.0",eslint:"8.56.0","eslint-config-airbnb-base":"15.0.0","eslint-config-prettier":"9.1.0","eslint-plugin-cypress":"2.15.1","eslint-plugin-import":"2.29.1",husky:"^9.0.7",leaflet:"1.9.3","lint-staged":"^15.2.1",prettier:"3.2.4","prosthetic-hand":"1.3.1","ts-node":"^10.9.2"},peerDependencies:{leaflet:"^1.2.0"},scripts:{start:"pnpm run dev",dev:"cross-env DEV=true ts-node bundle.mjs",build:"ts-node bundle.mjs",test:"cypress run",cypress:"cypress open",prepare:"pnpm run build && husky","eslint-check":"eslint --print-config . | eslint-config-prettier-check",eslint:'eslint "{src,cypress,demo}/**/*.js" --fix ',prettier:'prettier --write "{src,cypress,demo}/**/*.{js,css}" --log-level=warn',lint:"pnpm run eslint && pnpm run prettier"},repository:{type:"git",url:"git://github.com/geoman-io/leaflet-geoman.git"},author:{name:"Geoman.io",email:"sales@geoman.io",url:"http://geoman.io"},license:"MIT",bugs:{url:"https://github.com/geoman-io/leaflet-geoman/issues"},homepage:"https://geoman.io",prettier:{trailingComma:"es5",tabWidth:2,semi:!0,singleQuote:!0},"lint-staged":{"*.js":'eslint "{src,cypress,demo}/**/*.js" --fix',"*.{js,css,md}":'prettier --write "{src,cypress,demo}/**/*.{js,css}"'}},gi=_t(we()),Ln={tooltips:{placeMarker:"Click to place marker",firstVertex:"Click to place first vertex",continueLine:"Click to continue drawing",finishLine:"Click any existing marker to finish",finishPoly:"Click first marker to finish",finishRect:"Click to finish",startCircle:"Click to place circle center",finishCircle:"Click to finish circle",placeCircleMarker:"Click to place circle marker",placeText:"Click to place text",selectFirstLayerFor:"Select first layer for {action}",selectSecondLayerFor:"Select second layer for {action}"},actions:{finish:"Finish",cancel:"Cancel",removeLastVertex:"Remove Last Vertex"},buttonTitles:{drawMarkerButton:"Draw Marker",drawPolyButton:"Draw Polygons",drawLineButton:"Draw Polyline",drawCircleButton:"Draw Circle",drawRectButton:"Draw Rectangle",editButton:"Edit Layers",dragButton:"Drag Layers",cutButton:"Cut Layers",deleteButton:"Remove Layers",drawCircleMarkerButton:"Draw Circle Marker",snappingButton:"Snap dragged marker to other layers and vertices",pinningButton:"Pin shared vertices together",rotateButton:"Rotate Layers",drawTextButton:"Draw Text",scaleButton:"Scale Layers",autoTracingButton:"Auto trace Line",snapGuidesButton:"Show SnapGuides",unionButton:"Union layers",differenceButton:"Subtract layers"},measurements:{totalLength:"Length",segmentLength:"Segment length",area:"Area",radius:"Radius",perimeter:"Perimeter",height:"Height",width:"Width",coordinates:"Position",coordinatesMarker:"Position Marker"}},vn={tooltips:{placeMarker:"Platziere den Marker mit Klick",firstVertex:"Platziere den ersten Marker mit Klick",continueLine:"Klicke, um weiter zu zeichnen",finishLine:"Beende mit Klick auf existierenden Marker",finishPoly:"Beende mit Klick auf ersten Marker",finishRect:"Beende mit Klick",startCircle:"Platziere das Kreiszentrum mit Klick",finishCircle:"Beende den Kreis mit Klick",placeCircleMarker:"Platziere den Kreismarker mit Klick",placeText:"Platziere den Text mit Klick"},actions:{finish:"Beenden",cancel:"Abbrechen",removeLastVertex:"Letzten Vertex löschen"},buttonTitles:{drawMarkerButton:"Marker zeichnen",drawPolyButton:"Polygon zeichnen",drawLineButton:"Polyline zeichnen",drawCircleButton:"Kreis zeichnen",drawRectButton:"Rechteck zeichnen",editButton:"Layer editieren",dragButton:"Layer bewegen",cutButton:"Layer schneiden",deleteButton:"Layer löschen",drawCircleMarkerButton:"Kreismarker zeichnen",snappingButton:"Bewegter Layer an andere Layer oder Vertexe einhacken",pinningButton:"Vertexe an der gleichen Position verknüpfen",rotateButton:"Layer drehen",drawTextButton:"Text zeichnen",scaleButton:"Layer skalieren",autoTracingButton:"Linie automatisch nachzeichen"},measurements:{totalLength:"Länge",segmentLength:"Segment Länge",area:"Fläche",radius:"Radius",perimeter:"Umfang",height:"Höhe",width:"Breite",coordinates:"Position",coordinatesMarker:"Position Marker"}},Cn={tooltips:{placeMarker:"Clicca per posizionare un Marker",firstVertex:"Clicca per posizionare il primo vertice",continueLine:"Clicca per continuare a disegnare",finishLine:"Clicca qualsiasi marker esistente per terminare",finishPoly:"Clicca il primo marker per terminare",finishRect:"Clicca per terminare",startCircle:"Clicca per posizionare il punto centrale del cerchio",finishCircle:"Clicca per terminare il cerchio",placeCircleMarker:"Clicca per posizionare un Marker del cherchio"},actions:{finish:"Termina",cancel:"Annulla",removeLastVertex:"Rimuovi l'ultimo vertice"},buttonTitles:{drawMarkerButton:"Disegna Marker",drawPolyButton:"Disegna Poligoni",drawLineButton:"Disegna Polilinea",drawCircleButton:"Disegna Cerchio",drawRectButton:"Disegna Rettangolo",editButton:"Modifica Livelli",dragButton:"Sposta Livelli",cutButton:"Ritaglia Livelli",deleteButton:"Elimina Livelli",drawCircleMarkerButton:"Disegna Marker del Cerchio",snappingButton:"Snap ha trascinato il pennarello su altri strati e vertici",pinningButton:"Pin condiviso vertici insieme",rotateButton:"Ruota livello"}},bn={tooltips:{placeMarker:"Klik untuk menempatkan marker",firstVertex:"Klik untuk menempatkan vertex pertama",continueLine:"Klik untuk meneruskan digitasi",finishLine:"Klik pada sembarang marker yang ada untuk mengakhiri",finishPoly:"Klik marker pertama untuk mengakhiri",finishRect:"Klik untuk mengakhiri",startCircle:"Klik untuk menempatkan titik pusat lingkaran",finishCircle:"Klik untuk mengakhiri lingkaran",placeCircleMarker:"Klik untuk menempatkan penanda lingkarann"},actions:{finish:"Selesai",cancel:"Batal",removeLastVertex:"Hilangkan Vertex Terakhir"},buttonTitles:{drawMarkerButton:"Digitasi Marker",drawPolyButton:"Digitasi Polygon",drawLineButton:"Digitasi Polyline",drawCircleButton:"Digitasi Lingkaran",drawRectButton:"Digitasi Segi Empat",editButton:"Edit Layer",dragButton:"Geser Layer",cutButton:"Potong Layer",deleteButton:"Hilangkan Layer",drawCircleMarkerButton:"Digitasi Penanda Lingkaran",snappingButton:"Jepretkan penanda yang ditarik ke lapisan dan simpul lain",pinningButton:"Sematkan simpul bersama bersama",rotateButton:"Putar lapisan"}},kn={tooltips:{placeMarker:"Adaugă un punct",firstVertex:"Apasă aici pentru a adăuga primul Vertex",continueLine:"Apasă aici pentru a continua desenul",finishLine:"Apasă pe orice obiect pentru a finisa desenul",finishPoly:"Apasă pe primul obiect pentru a finisa",finishRect:"Apasă pentru a finisa",startCircle:"Apasă pentru a desena un cerc",finishCircle:"Apasă pentru a finisa un cerc",placeCircleMarker:"Adaugă un punct"},actions:{finish:"Termină",cancel:"Anulează",removeLastVertex:"Șterge ultimul Vertex"},buttonTitles:{drawMarkerButton:"Adaugă o bulină",drawPolyButton:"Desenează un poligon",drawLineButton:"Desenează o linie",drawCircleButton:"Desenează un cerc",drawRectButton:"Desenează un dreptunghi",editButton:"Editează straturile",dragButton:"Mută straturile",cutButton:"Taie straturile",deleteButton:"Șterge straturile",drawCircleMarkerButton:"Desenează marcatorul cercului",snappingButton:"Fixați marcatorul glisat pe alte straturi și vârfuri",pinningButton:"Fixați vârfurile partajate împreună",rotateButton:"Rotiți stratul"}},Mn={tooltips:{placeMarker:"Нажмите, чтобы нанести маркер",firstVertex:"Нажмите, чтобы нанести первый объект",continueLine:"Нажмите, чтобы продолжить рисование",finishLine:"Нажмите любой существующий маркер для завершения",finishPoly:"Выберите первую точку, чтобы закончить",finishRect:"Нажмите, чтобы закончить",startCircle:"Нажмите, чтобы добавить центр круга",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Нажмите, чтобы нанести круговой маркер"},actions:{finish:"Завершить",cancel:"Отменить",removeLastVertex:"Отменить последнее действие"},buttonTitles:{drawMarkerButton:"Добавить маркер",drawPolyButton:"Рисовать полигон",drawLineButton:"Рисовать кривую",drawCircleButton:"Рисовать круг",drawRectButton:"Рисовать прямоугольник",editButton:"Редактировать слой",dragButton:"Перенести слой",cutButton:"Вырезать слой",deleteButton:"Удалить слой",drawCircleMarkerButton:"Добавить круговой маркер",snappingButton:"Привязать перетаскиваемый маркер к другим слоям и вершинам",pinningButton:"Связать общие точки вместе",rotateButton:"Поворот слоя"}},En={tooltips:{placeMarker:"Presiona para colocar un marcador",firstVertex:"Presiona para colocar el primer vértice",continueLine:"Presiona para continuar dibujando",finishLine:"Presiona cualquier marcador existente para finalizar",finishPoly:"Presiona el primer marcador para finalizar",finishRect:"Presiona para finalizar",startCircle:"Presiona para colocar el centro del círculo",finishCircle:"Presiona para finalizar el círculo",placeCircleMarker:"Presiona para colocar un marcador de círculo"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Eliminar último vértice"},buttonTitles:{drawMarkerButton:"Dibujar Marcador",drawPolyButton:"Dibujar Polígono",drawLineButton:"Dibujar Línea",drawCircleButton:"Dibujar Círculo",drawRectButton:"Dibujar Rectángulo",editButton:"Editar Capas",dragButton:"Arrastrar Capas",cutButton:"Cortar Capas",deleteButton:"Eliminar Capas",drawCircleMarkerButton:"Dibujar Marcador de Círculo",snappingButton:"El marcador de Snap arrastrado a otras capas y vértices",pinningButton:"Fijar juntos los vértices compartidos",rotateButton:"Rotar capa"}},Bn={tooltips:{placeMarker:"Klik om een marker te plaatsen",firstVertex:"Klik om het eerste punt te plaatsen",continueLine:"Klik om te blijven tekenen",finishLine:"Klik op een bestaand punt om te beëindigen",finishPoly:"Klik op het eerst punt om te beëindigen",finishRect:"Klik om te beëindigen",startCircle:"Klik om het middelpunt te plaatsen",finishCircle:"Klik om de cirkel te beëindigen",placeCircleMarker:"Klik om een marker te plaatsen"},actions:{finish:"Bewaar",cancel:"Annuleer",removeLastVertex:"Verwijder laatste punt"},buttonTitles:{drawMarkerButton:"Plaats Marker",drawPolyButton:"Teken een vlak",drawLineButton:"Teken een lijn",drawCircleButton:"Teken een cirkel",drawRectButton:"Teken een vierkant",editButton:"Bewerk",dragButton:"Verplaats",cutButton:"Knip",deleteButton:"Verwijder",drawCircleMarkerButton:"Plaats Marker",snappingButton:"Snap gesleepte marker naar andere lagen en hoekpunten",pinningButton:"Speld gedeelde hoekpunten samen",rotateButton:"Laag roteren"}},xn={tooltips:{placeMarker:"Cliquez pour placer un marqueur",firstVertex:"Cliquez pour placer le premier sommet",continueLine:"Cliquez pour continuer à dessiner",finishLine:"Cliquez sur n'importe quel marqueur pour terminer",finishPoly:"Cliquez sur le premier marqueur pour terminer",finishRect:"Cliquez pour terminer",startCircle:"Cliquez pour placer le centre du cercle",finishCircle:"Cliquez pour finir le cercle",placeCircleMarker:"Cliquez pour placer le marqueur circulaire"},actions:{finish:"Terminer",cancel:"Annuler",removeLastVertex:"Retirer le dernier sommet"},buttonTitles:{drawMarkerButton:"Placer des marqueurs",drawPolyButton:"Dessiner des polygones",drawLineButton:"Dessiner des polylignes",drawCircleButton:"Dessiner un cercle",drawRectButton:"Dessiner un rectangle",editButton:"Éditer des calques",dragButton:"Déplacer des calques",cutButton:"Couper des calques",deleteButton:"Supprimer des calques",drawCircleMarkerButton:"Dessiner un marqueur circulaire",snappingButton:"Glisser le marqueur vers d'autres couches et sommets",pinningButton:"Épingler ensemble les sommets partagés",rotateButton:"Tourner des calques"}},wn={tooltips:{placeMarker:"单击放置标记",firstVertex:"单击放置首个顶点",continueLine:"单击继续绘制",finishLine:"单击任何存在的标记以完成",finishPoly:"单击第一个标记以完成",finishRect:"单击完成",startCircle:"单击放置圆心",finishCircle:"单击完成圆形",placeCircleMarker:"点击放置圆形标记"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最后的顶点"},buttonTitles:{drawMarkerButton:"绘制标记",drawPolyButton:"绘制多边形",drawLineButton:"绘制线段",drawCircleButton:"绘制圆形",drawRectButton:"绘制长方形",editButton:"编辑图层",dragButton:"拖拽图层",cutButton:"剪切图层",deleteButton:"删除图层",drawCircleMarkerButton:"画圆圈标记",snappingButton:"将拖动的标记捕捉到其他图层和顶点",pinningButton:"将共享顶点固定在一起",rotateButton:"旋转图层"}},Dn={tooltips:{placeMarker:"單擊放置標記",firstVertex:"單擊放置第一個頂點",continueLine:"單擊繼續繪製",finishLine:"單擊任何存在的標記以完成",finishPoly:"單擊第一個標記以完成",finishRect:"單擊完成",startCircle:"單擊放置圓心",finishCircle:"單擊完成圓形",placeCircleMarker:"點擊放置圓形標記"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最後一個頂點"},buttonTitles:{drawMarkerButton:"放置標記",drawPolyButton:"繪製多邊形",drawLineButton:"繪製線段",drawCircleButton:"繪製圓形",drawRectButton:"繪製方形",editButton:"編輯圖形",dragButton:"移動圖形",cutButton:"裁切圖形",deleteButton:"刪除圖形",drawCircleMarkerButton:"畫圓圈標記",snappingButton:"將拖動的標記對齊到其他圖層和頂點",pinningButton:"將共享頂點固定在一起",rotateButton:"旋轉圖形"}},Pn={tooltips:{placeMarker:"Clique para posicionar o marcador",firstVertex:"Clique para posicionar o primeiro vértice",continueLine:"Clique para continuar desenhando",finishLine:"Clique em qualquer marcador existente para finalizar",finishPoly:"Clique no primeiro marcador para finalizar",finishRect:"Clique para finalizar",startCircle:"Clique para posicionar o centro do círculo",finishCircle:"Clique para finalizar o círculo",placeCircleMarker:"Clique para posicionar o marcador circular",placeText:"Clique para inserir texto"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Remover último vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Linha Poligonal",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Recortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices compartilhados",rotateButton:"Rotacionar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Redimensionar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},An={tooltips:{placeMarker:"Clique para colocar marcador",firstVertex:"Clique para colocar primeiro vértice",continueLine:"Clique para continuar a desenhar",finishLine:"Clique num marcador existente para terminar",finishPoly:"Clique no primeiro marcador para terminar",finishRect:"Clique para terminar",startCircle:"Clique para colocar o centro do círculo",finishCircle:"Clique para terminar o círculo",placeCircleMarker:"Clique para colocar marcador de círculo",placeText:"Clique para colocar texto"},actions:{finish:"Terminar",cancel:"Cancelar",removeLastVertex:"Remover Último Vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Polilinha",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Cortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices partilhados",rotateButton:"Rodar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Escalar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},Sn={tooltips:{placeMarker:"Kliknij, aby umieścić znacznik",firstVertex:"Kliknij, aby umieścić pierwszy wierzchołek",continueLine:"Kliknij, aby kontynuować rysowanie",finishLine:"Kliknij dowolny istniejący znacznik, aby zakończyć",finishPoly:"Kliknij pierwszy znacznik, aby zakończyć",finishRect:"Kliknij, aby zakończyć",startCircle:"Kliknij, aby umieścić środek okręgu",finishCircle:"Kliknij, aby zakończyć okrąg",placeCircleMarker:"Kliknij, aby umieścić znacznik okręgu",placeText:"Kliknij, aby umieścić tekst"},actions:{finish:"Zakończ",cancel:"Anuluj",removeLastVertex:"Usuń ostatni wierzchołek"},buttonTitles:{drawMarkerButton:"Rysuj znacznik",drawPolyButton:"Rysuj wielokąt",drawLineButton:"Rysuj linię",drawCircleButton:"Rysuj okrąg",drawRectButton:"Rysuj prostokąt",editButton:"Edytuj warstwy",dragButton:"Przeciągnij warstwy",cutButton:"Wytnij warstwy",deleteButton:"Usuń warstwy",drawCircleMarkerButton:"Rysuj znacznik okrągły",snappingButton:"Przyciągnij przenoszony znacznik do innych warstw i wierzchołków",pinningButton:"Przypnij wspólne wierzchołki razem",rotateButton:"Obróć warstwy",drawTextButton:"Rysuj tekst",scaleButton:"Skaluj warstwy",autoTracingButton:"Automatyczne śledzenie linii"},measurements:{totalLength:"Długość",segmentLength:"Długość odcinka",area:"Obszar",radius:"Promień",perimeter:"Obwód",height:"Wysokość",width:"Szerokość",coordinates:"Pozycja",coordinatesMarker:"Znacznik pozycji"}},Fn={tooltips:{placeMarker:"Klicka för att placera markör",firstVertex:"Klicka för att placera första hörnet",continueLine:"Klicka för att fortsätta rita",finishLine:"Klicka på en existerande punkt för att slutföra",finishPoly:"Klicka på den första punkten för att slutföra",finishRect:"Klicka för att slutföra",startCircle:"Klicka för att placera cirkelns centrum",finishCircle:"Klicka för att slutföra cirkeln",placeCircleMarker:"Klicka för att placera cirkelmarkör"},actions:{finish:"Slutför",cancel:"Avbryt",removeLastVertex:"Ta bort sista hörnet"},buttonTitles:{drawMarkerButton:"Rita Markör",drawPolyButton:"Rita Polygoner",drawLineButton:"Rita Linje",drawCircleButton:"Rita Cirkel",drawRectButton:"Rita Rektangel",editButton:"Redigera Lager",dragButton:"Dra Lager",cutButton:"Klipp i Lager",deleteButton:"Ta bort Lager",drawCircleMarkerButton:"Rita Cirkelmarkör",snappingButton:"Snäpp dra markören till andra lager och hörn",pinningButton:"Fäst delade hörn tillsammans",rotateButton:"Rotera lagret"}},Tn={tooltips:{placeMarker:"Κάντε κλικ για να τοποθετήσετε Δείκτη",firstVertex:"Κάντε κλικ για να τοποθετήσετε το πρώτο σημείο",continueLine:"Κάντε κλικ για να συνεχίσετε να σχεδιάζετε",finishLine:"Κάντε κλικ σε οποιονδήποτε υπάρχον σημείο για να ολοκληρωθεί",finishPoly:"Κάντε κλικ στο πρώτο σημείο για να τελειώσετε",finishRect:"Κάντε κλικ για να τελειώσετε",startCircle:"Κάντε κλικ για να τοποθετήσετε κέντρο Κύκλου",finishCircle:"Κάντε κλικ για να ολοκληρώσετε τον Κύκλο",placeCircleMarker:"Κάντε κλικ για να τοποθετήσετε Κυκλικό Δείκτη"},actions:{finish:"Τέλος",cancel:"Ακύρωση",removeLastVertex:"Κατάργηση τελευταίου σημείου"},buttonTitles:{drawMarkerButton:"Σχεδίαση Δείκτη",drawPolyButton:"Σχεδίαση Πολυγώνου",drawLineButton:"Σχεδίαση Γραμμής",drawCircleButton:"Σχεδίαση Κύκλου",drawRectButton:"Σχεδίαση Ορθογωνίου",editButton:"Επεξεργασία Επιπέδων",dragButton:"Μεταφορά Επιπέδων",cutButton:"Αποκοπή Επιπέδων",deleteButton:"Κατάργηση Επιπέδων",drawCircleMarkerButton:"Σχεδίαση Κυκλικού Δείκτη",snappingButton:"Προσκόλληση του Δείκτη μεταφοράς σε άλλα Επίπεδα και Κορυφές",pinningButton:"Περικοπή κοινών κορυφών μαζί",rotateButton:"Περιστρέψτε το στρώμα"}},Rn={tooltips:{placeMarker:"Kattintson a jelölő elhelyezéséhez",firstVertex:"Kattintson az első pont elhelyezéséhez",continueLine:"Kattintson a következő pont elhelyezéséhez",finishLine:"A befejezéshez kattintson egy meglévő pontra",finishPoly:"A befejezéshez kattintson az első pontra",finishRect:"Kattintson a befejezéshez",startCircle:"Kattintson a kör középpontjának elhelyezéséhez",finishCircle:"Kattintson a kör befejezéséhez",placeCircleMarker:"Kattintson a körjelölő elhelyezéséhez"},actions:{finish:"Befejezés",cancel:"Mégse",removeLastVertex:"Utolsó pont eltávolítása"},buttonTitles:{drawMarkerButton:"Jelölő rajzolása",drawPolyButton:"Poligon rajzolása",drawLineButton:"Vonal rajzolása",drawCircleButton:"Kör rajzolása",drawRectButton:"Négyzet rajzolása",editButton:"Elemek szerkesztése",dragButton:"Elemek mozgatása",cutButton:"Elemek vágása",deleteButton:"Elemek törlése",drawCircleMarkerButton:"Kör jelölő rajzolása",snappingButton:"Kapcsolja a jelöltőt másik elemhez vagy ponthoz",pinningButton:"Közös pontok összekötése",rotateButton:"Fólia elforgatása"}},On={tooltips:{placeMarker:"Tryk for at placere en markør",firstVertex:"Tryk for at placere det første punkt",continueLine:"Tryk for at fortsætte linjen",finishLine:"Tryk på et eksisterende punkt for at afslutte",finishPoly:"Tryk på det første punkt for at afslutte",finishRect:"Tryk for at afslutte",startCircle:"Tryk for at placere cirklens center",finishCircle:"Tryk for at afslutte cirklen",placeCircleMarker:"Tryk for at placere en cirkelmarkør"},actions:{finish:"Afslut",cancel:"Afbryd",removeLastVertex:"Fjern sidste punkt"},buttonTitles:{drawMarkerButton:"Placer markør",drawPolyButton:"Tegn polygon",drawLineButton:"Tegn linje",drawCircleButton:"Tegn cirkel",drawRectButton:"Tegn firkant",editButton:"Rediger",dragButton:"Træk",cutButton:"Klip",deleteButton:"Fjern",drawCircleMarkerButton:"Tegn cirkelmarkør",snappingButton:"Fastgør trukket markør til andre elementer",pinningButton:"Sammenlæg delte elementer",rotateButton:"Roter laget"}},In={tooltips:{placeMarker:"Klikk for å plassere punkt",firstVertex:"Klikk for å plassere første punkt",continueLine:"Klikk for å tegne videre",finishLine:"Klikk på et eksisterende punkt for å fullføre",finishPoly:"Klikk første punkt for å fullføre",finishRect:"Klikk for å fullføre",startCircle:"Klikk for å sette sirkel midtpunkt",finishCircle:"Klikk for å fullføre sirkel",placeCircleMarker:"Klikk for å plassere sirkel",placeText:"Klikk for å plassere tekst"},actions:{finish:"Fullfør",cancel:"Kanseller",removeLastVertex:"Fjern forrige punkt"},buttonTitles:{drawMarkerButton:"Tegn punkt",drawPolyButton:"Tegn flate",drawLineButton:"Tegn linje",drawCircleButton:"Tegn sirkel",drawRectButton:"Tegn rektangel",editButton:"Rediger objekter",dragButton:"Dra objekter",cutButton:"Kutt objekter",deleteButton:"Fjern objekter",drawCircleMarkerButton:"Tegn sirkel-punkt",snappingButton:"Fest dratt punkt til andre objekter og punkt",pinningButton:"Pin delte punkter sammen",rotateButton:"Rotér objekter",drawTextButton:"Tegn tekst",scaleButton:"Skalér objekter",autoTracingButton:"Automatisk sporing av linje"},measurements:{totalLength:"Lengde",segmentLength:"Segmentlengde",area:"Område",radius:"Radius",perimeter:"Omriss",height:"Høyde",width:"Bredde",coordinates:"Posisjon",coordinatesMarker:"Posisjonsmarkør"}},Gn={tooltips:{placeMarker:"کلیک برای جانمایی نشان",firstVertex:"کلیک برای رسم اولین رأس",continueLine:"کلیک برای ادامه رسم",finishLine:"کلیک روی هر نشان موجود برای پایان",finishPoly:"کلیک روی اولین نشان برای پایان",finishRect:"کلیک برای پایان",startCircle:"کلیک برای رسم مرکز دایره",finishCircle:"کلیک برای پایان رسم دایره",placeCircleMarker:"کلیک برای رسم نشان دایره",placeText:"کلیک برای نوشتن متن"},actions:{finish:"پایان",cancel:"لفو",removeLastVertex:"حذف آخرین رأس"},buttonTitles:{drawMarkerButton:"درج نشان",drawPolyButton:"رسم چندضلعی",drawLineButton:"رسم خط",drawCircleButton:"رسم دایره",drawRectButton:"رسم چهارضلعی",editButton:"ویرایش لایه‌ها",dragButton:"جابجایی لایه‌ها",cutButton:"برش لایه‌ها",deleteButton:"حذف لایه‌ها",drawCircleMarkerButton:"رسم نشان دایره",snappingButton:"نشانگر را به لایه‌ها و رئوس دیگر بکشید",pinningButton:"رئوس مشترک را با هم پین کنید",rotateButton:"چرخش لایه",drawTextButton:"رسم متن",scaleButton:"مقیاس‌گذاری",autoTracingButton:"ردیاب خودکار"},measurements:{totalLength:"طول",segmentLength:"طول بخش",area:"ناحیه",radius:"شعاع",perimeter:"محیط",height:"ارتفاع",width:"عرض",coordinates:"موقعیت",coordinatesMarker:"موقعیت نشان"}},jn={tooltips:{placeMarker:"Натисніть, щоб нанести маркер",firstVertex:"Натисніть, щоб нанести першу вершину",continueLine:"Натисніть, щоб продовжити малювати",finishLine:"Натисніть будь-який існуючий маркер для завершення",finishPoly:"Виберіть перший маркер, щоб завершити",finishRect:"Натисніть, щоб завершити",startCircle:"Натисніть, щоб додати центр кола",finishCircle:"Натисніть, щоб завершити коло",placeCircleMarker:"Натисніть, щоб нанести круговий маркер"},actions:{finish:"Завершити",cancel:"Відмінити",removeLastVertex:"Видалити попередню вершину"},buttonTitles:{drawMarkerButton:"Малювати маркер",drawPolyButton:"Малювати полігон",drawLineButton:"Малювати криву",drawCircleButton:"Малювати коло",drawRectButton:"Малювати прямокутник",editButton:"Редагувати шари",dragButton:"Перенести шари",cutButton:"Вирізати шари",deleteButton:"Видалити шари",drawCircleMarkerButton:"Малювати круговий маркер",snappingButton:"Прив’язати перетягнутий маркер до інших шарів та вершин",pinningButton:"Зв'язати спільні вершини разом",rotateButton:"Повернути шар"}},Nn={tooltips:{placeMarker:"İşaretçi yerleştirmek için tıklayın",firstVertex:"İlk tepe noktasını yerleştirmek için tıklayın",continueLine:"Çizime devam etmek için tıklayın",finishLine:"Bitirmek için mevcut herhangi bir işaretçiyi tıklayın",finishPoly:"Bitirmek için ilk işaretçiyi tıklayın",finishRect:"Bitirmek için tıklayın",startCircle:"Daire merkezine yerleştirmek için tıklayın",finishCircle:"Daireyi bitirmek için tıklayın",placeCircleMarker:"Daire işaretçisi yerleştirmek için tıklayın"},actions:{finish:"Bitir",cancel:"İptal",removeLastVertex:"Son köşeyi kaldır"},buttonTitles:{drawMarkerButton:"Çizim İşaretçisi",drawPolyButton:"Çokgenler çiz",drawLineButton:"Çoklu çizgi çiz",drawCircleButton:"Çember çiz",drawRectButton:"Dikdörtgen çiz",editButton:"Katmanları düzenle",dragButton:"Katmanları sürükle",cutButton:"Katmanları kes",deleteButton:"Katmanları kaldır",drawCircleMarkerButton:"Daire işaretçisi çiz",snappingButton:"Sürüklenen işaretçiyi diğer katmanlara ve köşelere yapıştır",pinningButton:"Paylaşılan köşeleri birbirine sabitle",rotateButton:"Katmanı döndür"}},zn={tooltips:{placeMarker:"Kliknutím vytvoříte značku",firstVertex:"Kliknutím vytvoříte první objekt",continueLine:"Kliknutím pokračujte v kreslení",finishLine:"Kliknutí na libovolnou existující značku pro dokončení",finishPoly:"Vyberte první bod pro dokončení",finishRect:"Klikněte pro dokončení",startCircle:"Kliknutím přidejte střed kruhu",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Kliknutím nastavte poloměr"},actions:{finish:"Dokončit",cancel:"Zrušit",removeLastVertex:"Zrušit poslední akci"},buttonTitles:{drawMarkerButton:"Přidat značku",drawPolyButton:"Nakreslit polygon",drawLineButton:"Nakreslit křivku",drawCircleButton:"Nakreslit kruh",drawRectButton:"Nakreslit obdélník",editButton:"Upravit vrstvu",dragButton:"Přeneste vrstvu",cutButton:"Vyjmout vrstvu",deleteButton:"Smazat vrstvu",drawCircleMarkerButton:"Přidat kruhovou značku",snappingButton:"Navázat tažnou značku k dalším vrstvám a vrcholům",pinningButton:"Spojit společné body dohromady",rotateButton:"Otočte vrstvu"}},Un={tooltips:{placeMarker:"クリックしてマーカーを配置",firstVertex:"クリックして最初の頂点を配置",continueLine:"クリックして描画を続ける",finishLine:"任意のマーカーをクリックして終了",finishPoly:"最初のマーカーをクリックして終了",finishRect:"クリックして終了",startCircle:"クリックして円の中心を配置",finishCircle:"クリックして円の描画を終了",placeCircleMarker:"クリックして円マーカーを配置",placeText:"クリックしてテキストを配置"},actions:{finish:"終了",cancel:"キャンセル",removeLastVertex:"最後の頂点を削除"},buttonTitles:{drawMarkerButton:"マーカーを描画",drawPolyButton:"ポリゴンを描画",drawLineButton:"折れ線を描画",drawCircleButton:"円を描画",drawRectButton:"矩形を描画",editButton:"レイヤーを編集",dragButton:"レイヤーをドラッグ",cutButton:"レイヤーを切り取り",deleteButton:"レイヤーを削除",drawCircleMarkerButton:"円マーカーを描画",snappingButton:"ドラッグしたマーカーを他のレイヤーや頂点にスナップする",pinningButton:"共有する頂点を同時に動かす",rotateButton:"レイヤーを回転",drawTextButton:"テキストを描画"}},Vn={tooltips:{placeMarker:"Klikkaa asettaaksesi merkin",firstVertex:"Klikkaa asettaakseni ensimmäisen osuuden",continueLine:"Klikkaa jatkaaksesi piirtämistä",finishLine:"Klikkaa olemassa olevaa merkkiä lopettaaksesi",finishPoly:"Klikkaa ensimmäistä merkkiä lopettaaksesi",finishRect:"Klikkaa lopettaaksesi",startCircle:"Klikkaa asettaaksesi ympyrän keskipisteen",finishCircle:"Klikkaa lopettaaksesi ympyrän",placeCircleMarker:"Klikkaa asettaaksesi ympyrämerkin",placeText:"Klikkaa asettaaksesi tekstin"},actions:{finish:"Valmis",cancel:"Peruuta",removeLastVertex:"Poista viimeinen osuus"},buttonTitles:{drawMarkerButton:"Piirrä merkkejä",drawPolyButton:"Piirrä monikulmioita",drawLineButton:"Piirrä viivoja",drawCircleButton:"Piirrä ympyrä",drawRectButton:"Piirrä neliskulmioita",editButton:"Muokkaa",dragButton:"Siirrä",cutButton:"Leikkaa",deleteButton:"Poista",drawCircleMarkerButton:"Piirrä ympyrämerkki",snappingButton:"Kiinnitä siirrettävä merkki toisiin muotoihin",pinningButton:"Kiinnitä jaetut muodot yhteen",rotateButton:"Käännä",drawTextButton:"Piirrä tekstiä"}},Kn={tooltips:{placeMarker:"마커 위치를 클릭하세요",firstVertex:"첫번째 꼭지점 위치을 클릭하세요",continueLine:"계속 그리려면 클릭하세요",finishLine:"끝내려면 기존 마커를 클릭하세요",finishPoly:"끝내려면 처음 마커를 클릭하세요",finishRect:"끝내려면 클릭하세요",startCircle:"원의 중심이 될 위치를 클릭하세요",finishCircle:"원을 끝내려면 클릭하세요",placeCircleMarker:"원 마커 위치를 클릭하세요",placeText:"텍스트 위치를 클릭하세요"},actions:{finish:"끝내기",cancel:"취소",removeLastVertex:"마지막 꼭지점 제거"},buttonTitles:{drawMarkerButton:"마커 그리기",drawPolyButton:"다각형 그리기",drawLineButton:"다각선 그리기",drawCircleButton:"원 그리기",drawRectButton:"직사각형 그리기",editButton:"레이어 편집하기",dragButton:"레이어 끌기",cutButton:"레이어 자르기",deleteButton:"레이어 제거하기",drawCircleMarkerButton:"원 마커 그리기",snappingButton:"잡아끈 마커를 다른 레이어 및 꼭지점에 들러붙게 하기",pinningButton:"공유 꼭지점을 함께 찍기",rotateButton:"레이어 회전하기",drawTextButton:"텍스트 그리기"}},qn={tooltips:{placeMarker:"Маркерди жайгаштыруу үчүн басыңыз",firstVertex:"Биринчи чокуну жайгаштырууну үчүн басыңыз",continueLine:"Сүрөт тартууну улантуу үчүн басыңыз",finishLine:"Аяктоо үчүн учурдагы маркерди басыңыз",finishPoly:"Бүтүрүү үчүн биринчи маркерди басыңыз",finishRect:"Бүтүрүү үчүн басыңыз",startCircle:"Айлананын борборун жайгаштырууну үчүн басыңыз",finishCircle:"Айлананы бүтүрүү үчүн басыңыз",placeCircleMarker:"Тегерек маркерди жайгаштыруу үчүн басыңыз",placeText:"Текстти жайгаштыруу үчүн басыңыз"},actions:{finish:"Аягы",cancel:"Жок кылуу",removeLastVertex:"Акыркы чокуну өчүрүү"},buttonTitles:{drawMarkerButton:"Маркерди чизуу",drawPolyButton:"Полигон чизуу",drawLineButton:"Полилиния чизуу",drawCircleButton:"Дайынды чизуу",drawRectButton:"Прямоугольник чизуу",editButton:"Слоопту түзөтүү",dragButton:"Слоопту карап сүйлөү",cutButton:"Слооптун башын кесүү",deleteButton:"Слооптун өчүрүү",drawCircleMarkerButton:"Дайынды маркерди чизуу",snappingButton:"Башка слооптордун жана вертекстердин арасына чекилдөө",pinningButton:"Бөлүшкөн вертекстерди бирге тутуштуруу",rotateButton:"Слооптун өзгөртүү",drawTextButton:"Текст чизуу",scaleButton:"Слооптун өлчөмүн өзгөртүү",autoTracingButton:"Автоматтык тизмеги чизуу"},measurements:{totalLength:"Узундук",segmentLength:"Сегмент узундугу",area:"Аймак",radius:"Радиус",perimeter:"Периметр",height:"Диаметр",width:"Кенчилик",coordinates:"Координаттар",coordinatesMarker:"Маркердин координаттары"}},jt={en:Ln,de:vn,it:Cn,id:bn,ro:kn,ru:Mn,es:En,nl:Bn,fr:xn,pt_br:Pn,pt_pt:An,zh:wn,zh_tw:Dn,pl:Sn,sv:Fn,el:Tn,hu:Rn,da:On,no:In,fa:Gn,ua:jn,tr:Nn,cz:zn,ja:Un,fi:Vn,ko:Kn,ky:qn},Hn={_globalEditModeEnabled:!1,enableGlobalEditMode(t){let e={...t};this._globalEditModeEnabled=!0,this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),L.PM.Utils.findLayers(this.map).forEach(i=>{this._isRelevantForEdit(i)&&i.pm.enable(e)}),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayersEdit={},this.map.on("layeradd",this._layerAddedEdit,this),this.map.on("layeradd",this.throttledReInitEdit,this),this._fireGlobalEditModeToggled(!0)},disableGlobalEditMode(){this._globalEditModeEnabled=!1,L.PM.Utils.findLayers(this.map).forEach(t=>{t.pm.disable()}),this.map.off("layeradd",this._layerAddedEdit,this),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),this._fireGlobalEditModeToggled(!1)},globalEditEnabled(){return this.globalEditModeEnabled()},globalEditModeEnabled(){return this._globalEditModeEnabled},toggleGlobalEditMode(t=this.globalOptions){this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(t)},handleLayerAdditionInGlobalEditMode(){let t=this._addedLayersEdit;if(this._addedLayersEdit={},this.globalEditModeEnabled())for(let e in t){let i=t[e];this._isRelevantForEdit(i)&&i.pm.enable({...this.globalOptions})}},_layerAddedEdit({layer:t}){this._addedLayersEdit[L.stamp(t)]=t},_isRelevantForEdit(t){return t.pm&&!(t instanceof L.LayerGroup)&&(!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&t.options.pmIgnore===!1)&&!t._pmTempLayer&&t.pm.options.allowEditing}},Jn=Hn,Xn={_globalDragModeEnabled:!1,enableGlobalDragMode(){let t=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!0,this._addedLayersDrag={},t.forEach(e=>{this._isRelevantForDrag(e)&&e.pm.enableLayerDrag()}),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this._layerAddedDrag,this),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!0)},disableGlobalDragMode(){let t=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!1,t.forEach(e=>{e.pm.disableLayerDrag()}),this.map.off("layeradd",this._layerAddedDrag,this),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!1)},globalDragModeEnabled(){return!!this._globalDragModeEnabled},toggleGlobalDragMode(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode(){let t=this._addedLayersDrag;if(this._addedLayersDrag={},this.globalDragModeEnabled())for(let e in t){let i=t[e];this._isRelevantForDrag(i)&&i.pm.enableLayerDrag()}},_layerAddedDrag({layer:t}){this._addedLayersDrag[L.stamp(t)]=t},_isRelevantForDrag(t){return t.pm&&!(t instanceof L.LayerGroup)&&(!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&t.options.pmIgnore===!1)&&!t._pmTempLayer&&t.pm.options.draggable}},Yn=Xn,$n={_globalRemovalModeEnabled:!1,enableGlobalRemovalMode(){this._globalRemovalModeEnabled=!0,this.map.eachLayer(t=>{this._isRelevantForRemoval(t)&&(t.pm.enabled()&&t.pm.disable(),t.on("click",this.removeLayer,this))}),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.handleLayerAdditionInGlobalRemovalMode,100,this)),this._addedLayersRemoval={},this.map.on("layeradd",this._layerAddedRemoval,this),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!0)},disableGlobalRemovalMode(){this._globalRemovalModeEnabled=!1,this.map.eachLayer(t=>{t.off("click",this.removeLayer,this)}),this.map.off("layeradd",this._layerAddedRemoval,this),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!1)},globalRemovalEnabled(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled(){return!!this._globalRemovalModeEnabled},toggleGlobalRemovalMode(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},removeLayer(t){let e=t.target;this._isRelevantForRemoval(e)&&!e.pm.dragging()&&(e.removeFrom(this.map.pm._getContainingLayer()),e.remove(),e instanceof L.LayerGroup?(this._fireRemoveLayerGroup(e),this._fireRemoveLayerGroup(this.map,e)):(e.pm._fireRemove(e),e.pm._fireRemove(this.map,e)))},_isRelevantForRemoval(t){return t.pm&&!(t instanceof L.LayerGroup)&&(!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&t.options.pmIgnore===!1)&&!t._pmTempLayer&&t.pm.options.allowRemoval},handleLayerAdditionInGlobalRemovalMode(){let t=this._addedLayersRemoval;if(this._addedLayersRemoval={},this.globalRemovalModeEnabled())for(let e in t){let i=t[e];this._isRelevantForRemoval(i)&&(i.pm.enabled()&&i.pm.disable(),i.on("click",this.removeLayer,this))}},_layerAddedRemoval({layer:t}){this._addedLayersRemoval[L.stamp(t)]=t}},Zn=$n,Wn={_globalRotateModeEnabled:!1,enableGlobalRotateMode(){this._globalRotateModeEnabled=!0,L.PM.Utils.findLayers(this.map).filter(t=>t instanceof L.Polyline).forEach(t=>{this._isRelevantForRotate(t)&&t.pm.enableRotate()}),this.throttledReInitRotate||(this.throttledReInitRotate=L.Util.throttle(this.handleLayerAdditionInGlobalRotateMode,100,this)),this._addedLayersRotate={},this.map.on("layeradd",this._layerAddedRotate,this),this.map.on("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},disableGlobalRotateMode(){this._globalRotateModeEnabled=!1,L.PM.Utils.findLayers(this.map).filter(t=>t instanceof L.Polyline).forEach(t=>{t.pm.disableRotate()}),this.map.off("layeradd",this._layerAddedRotate,this),this.map.off("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},globalRotateModeEnabled(){return!!this._globalRotateModeEnabled},toggleGlobalRotateMode(){this.globalRotateModeEnabled()?this.disableGlobalRotateMode():this.enableGlobalRotateMode()},_isRelevantForRotate(t){return t.pm&&t instanceof L.Polyline&&!(t instanceof L.LayerGroup)&&(!L.PM.optIn&&!t.options.pmIgnore||L.PM.optIn&&t.options.pmIgnore===!1)&&!t._pmTempLayer&&t.pm.options.allowRotation},handleLayerAdditionInGlobalRotateMode(){let t=this._addedLayersRotate;if(this._addedLayersRotate={},this.globalRotateModeEnabled())for(let e in t){let i=t[e];this._isRelevantForRemoval(i)&&i.pm.enableRotate()}},_layerAddedRotate({layer:t}){this._addedLayersRotate[L.stamp(t)]=t}},Qn=Wn,ta=_t(we()),ea={_fireDrawStart(t="Draw",e={}){this.__fire(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer},t,e)},_fireDrawEnd(t="Draw",e={}){this.__fire(this._map,"pm:drawend",{shape:this._shape},t,e)},_fireCreate(t,e="Draw",i={}){this.__fire(this._map,"pm:create",{shape:this._shape,marker:t,layer:t},e,i)},_fireCenterPlaced(t="Draw",e={}){let i=t==="Draw"?this._layer:void 0,r=t!=="Draw"?this._layer:void 0;this.__fire(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:i,layer:r,latlng:this._layer.getLatLng()},t,e)},_fireCut(t,e,i,r="Draw",n={}){this.__fire(t,"pm:cut",{shape:this._shape,layer:e,originalLayer:i},r,n)},_fireEdit(t=this._layer,e="Edit",i={}){this.__fire(t,"pm:edit",{layer:this._layer,shape:this.getShape()},e,i)},_fireEnable(t="Edit",e={}){this.__fire(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()},t,e)},_fireDisable(t="Edit",e={}){this.__fire(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()},t,e)},_fireUpdate(t="Edit",e={}){this.__fire(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()},t,e)},_fireMarkerDragStart(t,e=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:e},i,r)},_fireMarkerDrag(t,e=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:e},i,r)},_fireMarkerDragEnd(t,e=void 0,i=void 0,r="Edit",n={}){this.__fire(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:t,shape:this.getShape(),indexPath:e,intersectionReset:i},r,n)},_fireDragStart(t="Edit",e={}){this.__fire(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()},t,e)},_fireDrag(t,e="Edit",i={}){this.__fire(this._layer,"pm:drag",{...t,shape:this.getShape()},e,i)},_fireDragEnd(t="Edit",e={}){this.__fire(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()},t,e)},_fireDragEnable(t="Edit",e={}){this.__fire(this._layer,"pm:dragenable",{layer:this._layer,shape:this.getShape()},t,e)},_fireDragDisable(t="Edit",e={}){this.__fire(this._layer,"pm:dragdisable",{layer:this._layer,shape:this.getShape()},t,e)},_fireRemove(t,e=t,i="Edit",r={}){this.__fire(t,"pm:remove",{layer:e,shape:this.getShape()},i,r)},_fireVertexAdded(t,e,i,r="Edit",n={}){this.__fire(this._layer,"pm:vertexadded",{layer:this._layer,workingLayer:this._layer,marker:t,indexPath:e,latlng:i,shape:this.getShape()},r,n)},_fireVertexRemoved(t,e,i="Edit",r={}){this.__fire(this._layer,"pm:vertexremoved",{layer:this._layer,marker:t,indexPath:e,shape:this.getShape()},i,r)},_fireVertexClick(t,e,i="Edit",r={}){this.__fire(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:t,indexPath:e,shape:this.getShape()},i,r)},_fireIntersect(t,e=this._layer,i="Edit",r={}){this.__fire(e,"pm:intersect",{layer:this._layer,intersection:t,shape:this.getShape()},i,r)},_fireLayerReset(t,e,i="Edit",r={}){this.__fire(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:t,indexPath:e,shape:this.getShape()},i,r)},_fireChange(t,e="Edit",i={}){this.__fire(this._layer,"pm:change",{layer:this._layer,latlngs:t,shape:this.getShape()},e,i)},_fireTextChange(t,e="Edit",i={}){this.__fire(this._layer,"pm:textchange",{layer:this._layer,text:t,shape:this.getShape()},e,i)},_fireTextFocus(t="Edit",e={}){this.__fire(this._layer,"pm:textfocus",{layer:this._layer,shape:this.getShape()},t,e)},_fireTextBlur(t="Edit",e={}){this.__fire(this._layer,"pm:textblur",{layer:this._layer,shape:this.getShape()},t,e)},_fireSnapDrag(t,e,i="Snapping",r={}){this.__fire(t,"pm:snapdrag",e,i,r)},_fireSnap(t,e,i="Snapping",r={}){this.__fire(t,"pm:snap",e,i,r)},_fireUnsnap(t,e,i="Snapping",r={}){this.__fire(t,"pm:unsnap",e,i,r)},_fireRotationEnable(t,e,i="Rotation",r={}){this.__fire(t,"pm:rotateenable",{layer:this._layer,helpLayer:this._rotatePoly,shape:this.getShape()},i,r)},_fireRotationDisable(t,e="Rotation",i={}){this.__fire(t,"pm:rotatedisable",{layer:this._layer,shape:this.getShape()},e,i)},_fireRotationStart(t,e,i="Rotation",r={}){this.__fire(t,"pm:rotatestart",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:this._startAngle,originLatLngs:e},i,r)},_fireRotation(t,e,i,r=this._rotationLayer,n="Rotation",a={}){this.__fire(t,"pm:rotate",{layer:r,helpLayer:this._layer,startAngle:this._startAngle,angle:r.pm.getAngle(),angleDiff:e,oldLatLngs:i,newLatLngs:r.getLatLngs()},n,a)},_fireRotationEnd(t,e,i,r="Rotation",n={}){this.__fire(t,"pm:rotateend",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:e,angle:this._rotationLayer.pm.getAngle(),originLatLngs:i,newLatLngs:this._rotationLayer.getLatLngs()},r,n)},_fireActionClick(t,e,i,r="Toolbar",n={}){this.__fire(this._map,"pm:actionclick",{text:t.text,action:t,btnName:e,button:i},r,n)},_fireButtonClick(t,e,i="Toolbar",r={}){this.__fire(this._map,"pm:buttonclick",{btnName:t,button:e},i,r)},_fireLangChange(t,e,i,r,n="Global",a={}){this.__fire(this.map,"pm:langchange",{oldLang:t,activeLang:e,fallback:i,translations:r},n,a)},_fireGlobalDragModeToggled(t,e="Global",i={}){this.__fire(this.map,"pm:globaldragmodetoggled",{enabled:t,map:this.map},e,i)},_fireGlobalEditModeToggled(t,e="Global",i={}){this.__fire(this.map,"pm:globaleditmodetoggled",{enabled:t,map:this.map},e,i)},_fireGlobalRemovalModeToggled(t,e="Global",i={}){this.__fire(this.map,"pm:globalremovalmodetoggled",{enabled:t,map:this.map},e,i)},_fireGlobalCutModeToggled(t="Global",e={}){this.__fire(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map},t,e)},_fireGlobalDrawModeToggled(t="Global",e={}){this.__fire(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map},t,e)},_fireGlobalRotateModeToggled(t="Global",e={}){this.__fire(this.map,"pm:globalrotatemodetoggled",{enabled:this.globalRotateModeEnabled(),map:this.map},t,e)},_fireRemoveLayerGroup(t,e=t,i="Edit",r={}){this.__fire(t,"pm:remove",{layer:e,shape:void 0},i,r)},_fireKeyeventEvent(t,e,i,r="Global",n={}){this.__fire(this.map,"pm:keyevent",{event:t,eventType:e,focusOn:i},r,n)},__fire(t,e,i,r,n={}){i=(0,ta.default)(i,n,{source:r}),L.PM.Utils._fireEvent(t,e,i)}},ee=ea,ia=()=>({_lastEvents:{keydown:void 0,keyup:void 0,current:void 0},_initKeyListener(t){this.map=t,L.DomEvent.on(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.on(window,"blur",this._onBlur,this),t.once("unload",this._unbindKeyListenerEvents,this)},_unbindKeyListenerEvents(){L.DomEvent.off(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.off(window,"blur",this._onBlur,this)},_onKeyListener(t){let e="document";this.map.getContainer().contains(t.target)&&(e="map");let i={event:t,eventType:t.type,focusOn:e};this._lastEvents[t.type]=i,this._lastEvents.current=i,this.map.pm._fireKeyeventEvent(t,t.type,e)},_onBlur(t){t.altKey=!1;let e={event:t,eventType:t.type,focusOn:"document"};this._lastEvents[t.type]=e,this._lastEvents.current=e},getLastKeyEvent(t="current"){return this._lastEvents[t]},isShiftKeyPressed(){return this._lastEvents.current?.event.shiftKey},isAltKeyPressed(){return this._lastEvents.current?.event.altKey},isCtrlKeyPressed(){return this._lastEvents.current?.event.ctrlKey},isMetaKeyPressed(){return this._lastEvents.current?.event.metaKey},getPressedKey(){return this._lastEvents.current?.event.key}}),ra=ia,fi=_t(te());function U(t){let e=L.PM.activeLang;return(0,fi.default)(jt[e],t)||(0,fi.default)(jt.en,t)||t}function Pe(t){for(let e=0;e<t.length;e+=1){let i=t[e];if(Array.isArray(i)){if(Pe(i))return!0}else if(i!=null&&i!=="")return!0}return!1}function ie(t){return t.reduce((e,i)=>{if(i.length!==0){let r=Array.isArray(i)?ie(i):i;Array.isArray(r)?r.length!==0&&e.push(r):e.push(r)}return e},[])}function na(t,e,i){let r={a:L.CRS.Earth.R,b:63567523142e-4,f:.0033528106647474805},{a:n,b:a,f:s}=r,o=t.lng,u=t.lat,h=i,y=Math.PI,_=e*y/180,w=Math.sin(_),A=Math.cos(_),T=(1-s)*Math.tan(u*y/180),R=1/Math.sqrt(1+T*T),I=T*R,z=Math.atan2(T,A),m=R*w,v=1-m*m,M=v*(n*n-a*a)/(a*a),P=1+M/16384*(4096+M*(-768+M*(320-175*M))),E=M/1024*(256+M*(-128+M*(74-47*M))),D=h/(a*P),l=2*Math.PI,p,d,c;for(;Math.abs(D-l)>1e-12;){p=Math.cos(2*z+D),d=Math.sin(D),c=Math.cos(D);let F=E*d*(p+E/4*(c*(-1+2*p*p)-E/6*p*(-3+4*d*d)*(-3+4*p*p)));l=D,D=h/(a*P)+F}let g=I*d-R*c*A,f=Math.atan2(I*c+R*d*A,(1-s)*Math.sqrt(m*m+g*g)),b=Math.atan2(d*w,R*c-I*d*A),C=s/16*v*(4+s*(4-3*v)),k=b-(1-C)*s*m*(D+C*d*(p+C*c*(-1+2*p*p))),x=o+k*180/y,B=f*180/y;return L.latLng(x,B)}function _i(t,e,i,r,n=!0){let a,s,o,u=[];for(let h=0;h<i;h+=1){if(n)a=h*360/i+r,s=na(t,a,e),o=L.latLng(s.lng,s.lat);else{let y=t.lat+Math.cos(2*h*Math.PI/i)*e,_=t.lng+Math.sin(2*h*Math.PI/i)*e;o=L.latLng(y,_)}u.push(o)}return u}function aa(t,e,i){e=(e+360)%360;let r=Math.PI/180,n=180/Math.PI,{R:a}=L.CRS.Earth,s=t.lng*r,o=t.lat*r,u=e*r,h=Math.sin(o),y=Math.cos(o),_=Math.cos(i/a),w=Math.sin(i/a),A=Math.asin(h*_+y*w*Math.cos(u)),T=s+Math.atan2(Math.sin(u)*w*y,_-h*Math.sin(A));T*=n;let R=T-360,I=T<-180?T+360:T;return T=T>180?R:I,L.latLng([A*n,T])}function Ae(t,e,i){let r=t.latLngToContainerPoint(e),n=t.latLngToContainerPoint(i),a=Math.atan2(n.y-r.y,n.x-r.x)*180/Math.PI+90;return a+=a<0?360:0,a}function re(t,e,i,r){let n=Ae(t,e,i);return aa(e,n,r)}function sa(t,e,i="asc"){if(!e||Object.keys(e).length===0)return(u,h)=>u-h;let r=Object.keys(e),n,a=r.length-1,s={};for(;a>=0;)n=r[a],s[n.toLowerCase()]=e[n],a-=1;function o(u){if(u instanceof L.Marker)return"Marker";if(u instanceof L.Circle)return"Circle";if(u instanceof L.CircleMarker)return"CircleMarker";if(u instanceof L.Rectangle)return"Rectangle";if(u instanceof L.Polygon)return"Polygon";if(u instanceof L.Polyline)return"Line"}return(u,h)=>{let y,_;if(y=o(u.layer).toLowerCase(),_=o(h.layer).toLowerCase(),!y||!_)return 0;let w=y in s?s[y]:Number.MAX_SAFE_INTEGER,A=_ in s?s[_]:Number.MAX_SAFE_INTEGER,T=0;return w<A?T=-1:w>A&&(T=1),i==="desc"?T*-1:T}}function Ct(t,e=t.getLatLngs()){return t instanceof L.Polygon?L.polygon(e).getLatLngs():L.polyline(e).getLatLngs()}function mi(t,e){if(e.options.crs?.projection?.MAX_LATITUDE){let i=e.options.crs?.projection?.MAX_LATITUDE;t.lat=Math.max(Math.min(i,t.lat),-i)}return t}function At(t){return t.options.renderer||t._map&&(t._map._getPaneRenderer(t.options.pane)||t._map.options.renderer||t._map._renderer)||t._renderer}var oa=L.Class.extend({includes:[Jn,Yn,Zn,Qn,ee],initialize(t){this.map=t,this.Draw=new L.PM.Draw(t),this.Toolbar=new L.PM.Toolbar(t),this.Keyboard=ra(),this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"},draggable:!0},this.Keyboard._initKeyListener(t)},setLang(t="en",e,i="en"){let r=L.PM.activeLang;e&&(jt[t]=(0,gi.default)(jt[i],e)),L.PM.activeLang=t,this.map.pm.Toolbar.reinit(),this._fireLangChange(r,t,i,jt[t])},addControls(t){this.Toolbar.addControls(t)},removeControls(){this.Toolbar.removeControls()},toggleControls(){this.Toolbar.toggleControls()},controlsVisible(){return this.Toolbar.isVisible},enableDraw(t="Polygon",e){t==="Poly"&&(t="Polygon"),this.Draw.enable(t,e)},disableDraw(t="Polygon"){t==="Poly"&&(t="Polygon"),this.Draw.disable(t)},setPathOptions(t,e={}){let i=e.ignoreShapes||[],r=e.merge||!1;this.map.pm.Draw.shapes.forEach(n=>{i.indexOf(n)===-1&&this.map.pm.Draw[n].setPathOptions(t,r)})},getGlobalOptions(){return this.globalOptions},setGlobalOptions(t){let e=(0,gi.default)(this.globalOptions,t);e.editable&&(e.resizeableCircleMarker=e.editable,delete e.editable);let i=!1;this.map.pm.Draw.CircleMarker.enabled()&&!!this.map.pm.Draw.CircleMarker.options.resizeableCircleMarker!=!!e.resizeableCircleMarker&&(this.map.pm.Draw.CircleMarker.disable(),i=!0);let r=!1;this.map.pm.Draw.Circle.enabled()&&!!this.map.pm.Draw.Circle.options.resizableCircle!=!!e.resizableCircle&&(this.map.pm.Draw.Circle.disable(),r=!0),this.map.pm.Draw.shapes.forEach(n=>{this.map.pm.Draw[n].setOptions(e)}),i&&this.map.pm.Draw.CircleMarker.enable(),r&&this.map.pm.Draw.Circle.enable(),L.PM.Utils.findLayers(this.map).forEach(n=>{n.pm.setOptions(e)}),this.map.fire("pm:globaloptionschanged"),this.globalOptions=e,this.applyGlobalOptions()},applyGlobalOptions(){L.PM.Utils.findLayers(this.map).forEach(t=>{t.pm.enabled()&&t.pm.applyOptions()})},globalDrawModeEnabled(){return!!this.Draw.getActiveShape()},globalCutModeEnabled(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode(t){return this.Draw.Cut.enable(t)},toggleGlobalCutMode(t){return this.Draw.Cut.toggle(t)},disableGlobalCutMode(){return this.Draw.Cut.disable()},getGeomanLayers(t=!1){let e=L.PM.Utils.findLayers(this.map);if(!t)return e;let i=L.featureGroup();return i._pmTempLayer=!0,e.forEach(r=>{i.addLayer(r)}),i},getGeomanDrawLayers(t=!1){let e=L.PM.Utils.findLayers(this.map).filter(r=>r._drawnByGeoman===!0);if(!t)return e;let i=L.featureGroup();return i._pmTempLayer=!0,e.forEach(r=>{i.addLayer(r)}),i},_getContainingLayer(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map},_isCRSSimple(){return this.map.options.crs===L.CRS.Simple},_touchEventCounter:0,_addTouchEvents(t){this._touchEventCounter===0&&(L.DomEvent.on(t,"touchmove",this._canvasTouchMove,this),L.DomEvent.on(t,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter+=1},_removeTouchEvents(t){this._touchEventCounter===1&&(L.DomEvent.off(t,"touchmove",this._canvasTouchMove,this),L.DomEvent.off(t,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter=this._touchEventCounter<=1?0:this._touchEventCounter-1},_canvasTouchMove(t){At(this.map)._onMouseMove(this._createMouseEvent("mousemove",t))},_canvasTouchClick(t){let e="";t.type==="touchstart"||t.type==="pointerdown"?e="mousedown":(t.type==="touchend"||t.type==="pointerup"||t.type==="touchcancel"||t.type==="pointercancel")&&(e="mouseup"),e&&At(this.map)._onClick(this._createMouseEvent(e,t))},_createMouseEvent(t,e){let i,r=e.touches[0]||e.changedTouches[0];try{i=new MouseEvent(t,{bubbles:e.bubbles,cancelable:e.cancelable,view:e.view,detail:r.detail,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,button:e.button,relatedTarget:e.relatedTarget})}catch{i=document.createEvent("MouseEvents"),i.initMouseEvent(t,e.bubbles,e.cancelable,e.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget)}return i}}),ua=oa,la=L.Control.extend({includes:[ee],options:{position:"topleft",disableByOtherButtons:!0},initialize(t){this._button=L.Util.extend({},this.options,t)},onAdd(t){return this._map=t,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):this._button.tool==="edit"?this._container=this._map.pm.Toolbar.editContainer:this._button.tool==="options"?this._container=this._map.pm.Toolbar.optionsContainer:this._button.tool==="custom"?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this._renderButton(),this._container},_renderButton(){let t=this.buttonsDomNode;this.buttonsDomNode=this._makeButton(this._button),t?t.replaceWith(this.buttonsDomNode):this._container.appendChild(this.buttonsDomNode)},onRemove(){return this.buttonsDomNode.remove(),this._container},getText(){return this._button.text},getIconUrl(){return this._button.iconUrl},destroy(){this._button={},this._update()},toggle(t){return typeof t=="boolean"?this._button.toggleStatus=t:this._button.toggleStatus=!this._button.toggleStatus,this._applyStyleClasses(),this._button.toggleStatus},toggled(){return this._button.toggleStatus},onCreate(){this.toggle(!1)},disable(){this.toggle(!1),this._button.disabled=!0,this._updateDisabled()},enable(){this._button.disabled=!1,this._updateDisabled()},_triggerClick(t){t&&t.preventDefault(),!this._button.disabled&&(this._button.onClick(t,{button:this,event:t}),this._clicked(t),this._button.afterClick(t,{button:this,event:t}))},_makeButton(t){let e=this.options.position.indexOf("right")>-1?"pos-right":"",i=L.DomUtil.create("div",`button-container  ${e}`,this._container);t.title&&i.setAttribute("title",t.title);let r=L.DomUtil.create("a","leaflet-buttons-control-button",i);r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.href="#";let n=L.DomUtil.create("div",`leaflet-pm-actions-container ${e}`,i),a=t.actions,s={cancel:{text:U("actions.cancel"),title:U("actions.cancel"),onClick(){this._triggerClick()}},finishMode:{text:U("actions.finish"),title:U("actions.finish"),onClick(){this._triggerClick()}},removeLastVertex:{text:U("actions.removeLastVertex"),title:U("actions.removeLastVertex"),onClick(){this._map.pm.Draw[t.jsClass]._removeLastVertex()}},finish:{text:U("actions.finish"),title:U("actions.finish"),onClick(u){this._map.pm.Draw[t.jsClass]._finishShape(u)}}};a.forEach(u=>{let h=typeof u=="string"?u:u.name,y;if(s[h])y=s[h];else if(u.text)y=u;else return;let _=L.DomUtil.create("a",`leaflet-pm-action ${e} action-${h}`,n);if(_.setAttribute("role","button"),_.setAttribute("tabindex","0"),_.href="#",y.title&&(_.title=y.title),_.innerHTML=y.text,L.DomEvent.disableClickPropagation(_),L.DomEvent.on(_,"click",L.DomEvent.stop),!t.disabled&&y.onClick){let w=A=>{A.preventDefault();let T="",{buttons:R}=this._map.pm.Toolbar;for(let I in R)if(R[I]._button===t){T=I;break}this._fireActionClick(y,T,t)};L.DomEvent.addListener(_,"click",w,this),L.DomEvent.addListener(_,"click",y.onClick,this)}}),t.toggleStatus&&L.DomUtil.addClass(i,"active");let o=L.DomUtil.create("div","control-icon",r);return t.iconUrl&&o.setAttribute("src",t.iconUrl),t.className&&L.DomUtil.addClass(o,t.className),L.DomEvent.disableClickPropagation(r),L.DomEvent.on(r,"click",L.DomEvent.stop),t.disabled||(L.DomEvent.addListener(r,"click",this._onBtnClick,this),L.DomEvent.addListener(r,"click",this._triggerClick,this)),t.disabled&&(L.DomUtil.addClass(r,"pm-disabled"),r.setAttribute("aria-disabled","true")),i},_applyStyleClasses(){this._container&&(!this._button.toggleStatus||this._button.cssToggle===!1?(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")):(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")))},_onBtnClick(){if(this._button.disabled)return;this._button.disableOtherButtons&&this._map.pm.Toolbar.triggerClickOnToggledButtons(this);let t="",{buttons:e}=this._map.pm.Toolbar;for(let i in e)if(e[i]._button===this._button){t=i;break}this._fireButtonClick(t,this._button)},_clicked(){this._button.doToggle&&this.toggle()},_updateDisabled(){if(!this._container)return;let t="pm-disabled",e=this.buttonsDomNode.children[0];this._button.disabled?(L.DomUtil.addClass(e,t),e.setAttribute("aria-disabled","true")):(L.DomUtil.removeClass(e,t),e.setAttribute("aria-disabled","false"))}}),ha=la;L.Control.PMButton=ha;var pa=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,drawText:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,rotateMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize(t){this.customButtons=[],this.options.positions={draw:"",edit:"",options:"",custom:""},this.init(t)},reinit(){let t=this.isVisible;this.removeControls(),this._defineButtons(),t&&this.addControls()},init(t){this.map=t,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer(t){let e=`${t}Container`;return this[e]||(this[e]=L.DomUtil.create("div",`leaflet-pm-toolbar leaflet-pm-${t} leaflet-bar leaflet-control`)),this[e]},getButtons(){return this.buttons},addControls(t=this.options){typeof t.editPolygon<"u"&&(t.editMode=t.editPolygon),typeof t.deleteLayer<"u"&&(t.removalMode=t.deleteLayer),L.Util.setOptions(this,t),this.applyIconStyle(),this.isVisible=!0,this._showHideButtons()},applyIconStyle(){let t=this.getButtons(),e={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete",drawText:"control-icon leaflet-pm-icon-text"}};for(let i in t){let r=t[i];L.Util.setOptions(r,{className:e.geomanIcons[i]})}},removeControls(){let t=this.getButtons();for(let e in t)t[e].remove();this.isVisible=!1},toggleControls(t=this.options){this.isVisible?this.removeControls():this.addControls(t)},_addButton(t,e){return this.buttons[t]=e,this.options[t]=!!this.options[t]||!1,this.buttons[t]},triggerClickOnToggledButtons(t){for(let e in this.buttons){let i=this.buttons[e];i._button.disableByOtherButtons&&i!==t&&i.toggled()&&i._triggerClick()}},toggleButton(t,e,i=!0){return t==="editPolygon"&&(t="editMode"),t==="deleteLayer"&&(t="removalMode"),i&&this.triggerClickOnToggledButtons(this.buttons[t]),this.buttons[t]?this.buttons[t].toggle(e):!1},_defineButtons(){let t={className:"control-icon leaflet-pm-icon-marker",title:U("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},e={title:U("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},i={className:"control-icon leaflet-pm-icon-polyline",title:U("buttonTitles.drawLineButton"),jsClass:"Line",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},r={title:U("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},n={title:U("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},a={title:U("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},s={title:U("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},o={title:U("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},u={title:U("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},h={title:U("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},y={title:U("buttonTitles.rotateButton"),className:"control-icon leaflet-pm-icon-rotate",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRotateMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},_={className:"control-icon leaflet-pm-icon-text",title:U("buttonTitles.drawTextButton"),jsClass:"Text",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]};this._addButton("drawMarker",new L.Control.PMButton(t)),this._addButton("drawPolyline",new L.Control.PMButton(i)),this._addButton("drawRectangle",new L.Control.PMButton(a)),this._addButton("drawPolygon",new L.Control.PMButton(e)),this._addButton("drawCircle",new L.Control.PMButton(r)),this._addButton("drawCircleMarker",new L.Control.PMButton(n)),this._addButton("drawText",new L.Control.PMButton(_)),this._addButton("editMode",new L.Control.PMButton(s)),this._addButton("dragMode",new L.Control.PMButton(o)),this._addButton("cutPolygon",new L.Control.PMButton(u)),this._addButton("removalMode",new L.Control.PMButton(h)),this._addButton("rotateMode",new L.Control.PMButton(y))},_showHideButtons(){if(!this.isVisible)return;this.removeControls(),this.isVisible=!0;let t=this.getButtons(),e=[];this.options.drawControls===!1&&(e=e.concat(Object.keys(t).filter(i=>!t[i]._button.tool))),this.options.editControls===!1&&(e=e.concat(Object.keys(t).filter(i=>t[i]._button.tool==="edit"))),this.options.optionsControls===!1&&(e=e.concat(Object.keys(t).filter(i=>t[i]._button.tool==="options"))),this.options.customControls===!1&&(e=e.concat(Object.keys(t).filter(i=>t[i]._button.tool==="custom")));for(let i in t)if(this.options[i]&&e.indexOf(i)===-1){let r=t[i]._button.tool;r||(r="draw"),t[i].setPosition(this._getBtnPosition(r)),t[i].addTo(this.map)}},_getBtnPosition(t){return this.options.positions&&this.options.positions[t]?this.options.positions[t]:this.options.position},setBlockPosition(t,e){this.options.positions[t]=e,this._showHideButtons(),this.changeControlOrder()},getBlockPositions(){return this.options.positions},copyDrawControl(t,e){if(e)typeof e!="object"&&(e={name:e});else throw new TypeError("Button has no name");let i=this._btnNameMapping(t);if(!e.name)throw new TypeError("Button has no name");if(this.buttons[e.name])throw new TypeError("Button with this name already exists");let r=this.map.pm.Draw.createNewDrawInstance(e.name,i);e={...this.buttons[i]._button,...e};let n=this.createCustomControl(e);return{drawInstance:r,control:n}},createCustomControl(t){if(!t.name)throw new TypeError("Button has no name");if(this.buttons[t.name])throw new TypeError("Button with this name already exists");t.onClick||(t.onClick=()=>{}),t.afterClick||(t.afterClick=()=>{}),t.toggle!==!1&&(t.toggle=!0),t.block&&(t.block=t.block.toLowerCase()),(!t.block||t.block==="draw")&&(t.block=""),t.className?t.className.indexOf("control-icon")===-1&&(t.className=`control-icon ${t.className}`):t.className="control-icon";let e={tool:t.block,className:t.className,title:t.title||"",jsClass:t.name,onClick:t.onClick,afterClick:t.afterClick,doToggle:t.toggle,toggleStatus:!1,disableOtherButtons:t.disableOtherButtons??!0,disableByOtherButtons:t.disableByOtherButtons??!0,cssToggle:t.toggle,position:this.options.position,actions:t.actions||[],disabled:!!t.disabled};this.options[t.name]!==!1&&(this.options[t.name]=!0);let i=this._addButton(t.name,new L.Control.PMButton(e));return this.changeControlOrder(),i},controlExists(t){return!!this.getButton(t)},getButton(t){return this.getButtons()[t]},getButtonsInBlock(t){let e={};if(t)for(let i in this.getButtons()){let r=this.getButtons()[i];(r._button.tool===t||t==="draw"&&!r._button.tool)&&(e[i]=r)}return e},changeControlOrder(t=[]){let e=this._shapeMapping(),i=[];t.forEach(a=>{e[a]?i.push(e[a]):i.push(a)});let r=this.getButtons(),n={};i.forEach(a=>{r[a]&&(n[a]=r[a])}),Object.keys(r).filter(a=>!r[a]._button.tool).forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="edit").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="options").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="custom").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),this.map.pm.Toolbar.buttons=n,this._showHideButtons()},getControlOrder(){let t=this.getButtons(),e=[];for(let i in t)e.push(i);return e},changeActionsOfControl(t,e){let i=this._btnNameMapping(t);if(!i)throw new TypeError("No name passed");if(!e)throw new TypeError("No actions passed");if(!this.buttons[i])throw new TypeError("Button with this name not exists");this.buttons[i]._button.actions=e,this.changeControlOrder()},setButtonDisabled(t,e){let i=this._btnNameMapping(t);e?this.buttons[i].disable():this.buttons[i].enable()},_shapeMapping(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode",Rotate:"rotateMode",Text:"drawText"}},_btnNameMapping(t){let e=this._shapeMapping();return e[t]?e[t]:t}}),ca=pa,da=_t(we()),ga={_initSnappableMarkers(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents(t){t.forEach(e=>{if(Array.isArray(e)){this._assignEvents(e);return}e.off("drag",this._handleSnapping,this),e.on("drag",this._handleSnapping,this),e.off("dragend",this._cleanupSnapping,this),e.on("dragend",this._cleanupSnapping,this)})},_cleanupSnapping(t){if(t){let e=t.target;e._snapped=!1}delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("layerremove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach(e=>{e.remove()})},_handleThrottleSnapping(){this.throttledList&&this._createSnapList()},_handleSnapping(t){let e=t.target;if(e._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),t?.originalEvent?.altKey||this._map?.pm?.Keyboard.isAltKeyPressed()||(this._snapList===void 0&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0))return!1;let i=this._calcClosestLayer(e.getLatLng(),this._snapList);if(Object.keys(i).length===0)return!1;let r=i.layer instanceof L.Marker||i.layer instanceof L.CircleMarker||!this.options.snapSegment,n;r?n=i.latlng:n=this._checkPrioritiySnapping(i);let a=this.options.snapDistance,s={marker:e,shape:this._shape,snapLatLng:n,segment:i.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:i.layer,distance:i.distance};if(this._fireSnapDrag(s.marker,s),this._fireSnapDrag(this._layer,s),i.distance<a){e._orgLatLng=e.getLatLng(),e.setLatLng(n),e._snapped=!0,e._snapInfo=s;let o=()=>{this._snapLatLng=n,this._fireSnap(e,s),this._fireSnap(this._layer,s)},u=this._snapLatLng||{},h=n||{};(u.lat!==h.lat||u.lng!==h.lng)&&o()}else this._snapLatLng&&(this._unsnap(s),e._snapped=!1,e._snapInfo=void 0,this._fireUnsnap(s.marker,s),this._fireUnsnap(this._layer,s));return!0},_createSnapList(){let t=[],e=[],i=this._map;i.off("layerremove",this._handleSnapLayerRemoval,this),i.on("layerremove",this._handleSnapLayerRemoval,this),i.eachLayer(r=>{if((r instanceof L.Polyline||r instanceof L.Marker||r instanceof L.CircleMarker||r instanceof L.ImageOverlay)&&r.options.snapIgnore!==!0){if(r.options.snapIgnore===void 0&&(!L.PM.optIn&&r.options.pmIgnore===!0||L.PM.optIn&&r.options.pmIgnore!==!1))return;(r instanceof L.Circle||r instanceof L.CircleMarker)&&r.pm&&r.pm._hiddenPolyCircle?t.push(r.pm._hiddenPolyCircle):r instanceof L.ImageOverlay&&(r=L.rectangle(r.getBounds())),t.push(r);let n=L.polyline([],{color:"red",pmIgnore:!0});n._pmTempLayer=!0,e.push(n),(r instanceof L.Circle||r instanceof L.CircleMarker)&&e.push(n)}}),t=t.filter(r=>this._layer!==r),t=t.filter(r=>r._latlng||r._latlngs&&Pe(r._latlngs)),t=t.filter(r=>!r._pmTempLayer),this._otherSnapLayers?(this._otherSnapLayers.forEach(()=>{let r=L.polyline([],{color:"red",pmIgnore:!0});r._pmTempLayer=!0,e.push(r)}),this._snapList=t.concat(this._otherSnapLayers)):this._snapList=t,this.debugIndicatorLines=e},_handleSnapLayerRemoval({layer:t}){if(!t._leaflet_id)return;let e=this._snapList.findIndex(i=>i._leaflet_id===t._leaflet_id);e>-1&&this._snapList.splice(e,1)},_calcClosestLayer(t,e){return this._calcClosestLayers(t,e,1)[0]},_calcClosestLayers(t,e,i=1){let r=[],n={};e.forEach((s,o)=>{if(s._parentCopy&&s._parentCopy===this._layer)return;let u=this._calcLayerDistances(t,s);if(u.distance=Math.floor(u.distance),this.debugIndicatorLines){if(!this.debugIndicatorLines[o]){let h=L.polyline([],{color:"red",pmIgnore:!0});h._pmTempLayer=!0,this.debugIndicatorLines[o]=h}this.debugIndicatorLines[o].setLatLngs([t,u.latlng])}i===1&&(n.distance===void 0||u.distance-5<=n.distance)?(u.distance+5<n.distance&&(r=[]),n=u,n.layer=s,r.push(n)):i!==1&&(n={},n=u,n.layer=s,r.push(n))}),i!==1&&(r=r.sort((s,o)=>s.distance-o.distance)),i===-1&&(i=r.length);let a=this._getClosestLayerByPriority(r,i);return L.Util.isArray(a)?a:[a]},_calcLayerDistances(t,e){let i=this._map,r=e instanceof L.Marker||e instanceof L.CircleMarker,n=e instanceof L.Polygon,a=t;if(r){let s=e.getLatLng();return{latlng:{...s},distance:this._getDistance(i,s,a)}}return this._calcLatLngDistances(a,e.getLatLngs(),i,n)},_calcLatLngDistances(t,e,i,r=!1){let n,a,s,o=u=>{u.forEach((h,y)=>{if(Array.isArray(h)){o(h);return}if(this.options.snapSegment){let _=h,w;r?w=y+1===u.length?0:y+1:w=y+1===u.length?void 0:y+1;let A=u[w];if(A){let T=this._getDistanceToSegment(i,t,_,A);(a===void 0||T<a)&&(a=T,s=[_,A])}}else{let _=this._getDistance(i,t,h);(a===void 0||_<a)&&(a=_,n=h)}})};return o(e),this.options.snapSegment?{latlng:{...this._getClosestPointOnSegment(i,t,s[0],s[1])},segment:s,distance:a}:{latlng:n,distance:a}},_getClosestLayerByPriority(t,e=1){t=t.sort((s,o)=>s._leaflet_id-o._leaflet_id);let i=["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],r=this._map.pm.globalOptions.snappingOrder||[],n=0,a={};return r.concat(i).forEach(s=>{a[s]||(n+=1,a[s]=n)}),t.sort(sa("instanceofShape",a)),e===1?t[0]||{}:t.slice(0,e)},_checkPrioritiySnapping(t){let e=this._map,i=t.segment[0],r=t.segment[1],n=t.latlng,a=this._getDistance(e,i,n),s=this._getDistance(e,r,n),o=a<s?i:r,u=a<s?a:s;if(this.options.snapMiddle){let _=L.PM.Utils.calcMiddleLatLng(e,i,r),w=this._getDistance(e,_,n);w<a&&w<s&&(o=_,u=w)}let h=this.options.snapDistance,y;return u<h?y=o:y=n,{...y}},_unsnap(){delete this._snapLatLng},_getClosestPointOnSegment(t,e,i,r){let n=t.getMaxZoom();n===1/0&&(n=t.getZoom());let a=t.project(e,n),s=t.project(i,n),o=t.project(r,n),u=L.LineUtil.closestPointOnSegment(a,s,o);return t.unproject(u,n)},_getDistanceToSegment(t,e,i,r){let n=t.latLngToLayerPoint(e),a=t.latLngToLayerPoint(i),s=t.latLngToLayerPoint(r);return L.LineUtil.pointToSegmentDistance(n,a,s)},_getDistance(t,e,i){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(i))}},yi=ga,fa=L.Class.extend({includes:[yi,ee],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,resizeableCircleMarker:!1,resizableCircle:!0,markerEditable:!0,continueDrawing:!1,snapSegment:!0,requireSnapToFinish:!1,rectangleAngle:0},setOptions(t){L.Util.setOptions(this,t),this.setStyle(this.options)},setStyle(){},getOptions(){return this.options},initialize(t){let e=new L.Icon.Default;e.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=e,this._map=t,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut","Text"],this.shapes.forEach(i=>{this[i]=new L.PM.Draw[i](this._map)}),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions(t,e=!1){e?this.options.pathOptions=(0,da.default)(this.options.pathOptions,t):this.options.pathOptions=t},getShapes(){return this.shapes},getShape(){return this._shape},enable(t,e){if(!t)throw new Error(`Error: Please pass a shape as a parameter. Possible shapes are: ${this.getShapes().join(",")}`);this.disable(),this[t].enable(e)},disable(){this.shapes.forEach(t=>{this[t].disable()})},addControls(){this.shapes.forEach(t=>{this[t].addButton()})},getActiveShape(){let t;return this.shapes.forEach(e=>{this[e]._enabled&&(t=e)}),t},_setGlobalDrawMode(){this._shape==="Cut"?this._fireGlobalCutModeToggled():this._fireGlobalDrawModeToggled();let t=[];this._map.eachLayer(e=>{(e instanceof L.Polyline||e instanceof L.Marker||e instanceof L.Circle||e instanceof L.CircleMarker||e instanceof L.ImageOverlay)&&(e._pmTempLayer||t.push(e))}),this._enabled?t.forEach(e=>{L.PM.Utils.disablePopup(e)}):t.forEach(e=>{L.PM.Utils.enablePopup(e)})},createNewDrawInstance(t,e){let i=this._getShapeFromBtnName(e);if(this[t])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[i])throw new TypeError(`There is no class L.PM.Draw.${i}`);return this[t]=new L.PM.Draw[i](this._map),this[t].toolbarButtonName=t,this[t]._shape=t,this.shapes.push(t),this[e]&&this[t].setOptions(this[e].options),this[t].setOptions(this[t].options),this[t]},_getShapeFromBtnName(t){let e={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal",rotateMode:"Rotate",drawText:"Text"};return e[t]?e[t]:this[t]?this[t]._shape:t},_finishLayer(t){t.pm&&(t.pm.setOptions(this.options),t.pm._shape=this._shape,t.pm._map=this._map),this._addDrawnLayerProp(t)},_addDrawnLayerProp(t){t._drawnByGeoman=!0},_setPane(t,e){e==="layerPane"?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":e==="vertexPane"?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":e==="markerPane"&&(t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer(){return(this._map||this._layer._map).pm.getGeomanLayers().length===0}}),Z=fa;Z.Marker=Z.extend({initialize(t){this._map=t,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable(t){L.Util.setOptions(this,t),this._enabled=!0,this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.enable()}),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.disable()}),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(t){this.enabled()?this.disable():this.enable(t)},isRelevantMarker(t){return t instanceof L.Marker&&t.pm&&!t._pmTempLayer&&!t.pm._initTextMarker},_syncHintMarker(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){let e=t;e.target=this._hintMarker,this._handleSnapping(e)}this._fireChange(this._hintMarker.getLatLng(),"Draw")},_createMarker(t){if(!t.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng(),i=new L.Marker(e,this.options.markerStyle);this._setPane(i,"markerPane"),this._finishLayer(i),i.pm||(i.options.draggable=!1),i.addTo(this._map.pm._getContainingLayer()),i.pm&&this.options.markerEditable?i.pm.enable():i.dragging&&i.dragging.disable(),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},setStyle(){this.options.markerStyle?.icon&&this._hintMarker?.setIcon(this.options.markerStyle.icon)}});var et=63710088e-1,Li={centimeters:et*100,centimetres:et*100,degrees:et/111325,feet:et*3.28084,inches:et*39.37,kilometers:et/1e3,kilometres:et/1e3,meters:et,metres:et,miles:et/1609.344,millimeters:et*1e3,millimetres:et*1e3,nauticalmiles:et/1852,radians:1,yards:et*1.0936};function St(t,e,i){i===void 0&&(i={});var r={type:"Feature"};return(i.id===0||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=t,r}function Ft(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vi(t[0])||!vi(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return St(r,e,i)}function Nt(t,e,i){if(i===void 0&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return St(r,e,i)}function bt(t,e){e===void 0&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function _a(t,e){e===void 0&&(e="kilometers");var i=Li[e];if(!i)throw new Error(e+" units is invalid");return t*i}function ma(t,e){e===void 0&&(e="kilometers");var i=Li[e];if(!i)throw new Error(e+" units is invalid");return t/i}function Se(t){var e=t%(2*Math.PI);return e*180/Math.PI}function ut(t){var e=t%360;return e*Math.PI/180}function vi(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function ne(t){var e,i,r={type:"FeatureCollection",features:[]};if(t.type==="Feature"?i=t.geometry:i=t,i.type==="LineString")e=[i.coordinates];else if(i.type==="MultiLineString")e=i.coordinates;else if(i.type==="MultiPolygon")e=[].concat.apply([],i.coordinates);else if(i.type==="Polygon")e=i.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return e.forEach(function(n){e.forEach(function(a){for(var s=0;s<n.length-1;s++)for(var o=s;o<a.length-1;o++)if(!(n===a&&(Math.abs(s-o)===1||s===0&&o===n.length-2&&n[s][0]===n[n.length-1][0]&&n[s][1]===n[n.length-1][1]))){var u=ya(n[s][0],n[s][1],n[s+1][0],n[s+1][1],a[o][0],a[o][1],a[o+1][0],a[o+1][1]);u&&r.features.push(Ft([u[0],u[1]]))}})}),r}function ya(t,e,i,r,n,a,s,o){var u,h,y,_,w,A={x:null,y:null,onLine1:!1,onLine2:!1};return u=(o-a)*(i-t)-(s-n)*(r-e),u===0?A.x!==null&&A.y!==null?A:!1:(h=e-a,y=t-n,_=(s-n)*h-(o-a)*y,w=(i-t)*h-(r-e)*y,h=_/u,y=w/u,A.x=t+h*(i-t),A.y=e+h*(r-e),h>=0&&h<=1&&(A.onLine1=!0),y>=0&&y<=1&&(A.onLine2=!0),A.onLine1&&A.onLine2?[A.x,A.y]:!1)}Z.Line=Z.extend({initialize(t){this._map=t,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable(t){L.Util.setOptions(this,t),this._enabled=!0,this._markers=[],this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],{...this.options.templineStyle,pmIgnore:!1}),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createVertex,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.on(this.options.finishOn,this._finishShape,this),this.options.finishOn==="dblclick"&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this.isRed=!1,this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(t){this.enabled()?this.disable():this.enable(t)},_syncHintLine(){let t=this._layer.getLatLngs();if(t.length>0){let e=t[t.length-1];this._hintline.setLatLngs([e,this._hintMarker.getLatLng()])}},_syncHintMarker(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){let i=t;i.target=this._hintMarker,this._handleSnapping(i)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,this._hintMarker.getLatLng());let e=this._layer._defaultShape().slice();e.push(this._hintMarker.getLatLng()),this._change(e)},hasSelfIntersection(){return ne(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersection(t,e){let i=L.polyline(this._layer.getLatLngs());t&&(e||(e=this._hintMarker.getLatLng()),i.addLatLng(e));let r=ne(i.toGeoJSON(15));this._doesSelfIntersect=r.features.length>0,this._doesSelfIntersect?this.isRed||(this.isRed=!0,this._hintline.setStyle({color:"#f00000ff"}),this._fireIntersect(r,this._map,"Draw")):this._hintline.isEmpty()||(this.isRed=!1,this._hintline.setStyle(this.options.hintlineStyle))},_createVertex(t){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,t.latlng),this._doesSelfIntersect))return;this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng(),i=this._layer.getLatLngs(),r=i[i.length-1];if(e.equals(i[0])||i.length>0&&e.equals(r)){this._finishShape();return}this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:e,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(e);let n=this._createMarker(e);this._setTooltipText(),this._setHintLineAfterNewVertex(e),this._fireVertexAdded(n,void 0,e,"Draw"),this._change(this._layer.getLatLngs()),this.options.finishOn==="snap"&&this._hintMarker._snapped&&this._finishShape(t)},_setHintLineAfterNewVertex(t){this._hintline.setLatLngs([t,t])},_removeLastVertex(){let t=this._markers;if(t.length<=1){this.disable();return}let e=this._layer.getLatLngs(),i=t[t.length-1],{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(t,i);t.pop(),this._layerGroup.removeLayer(i);let n=t[t.length-1],a=e.indexOf(n.getLatLng());e=e.slice(0,a+1),this._layer.setLatLngs(e),this._layer._latlngInfo.pop(),this._syncHintLine(),this._setTooltipText(),this._fireVertexRemoved(i,r,"Draw"),this._change(this._layer.getLatLngs())},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!1),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let t=this._layer.getLatLngs();if(t.length<=1)return;let e=L.polyline(t,this.options.pathOptions);this._setPane(e,"layerPane"),this._finishLayer(e),e.addTo(this._map.pm._getContainingLayer()),this._fireCreate(e),this.options.snappable&&this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this.enable()},_createMarker(t){let e=new L.Marker(t,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,this._layerGroup.addLayer(e),this._markers.push(e),e.on("click",this._finishShape,this),e},_setTooltipText(){let{length:t}=this._layer.getLatLngs().flat(),e="";t<=1?e=U("tooltips.continueLine"):e=U("tooltips.finishLine"),this._hintMarker.setTooltipContent(e)},_change(t){this._fireChange(t,"Draw")},setStyle(){this._layer?.setStyle(this.options.templineStyle),this._hintline?.setStyle(this.options.hintlineStyle)}}),Z.Polygon=Z.Line.extend({initialize(t){this._map=t,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},enable(t){L.PM.Draw.Line.prototype.enable.call(this,t),this._layer.pm._shape="Polygon"},_createMarker(t){let e=new L.Marker(t,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,this._layerGroup.addLayer(e),this._markers.push(e),this._layer.getLatLngs().flat().length===1?(e.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(e)-1,this.options.snappable&&this._cleanupSnapping()):e.on("click",()=>1),e},_setTooltipText(){let{length:t}=this._layer.getLatLngs().flat(),e="";t<=2?e=U("tooltips.continueLine"):e=U("tooltips.finishPoly"),this._hintMarker.setTooltipContent(e)},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let t=this._layer.getLatLngs();if(t.length<=2)return;let e=L.polygon(t,this.options.pathOptions);this._setPane(e,"layerPane"),this._finishLayer(e),e.addTo(this._map.pm._getContainingLayer()),this._fireCreate(e),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this.disable(),this.options.continueDrawing&&this.enable()}}),Z.Rectangle=Z.extend({initialize(t){this._map=t,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable(t){if(L.Util.setOptions(this,t),this._enabled=!0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:-100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:150,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){this._styleMarkers=[];for(let e=0;e<2;e+=1){let i=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(i,"vertexPane"),i._pmTempLayer=!0,this._layerGroup.addLayer(i),this._styleMarkers.push(i)}}this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(t){this.enabled()?this.disable():this.enable(t)},_placeStartingMarkers(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(e),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach(i=>{L.DomUtil.addClass(i._icon,"visible"),i.setLatLng(e)}),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(U("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin(){let t=this._startMarker.getLatLng();t&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([t,t]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){let i=t;i.target=this._hintMarker,this._handleSnapping(i)}let e=this._layerGroup&&this._layerGroup.hasLayer(this._layer)?this._layer.getLatLngs():[this._hintMarker.getLatLng()];this._fireChange(e,"Draw")},_syncRectangleSize(){let t=mi(this._startMarker.getLatLng(),this._map),e=mi(this._hintMarker.getLatLng(),this._map),i=L.PM.Utils._getRotatedRectangle(t,e,this.options.rectangleAngle||0,this._map);if(this._layer.setLatLngs(i),this.options.cursorMarker&&this._styleMarkers){let r=[];i.forEach(n=>{!n.equals(t,1e-8)&&!n.equals(e,1e-8)&&r.push(n)}),r.forEach((n,a)=>{try{this._styleMarkers[a].setLatLng(n)}catch{}})}},_findCorners(){let t=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(t[0],t[2],this.options.rectangleAngle||0,this._map)},_finishShape(t){this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng(),i=this._startMarker.getLatLng();if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||i.equals(e))return;let r=L.rectangle([i,e],this.options.pathOptions);if(this.options.rectangleAngle){let n=L.PM.Utils._getRotatedRectangle(i,e,this.options.rectangleAngle||0,this._map);r.setLatLngs(n),r.pm&&r.pm._setAngle(this.options.rectangleAngle||0)}this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),this._fireCreate(r),this.disable(),this.options.continueDrawing&&this.enable()},setStyle(){this._layer?.setStyle(this.options.pathOptions)}}),Z.CircleMarker=Z.extend({initialize(t){this._map=t,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1,this._BaseCircleClass=L.CircleMarker,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._defaultRadius=10},enable(t){if(L.Util.setOptions(this,t),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._map.getContainer().classList.add("geoman-draw-cursor"),this.options[this._editableOption]){let e={};L.extend(e,this.options.templineStyle),e.radius=0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=new this._BaseCircleClass(this._map.getCenter(),e),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._centerMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:110,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this)}else this._map.on("click",this._createMarker,this),this._hintMarker=new this._BaseCircleClass(this._map.getCenter(),{radius:this._defaultRadius,...this.options.templineStyle}),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip();this._map.on("mousemove",this._syncHintMarker,this),this._extendingEnable(),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},_extendingEnable(){!this.options[this._editableOption]&&this.options.markerEditable&&this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.enable()}),this._layer.bringToBack()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this.options[this._editableOption]?(this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._extendingDisable(),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},_extendingDisable(){this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.disable()})},enabled(){return this._enabled},toggle(t){this.enabled()?this.disable():this.enable(t)},_placeCenterMarker(t){this._layerGroup.addLayer(this._layer),this._layerGroup.addLayer(this._centerMarker),this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng();this._layerGroup.addLayer(this._layer),this._centerMarker.setLatLng(e),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter(){let t=this._centerMarker.getLatLng();t&&(this._layer.setLatLng(t),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(U("tooltips.finishCircle")),this._fireCenterPlaced(),this._fireChange(this._layer.getLatLng(),"Draw"))},_syncHintLine(){let t=this._centerMarker.getLatLng(),e=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([t,e])},_syncCircleRadius(){let t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),i=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i)},_syncHintMarker(t){if(this._hintMarker.setLatLng(t.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){let i=t;i.target=this._hintMarker,this._handleSnapping(i)}this._handleHintMarkerSnapping();let e=this._layerGroup&&this._layerGroup.hasLayer(this._centerMarker)?this._centerMarker.getLatLng():this._hintMarker.getLatLng();this._fireChange(e,"Draw")},isRelevantMarker(t){return t instanceof L.CircleMarker&&!(t instanceof L.Circle)&&t.pm&&!t._pmTempLayer},_createMarker(t){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||!t.latlng||this._layerIsDragging)return;this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng(),i=new this._BaseCircleClass(e,{radius:this._defaultRadius,...this.options.pathOptions});this._setPane(i,"layerPane"),this._finishLayer(i),i.addTo(this._map.pm._getContainingLayer()),this._extendingCreateMarker(i),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},_extendingCreateMarker(t){t.pm&&this.options.markerEditable&&t.pm.enable()},_finishShape(t){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._centerMarker.getLatLng(),i=this._defaultRadius;if(this.options[this._editableOption]){let a=this._hintMarker.getLatLng();i=this._distanceCalculation(e,a),this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?i=this.options[this._minRadiusOption]:this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(i=this.options[this._maxRadiusOption])}let r={...this.options.pathOptions,radius:i},n=new this._BaseCircleClass(e,r);this._setPane(n,"layerPane"),this._finishLayer(n),n.addTo(this._map.pm._getContainingLayer()),n.pm&&n.pm._updateHiddenPolyCircle(),this._fireCreate(n),this.disable(),this.options.continueDrawing&&this.enable()},_getNewDestinationOfHintMarker(){let t=this._hintMarker.getLatLng();if(this.options[this._editableOption]){if(!this._layerGroup.hasLayer(this._centerMarker))return t;let e=this._centerMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?t=re(this._map,e,t,this._getMinDistanceInMeter()):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(t=re(this._map,e,t,this._getMaxDistanceInMeter()))}return t},_getMinDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,this._centerMarker.getLatLng())},_getMaxDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,this._centerMarker.getLatLng())},_handleHintMarkerSnapping(){if(this.options[this._editableOption]){if(this._hintMarker._snapped){let t=this._centerMarker.getLatLng(),e=this._hintMarker.getLatLng(),i=this._distanceCalculation(t,e);this._layerGroup.hasLayer(this._centerMarker)&&(this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._hintMarker.setLatLng(this._hintMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng))}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},setStyle(){let t={};L.extend(t,this.options.templineStyle),this.options[this._editableOption]&&(t.radius=0),this._layer?.setStyle(t),this._hintline?.setStyle(this.options.hintlineStyle)},_distanceCalculation(t,e){return this._map.project(t).distanceTo(this._map.project(e))}}),Z.Circle=Z.CircleMarker.extend({initialize(t){this._map=t,this._shape="Circle",this.toolbarButtonName="drawCircle",this._BaseCircleClass=L.Circle,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizableCircle",this._defaultRadius=100},_extendingEnable(){},_extendingDisable(){},_extendingCreateMarker(){},isRelevantMarker(){},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_distanceCalculation(t,e){return this._map.distance(t,e)}});function ht(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function pt(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ae(t){return t.type==="Feature"?t.geometry:t}function Ci(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function Fe(t,e,i){if(t!==null)for(var r,n,a,s,o,u,h,y=0,_=0,w,A=t.type,T=A==="FeatureCollection",R=A==="Feature",I=T?t.features.length:1,z=0;z<I;z++){h=T?t.features[z].geometry:R?t.geometry:t,w=h?h.type==="GeometryCollection":!1,o=w?h.geometries.length:1;for(var m=0;m<o;m++){var v=0,M=0;if(s=w?h.geometries[m]:h,s!==null){u=s.coordinates;var P=s.type;switch(y=0,P){case null:break;case"Point":if(e(u,_,z,v,M)===!1)return!1;_++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(e(u[r],_,z,v,M)===!1)return!1;_++,P==="MultiPoint"&&v++}P==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(n=0;n<u[r].length-y;n++){if(e(u[r][n],_,z,v,M)===!1)return!1;_++}P==="MultiLineString"&&v++,P==="Polygon"&&M++}P==="Polygon"&&v++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(M=0,n=0;n<u[r].length;n++){for(a=0;a<u[r][n].length-y;a++){if(e(u[r][n][a],_,z,v,M)===!1)return!1;_++}M++}v++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(Fe(s.geometries[r],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function zt(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var i=0;i<t.features.length&&e(t.features[i],i)!==!1;i++);}function La(t,e,i){var r=i;return zt(t,function(n,a){a===0&&i===void 0?r=n:r=e(r,n,a)}),r}function va(t,e){var i,r,n,a,s,o,u,h,y,_,w=0,A=t.type==="FeatureCollection",T=t.type==="Feature",R=A?t.features.length:1;for(i=0;i<R;i++){for(o=A?t.features[i].geometry:T?t.geometry:t,h=A?t.features[i].properties:T?t.properties:{},y=A?t.features[i].bbox:T?t.bbox:void 0,_=A?t.features[i].id:T?t.id:void 0,u=o?o.type==="GeometryCollection":!1,s=u?o.geometries.length:1,n=0;n<s;n++){if(a=u?o.geometries[n]:o,a===null){if(e(null,w,h,y,_)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,w,h,y,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],w,h,y,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function Te(t,e){va(t,function(i,r,n,a,s){var o=i===null?null:i.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return e(St(i,n,{bbox:a,id:s}),r,0)===!1?!1:void 0}var u;switch(o){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var h=0;h<i.coordinates.length;h++){var y=i.coordinates[h],_={type:u,coordinates:y};if(e(St(_,n),r,h)===!1)return!1}})}function Ca(t){if(!t)throw new Error("geojson is required");var e=[];return Te(t,function(i){ba(i,e)}),bt(e)}function ba(t,e){var i=[],r=t.geometry;if(r!==null){switch(r.type){case"Polygon":i=pt(r);break;case"LineString":i=[pt(r)]}i.forEach(function(n){var a=ka(n,t.properties);a.forEach(function(s){s.id=e.length,e.push(s)})})}}function ka(t,e){var i=[];return t.reduce(function(r,n){var a=Nt([r,n],e);return a.bbox=Ma(r,n),i.push(a),n}),i}function Ma(t,e){var i=t[0],r=t[1],n=e[0],a=e[1],s=i<n?i:n,o=r<a?r:a,u=i>n?i:n,h=r>a?r:a;return[s,o,u,h]}var Re=Ca,Ea=_t(di(),1);function Ba(t,e){var i={},r=[];if(t.type==="LineString"&&(t=St(t)),e.type==="LineString"&&(e=St(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var n=bi(t,e);return n&&r.push(n),bt(r)}var a=(0,Ea.default)();return a.load(Re(e)),zt(Re(t),function(s){zt(a.search(s),function(o){var u=bi(s,o);if(u){var h=pt(u).join(",");i[h]||(i[h]=!0,r.push(u))}})}),bt(r)}function bi(t,e){var i=pt(t),r=pt(e);if(i.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=i[0][0],a=i[0][1],s=i[1][0],o=i[1][1],u=r[0][0],h=r[0][1],y=r[1][0],_=r[1][1],w=(_-h)*(s-n)-(y-u)*(o-a),A=(y-u)*(a-h)-(_-h)*(n-u),T=(s-n)*(a-h)-(o-a)*(n-u);if(w===0)return null;var R=A/w,I=T/w;if(R>=0&&R<=1&&I>=0&&I<=1){var z=n+R*(s-n),m=a+R*(o-a);return Ft([z,m])}return null}var Bt=Ba,ki=_t(di(),1);function xa(t,e,i){i===void 0&&(i={});var r=ht(t),n=ht(e),a=ut(n[1]-r[1]),s=ut(n[0]-r[0]),o=ut(r[1]),u=ut(n[1]),h=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(o)*Math.cos(u);return _a(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),i.units)}var xt=xa;function wa(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=xt(t.slice(0,2),[r,i]),s=xt(t.slice(0,2),[e,n]);if(a>=s){var o=(i+n)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}else{var u=(e+r)/2;return[u-(n-i)/2,i,u+(n-i)/2,n]}}var Da=wa;function Oe(t){var e=[1/0,1/0,-1/0,-1/0];return Fe(t,function(i){e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])}),e}Oe.default=Oe;var Ut=Oe;function Pa(t,e){e===void 0&&(e={});var i=e.precision,r=e.coordinates,n=e.mutate;if(i=i==null||isNaN(i)?6:i,r=r==null||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if(typeof i!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(n===!1||n===void 0)&&(t=JSON.parse(JSON.stringify(t)));var a=Math.pow(10,i);return Fe(t,function(s){Aa(s,a,r)}),t}function Aa(t,e,i){t.length>i&&t.splice(i,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e;return t}var Sa=Pa;function Mi(t,e,i){if(i===void 0&&(i={}),i.final===!0)return Fa(t,e);var r=ht(t),n=ht(e),a=ut(r[0]),s=ut(n[0]),o=ut(r[1]),u=ut(n[1]),h=Math.sin(s-a)*Math.cos(u),y=Math.cos(o)*Math.sin(u)-Math.sin(o)*Math.cos(u)*Math.cos(s-a);return Se(Math.atan2(h,y))}function Fa(t,e){var i=Mi(e,t);return i=(i+180)%360,i}function Ei(t,e,i,r){r===void 0&&(r={});var n=ht(t),a=ut(n[0]),s=ut(n[1]),o=ut(i),u=ma(e,r.units),h=Math.asin(Math.sin(s)*Math.cos(u)+Math.cos(s)*Math.sin(u)*Math.cos(o)),y=a+Math.atan2(Math.sin(o)*Math.sin(u)*Math.cos(s),Math.cos(u)-Math.sin(s)*Math.sin(h)),_=Se(y),w=Se(h);return Ft([_,w],r.properties)}function Ta(t,e,i){i===void 0&&(i={});var r=Ft([1/0,1/0],{dist:1/0}),n=0;return Te(t,function(a){for(var s=pt(a),o=0;o<s.length-1;o++){var u=Ft(s[o]);u.properties.dist=xt(e,u,i);var h=Ft(s[o+1]);h.properties.dist=xt(e,h,i);var y=xt(u,h,i),_=Math.max(u.properties.dist,h.properties.dist),w=Mi(u,h),A=Ei(e,_,w+90,i),T=Ei(e,_,w-90,i),R=Bt(Nt([A.geometry.coordinates,T.geometry.coordinates]),Nt([u.geometry.coordinates,h.geometry.coordinates])),I=null;R.features.length>0&&(I=R.features[0],I.properties.dist=xt(e,I,i),I.properties.location=n+xt(u,I,i)),u.properties.dist<r.properties.dist&&(r=u,r.properties.index=o,r.properties.location=n),h.properties.dist<r.properties.dist&&(r=h,r.properties.index=o+1,r.properties.location=n+y),I&&I.properties.dist<r.properties.dist&&(r=I,r.properties.index=o),n+=y}}),r}var Ra=Ta;function Oa(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var i=Ci(t),r=Ci(e);if(i!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var n=Sa(e,{precision:7});switch(r){case"Point":return Ie(t,n);case"MultiPoint":return Bi(t,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Bi(t,Bt(t,n))}}function Bi(t,e){var i=[],r=(0,ki.default)();return Te(e,function(n){if(i.forEach(function(o,u){o.id=u}),!i.length)i=Ie(t,n).features,i.forEach(function(o){o.bbox||(o.bbox=Da(Ut(o)))}),r.load(bt(i));else{var a=r.search(n);if(a.features.length){var s=xi(n,a);i=i.filter(function(o){return o.id!==s.id}),r.remove(s),zt(Ie(s,n),function(o){i.push(o),r.insert(o)})}}}),bt(i)}function Ie(t,e){var i=[],r=pt(t)[0],n=pt(t)[t.geometry.coordinates.length-1];if(Ge(r,ht(e))||Ge(n,ht(e)))return bt([t]);var a=(0,ki.default)(),s=Re(t);a.load(s);var o=a.search(e);if(!o.features.length)return bt([t]);var u=xi(e,o),h=[r],y=La(s,function(_,w,A){var T=pt(w)[1],R=ht(e);return A===u.id?(_.push(R),i.push(Nt(_)),Ge(R,T)?[R]:[R,T]):(_.push(T),_)},h);return y.length>1&&i.push(Nt(y)),bt(i)}function xi(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var i,r=1/0;return zt(e,function(n){var a=Ra(n,t),s=a.properties.dist;s<r&&(i=n,r=s)}),i}function Ge(t,e){return t[0]===e[0]&&t[1]===e[1]}var Ia=Oa;function se(t,e,i){if(i===void 0&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=ht(t),n=ae(e),a=n.type,s=e.bbox,o=n.coordinates;if(s&&Ga(r,s)===!1)return!1;a==="Polygon"&&(o=[o]);for(var u=!1,h=0;h<o.length&&!u;h++)if(wi(r,o[h][0],i.ignoreBoundary)){for(var y=!1,_=1;_<o[h].length&&!y;)wi(r,o[h][_],!i.ignoreBoundary)&&(y=!0),_++;y||(u=!0)}return u}function wi(t,e,i){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,a=e.length-1;n<e.length;a=n++){var s=e[n][0],o=e[n][1],u=e[a][0],h=e[a][1],y=t[1]*(s-u)+o*(u-t[0])+h*(t[0]-s)===0&&(s-t[0])*(u-t[0])<=0&&(o-t[1])*(h-t[1])<=0;if(y)return!i;var _=o>t[1]!=h>t[1]&&t[0]<(u-s)*(t[1]-o)/(h-o)+s;_&&(r=!r)}return r}function Ga(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function ja(t,e,i){i===void 0&&(i={});for(var r=ht(t),n=pt(e),a=0;a<n.length-1;a++){var s=!1;if(i.ignoreEndVertices&&(a===0&&(s="start"),a===n.length-2&&(s="end"),a===0&&a+1===n.length-1&&(s="both")),Na(n[a],n[a+1],r,s,typeof i.epsilon>"u"?null:i.epsilon))return!0}return!1}function Na(t,e,i,r,n){var a=i[0],s=i[1],o=t[0],u=t[1],h=e[0],y=e[1],_=i[0]-o,w=i[1]-u,A=h-o,T=y-u,R=_*T-w*A;if(n!==null){if(Math.abs(R)>n)return!1}else if(R!==0)return!1;if(r){if(r==="start")return Math.abs(A)>=Math.abs(T)?A>0?o<a&&a<=h:h<=a&&a<o:T>0?u<s&&s<=y:y<=s&&s<u;if(r==="end")return Math.abs(A)>=Math.abs(T)?A>0?o<=a&&a<h:h<a&&a<=o:T>0?u<=s&&s<y:y<s&&s<=u;if(r==="both")return Math.abs(A)>=Math.abs(T)?A>0?o<a&&a<h:h<a&&a<o:T>0?u<s&&s<y:y<s&&s<u}else return Math.abs(A)>=Math.abs(T)?A>0?o<=a&&a<=h:h<=a&&a<=o:T>0?u<=s&&s<=y:y<=s&&s<=u;return!1}var Vt=ja;function za(t,e){var i=ae(t),r=ae(e),n=i.type,a=r.type,s=i.coordinates,o=r.coordinates;switch(n){case"Point":switch(a){case"Point":return je(s,o);default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"Point":return Ua(i,r);case"MultiPoint":return Va(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return Vt(r,i,{ignoreEndVertices:!0});case"LineString":return Ha(i,r);case"MultiPoint":return Ka(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return se(r,i,{ignoreBoundary:!0});case"LineString":return Ja(i,r);case"Polygon":return Xa(i,r);case"MultiPoint":return qa(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function Ua(t,e){var i,r=!1;for(i=0;i<t.coordinates.length;i++)if(je(t.coordinates[i],e.coordinates)){r=!0;break}return r}function Va(t,e){for(var i=0,r=e.coordinates;i<r.length;i++){for(var n=r[i],a=!1,s=0,o=t.coordinates;s<o.length;s++){var u=o[s];if(je(n,u)){a=!0;break}}if(!a)return!1}return!0}function Ka(t,e){for(var i=!1,r=0,n=e.coordinates;r<n.length;r++){var a=n[r];if(Vt(a,t,{ignoreEndVertices:!0})&&(i=!0),!Vt(a,t))return!1}return!!i}function qa(t,e){for(var i=0,r=e.coordinates;i<r.length;i++){var n=r[i];if(!se(n,t,{ignoreBoundary:!0}))return!1}return!0}function Ha(t,e){for(var i=!1,r=0,n=e.coordinates;r<n.length;r++){var a=n[r];if(Vt({type:"Point",coordinates:a},t,{ignoreEndVertices:!0})&&(i=!0),!Vt({type:"Point",coordinates:a},t,{ignoreEndVertices:!1}))return!1}return i}function Ja(t,e){var i=!1,r=0,n=Ut(t),a=Ut(e);if(!Di(n,a))return!1;for(r;r<e.coordinates.length-1;r++){var s=Ya(e.coordinates[r],e.coordinates[r+1]);if(se({type:"Point",coordinates:s},t,{ignoreBoundary:!0})){i=!0;break}}return i}function Xa(t,e){if(t.type==="Feature"&&t.geometry===null||e.type==="Feature"&&e.geometry===null)return!1;var i=Ut(t),r=Ut(e);if(!Di(i,r))return!1;for(var n=ae(e).coordinates,a=0,s=n;a<s.length;a++)for(var o=s[a],u=0,h=o;u<h.length;u++){var y=h[u];if(!se(y,t))return!1}return!0}function Di(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function je(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ya(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}var $a=_t(te()),Pi=t=>()=>t,Ne=t=>{let e=t?(i,r)=>r.minus(i).abs().isLessThanOrEqualTo(t):Pi(!1);return(i,r)=>e(i,r)?0:i.comparedTo(r)};function Za(t){let e=t?(i,r,n,a,s)=>i.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(r).exponentiatedBy(2).plus(s.minus(n).exponentiatedBy(2)).times(t)):Pi(!1);return(i,r,n)=>{let a=i.x,s=i.y,o=n.x,u=n.y,h=s.minus(u).times(r.x.minus(o)).minus(a.minus(o).times(r.y.minus(u)));return e(h,a,s,o,u)?0:h.comparedTo(0)}}var Wa=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ze=Math.ceil,nt=Math.floor,it="[BigNumber Error] ",Ai=it+"Number primitive has more than 15 significant digits: ",lt=1e14,N=14,Ue=9007199254740991,Ve=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],kt=1e7,Y=1e9;function Si(t){var e,i,r,n=m.prototype={constructor:m,toString:null,valueOf:null},a=new m(1),s=20,o=4,u=-7,h=21,y=-1e7,_=1e7,w=!1,A=1,T=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz",z=!0;function m(l,p){var d,c,g,f,b,C,k,x,B=this;if(!(B instanceof m))return new m(l,p);if(p==null){if(l&&l._isBigNumber===!0){B.s=l.s,!l.c||l.e>_?B.c=B.e=null:l.e<y?B.c=[B.e=0]:(B.e=l.e,B.c=l.c.slice());return}if((C=typeof l=="number")&&l*0==0){if(B.s=1/l<0?(l=-l,-1):1,l===~~l){for(f=0,b=l;b>=10;b/=10,f++);f>_?B.c=B.e=null:(B.e=f,B.c=[l]);return}x=String(l)}else{if(!Wa.test(x=String(l)))return r(B,x,C);B.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(f=x.indexOf("."))>-1&&(x=x.replace(".","")),(b=x.search(/e/i))>0?(f<0&&(f=b),f+=+x.slice(b+1),x=x.substring(0,b)):f<0&&(f=x.length)}else{if(J(p,2,I.length,"Base"),p==10&&z)return B=new m(l),E(B,s+B.e+1,o);if(x=String(l),C=typeof l=="number"){if(l*0!=0)return r(B,x,C,p);if(B.s=1/l<0?(x=x.slice(1),-1):1,m.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(Ai+l)}else B.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(d=I.slice(0,p),f=b=0,k=x.length;b<k;b++)if(d.indexOf(c=x.charAt(b))<0){if(c=="."){if(b>f){f=k;continue}}else if(!g&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){g=!0,b=-1,f=0;continue}return r(B,String(l),C,p)}C=!1,x=i(x,p,10,B.s),(f=x.indexOf("."))>-1?x=x.replace(".",""):f=x.length}for(b=0;x.charCodeAt(b)===48;b++);for(k=x.length;x.charCodeAt(--k)===48;);if(x=x.slice(b,++k)){if(k-=b,C&&m.DEBUG&&k>15&&(l>Ue||l!==nt(l)))throw Error(Ai+B.s*l);if((f=f-b-1)>_)B.c=B.e=null;else if(f<y)B.c=[B.e=0];else{if(B.e=f,B.c=[],b=(f+1)%N,f<0&&(b+=N),b<k){for(b&&B.c.push(+x.slice(0,b)),k-=N;b<k;)B.c.push(+x.slice(b,b+=N));b=N-(x=x.slice(b)).length}else b-=k;for(;b--;x+="0");B.c.push(+x)}}else B.c=[B.e=0]}m.clone=Si,m.ROUND_UP=0,m.ROUND_DOWN=1,m.ROUND_CEIL=2,m.ROUND_FLOOR=3,m.ROUND_HALF_UP=4,m.ROUND_HALF_DOWN=5,m.ROUND_HALF_EVEN=6,m.ROUND_HALF_CEIL=7,m.ROUND_HALF_FLOOR=8,m.EUCLID=9,m.config=m.set=function(l){var p,d;if(l!=null)if(typeof l=="object"){if(l.hasOwnProperty(p="DECIMAL_PLACES")&&(d=l[p],J(d,0,Y,p),s=d),l.hasOwnProperty(p="ROUNDING_MODE")&&(d=l[p],J(d,0,8,p),o=d),l.hasOwnProperty(p="EXPONENTIAL_AT")&&(d=l[p],d&&d.pop?(J(d[0],-Y,0,p),J(d[1],0,Y,p),u=d[0],h=d[1]):(J(d,-Y,Y,p),u=-(h=d<0?-d:d))),l.hasOwnProperty(p="RANGE"))if(d=l[p],d&&d.pop)J(d[0],-Y,-1,p),J(d[1],1,Y,p),y=d[0],_=d[1];else if(J(d,-Y,Y,p),d)y=-(_=d<0?-d:d);else throw Error(it+p+" cannot be zero: "+d);if(l.hasOwnProperty(p="CRYPTO"))if(d=l[p],d===!!d)if(d)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))w=d;else throw w=!d,Error(it+"crypto unavailable");else w=d;else throw Error(it+p+" not true or false: "+d);if(l.hasOwnProperty(p="MODULO_MODE")&&(d=l[p],J(d,0,9,p),A=d),l.hasOwnProperty(p="POW_PRECISION")&&(d=l[p],J(d,0,Y,p),T=d),l.hasOwnProperty(p="FORMAT"))if(d=l[p],typeof d=="object")R=d;else throw Error(it+p+" not an object: "+d);if(l.hasOwnProperty(p="ALPHABET"))if(d=l[p],typeof d=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(d))z=d.slice(0,10)=="0123456789",I=d;else throw Error(it+p+" invalid: "+d)}else throw Error(it+"Object expected: "+l);return{DECIMAL_PLACES:s,ROUNDING_MODE:o,EXPONENTIAL_AT:[u,h],RANGE:[y,_],CRYPTO:w,MODULO_MODE:A,POW_PRECISION:T,FORMAT:R,ALPHABET:I}},m.isBigNumber=function(l){if(!l||l._isBigNumber!==!0)return!1;if(!m.DEBUG)return!0;var p,d,c=l.c,g=l.e,f=l.s;t:if({}.toString.call(c)=="[object Array]"){if((f===1||f===-1)&&g>=-Y&&g<=Y&&g===nt(g)){if(c[0]===0){if(g===0&&c.length===1)return!0;break t}if(p=(g+1)%N,p<1&&(p+=N),String(c[0]).length==p){for(p=0;p<c.length;p++)if(d=c[p],d<0||d>=lt||d!==nt(d))break t;if(d!==0)return!0}}}else if(c===null&&g===null&&(f===null||f===1||f===-1))return!0;throw Error(it+"Invalid BigNumber: "+l)},m.maximum=m.max=function(){return M(arguments,-1)},m.minimum=m.min=function(){return M(arguments,1)},m.random=function(){var l=9007199254740992,p=Math.random()*l&2097151?function(){return nt(Math.random()*l)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(d){var c,g,f,b,C,k=0,x=[],B=new m(a);if(d==null?d=s:J(d,0,Y),b=ze(d/N),w)if(crypto.getRandomValues){for(c=crypto.getRandomValues(new Uint32Array(b*=2));k<b;)C=c[k]*131072+(c[k+1]>>>11),C>=9e15?(g=crypto.getRandomValues(new Uint32Array(2)),c[k]=g[0],c[k+1]=g[1]):(x.push(C%1e14),k+=2);k=b/2}else if(crypto.randomBytes){for(c=crypto.randomBytes(b*=7);k<b;)C=(c[k]&31)*281474976710656+c[k+1]*1099511627776+c[k+2]*4294967296+c[k+3]*16777216+(c[k+4]<<16)+(c[k+5]<<8)+c[k+6],C>=9e15?crypto.randomBytes(7).copy(c,k):(x.push(C%1e14),k+=7);k=b/7}else throw w=!1,Error(it+"crypto unavailable");if(!w)for(;k<b;)C=p(),C<9e15&&(x[k++]=C%1e14);for(b=x[--k],d%=N,b&&d&&(C=Ve[N-d],x[k]=nt(b/C)*C);x[k]===0;x.pop(),k--);if(k<0)x=[f=0];else{for(f=-1;x[0]===0;x.splice(0,1),f-=N);for(k=1,C=x[0];C>=10;C/=10,k++);k<N&&(f-=N-k)}return B.e=f,B.c=x,B}}(),m.sum=function(){for(var l=1,p=arguments,d=new m(p[0]);l<p.length;)d=d.plus(p[l++]);return d},i=function(){var l="0123456789";function p(d,c,g,f){for(var b,C=[0],k,x=0,B=d.length;x<B;){for(k=C.length;k--;C[k]*=c);for(C[0]+=f.indexOf(d.charAt(x++)),b=0;b<C.length;b++)C[b]>g-1&&(C[b+1]==null&&(C[b+1]=0),C[b+1]+=C[b]/g|0,C[b]%=g)}return C.reverse()}return function(d,c,g,f,b){var C,k,x,B,F,O,G,j,K=d.indexOf("."),q=s,V=o;for(K>=0&&(B=T,T=0,d=d.replace(".",""),j=new m(c),O=j.pow(d.length-K),T=B,j.c=p(mt(st(O.c),O.e,"0"),10,g,l),j.e=j.c.length),G=p(d,c,g,b?(C=I,l):(C=l,I)),x=B=G.length;G[--B]==0;G.pop());if(!G[0])return C.charAt(0);if(K<0?--x:(O.c=G,O.e=x,O.s=f,O=e(O,j,q,V,g),G=O.c,F=O.r,x=O.e),k=x+q+1,K=G[k],B=g/2,F=F||k<0||G[k+1]!=null,F=V<4?(K!=null||F)&&(V==0||V==(O.s<0?3:2)):K>B||K==B&&(V==4||F||V==6&&G[k-1]&1||V==(O.s<0?8:7)),k<1||!G[0])d=F?mt(C.charAt(1),-q,C.charAt(0)):C.charAt(0);else{if(G.length=k,F)for(--g;++G[--k]>g;)G[k]=0,k||(++x,G=[1].concat(G));for(B=G.length;!G[--B];);for(K=0,d="";K<=B;d+=C.charAt(G[K++]));d=mt(d,x,C.charAt(0))}return d}}(),e=function(){function l(c,g,f){var b,C,k,x,B=0,F=c.length,O=g%kt,G=g/kt|0;for(c=c.slice();F--;)k=c[F]%kt,x=c[F]/kt|0,b=G*k+x*O,C=O*k+b%kt*kt+B,B=(C/f|0)+(b/kt|0)+G*x,c[F]=C%f;return B&&(c=[B].concat(c)),c}function p(c,g,f,b){var C,k;if(f!=b)k=f>b?1:-1;else for(C=k=0;C<f;C++)if(c[C]!=g[C]){k=c[C]>g[C]?1:-1;break}return k}function d(c,g,f,b){for(var C=0;f--;)c[f]-=C,C=c[f]<g[f]?1:0,c[f]=C*b+c[f]-g[f];for(;!c[0]&&c.length>1;c.splice(0,1));}return function(c,g,f,b,C){var k,x,B,F,O,G,j,K,q,V,H,Q,me,Je,Xe,gt,Jt,ot=c.s==g.s?1:-1,tt=c.c,X=g.c;if(!tt||!tt[0]||!X||!X[0])return new m(!c.s||!g.s||(tt?X&&tt[0]==X[0]:!X)?NaN:tt&&tt[0]==0||!X?ot*0:ot/0);for(K=new m(ot),q=K.c=[],x=c.e-g.e,ot=f+x+1,C||(C=lt,x=at(c.e/N)-at(g.e/N),ot=ot/N|0),B=0;X[B]==(tt[B]||0);B++);if(X[B]>(tt[B]||0)&&x--,ot<0)q.push(1),F=!0;else{for(Je=tt.length,gt=X.length,B=0,ot+=2,O=nt(C/(X[0]+1)),O>1&&(X=l(X,O,C),tt=l(tt,O,C),gt=X.length,Je=tt.length),me=gt,V=tt.slice(0,gt),H=V.length;H<gt;V[H++]=0);Jt=X.slice(),Jt=[0].concat(Jt),Xe=X[0],X[1]>=C/2&&Xe++;do{if(O=0,k=p(X,V,gt,H),k<0){if(Q=V[0],gt!=H&&(Q=Q*C+(V[1]||0)),O=nt(Q/Xe),O>1)for(O>=C&&(O=C-1),G=l(X,O,C),j=G.length,H=V.length;p(G,V,j,H)==1;)O--,d(G,gt<j?Jt:X,j,C),j=G.length,k=1;else O==0&&(k=O=1),G=X.slice(),j=G.length;if(j<H&&(G=[0].concat(G)),d(V,G,H,C),H=V.length,k==-1)for(;p(X,V,gt,H)<1;)O++,d(V,gt<H?Jt:X,H,C),H=V.length}else k===0&&(O++,V=[0]);q[B++]=O,V[0]?V[H++]=tt[me]||0:(V=[tt[me]],H=1)}while((me++<Je||V[0]!=null)&&ot--);F=V[0]!=null,q[0]||q.splice(0,1)}if(C==lt){for(B=1,ot=q[0];ot>=10;ot/=10,B++);E(K,f+(K.e=B+x*N-1)+1,b,F)}else K.e=x,K.r=+F;return K}}();function v(l,p,d,c){var g,f,b,C,k;if(d==null?d=o:J(d,0,8),!l.c)return l.toString();if(g=l.c[0],b=l.e,p==null)k=st(l.c),k=c==1||c==2&&(b<=u||b>=h)?ue(k,b):mt(k,b,"0");else if(l=E(new m(l),p,d),f=l.e,k=st(l.c),C=k.length,c==1||c==2&&(p<=f||f<=u)){for(;C<p;k+="0",C++);k=ue(k,f)}else if(p-=b,k=mt(k,f,"0"),f+1>C){if(--p>0)for(k+=".";p--;k+="0");}else if(p+=f-C,p>0)for(f+1==C&&(k+=".");p--;k+="0");return l.s<0&&g?"-"+k:k}function M(l,p){for(var d,c,g=1,f=new m(l[0]);g<l.length;g++)c=new m(l[g]),(!c.s||(d=wt(f,c))===p||d===0&&f.s===p)&&(f=c);return f}function P(l,p,d){for(var c=1,g=p.length;!p[--g];p.pop());for(g=p[0];g>=10;g/=10,c++);return(d=c+d*N-1)>_?l.c=l.e=null:d<y?l.c=[l.e=0]:(l.e=d,l.c=p),l}r=function(){var l=/^(-?)0([xbo])(?=\w[\w.]*$)/i,p=/^([^.]+)\.$/,d=/^\.([^.]+)$/,c=/^-?(Infinity|NaN)$/,g=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(f,b,C,k){var x,B=C?b:b.replace(g,"");if(c.test(B))f.s=isNaN(B)?null:B<0?-1:1;else{if(!C&&(B=B.replace(l,function(F,O,G){return x=(G=G.toLowerCase())=="x"?16:G=="b"?2:8,!k||k==x?O:F}),k&&(x=k,B=B.replace(p,"$1").replace(d,"0.$1")),b!=B))return new m(B,x);if(m.DEBUG)throw Error(it+"Not a"+(k?" base "+k:"")+" number: "+b);f.s=null}f.c=f.e=null}}();function E(l,p,d,c){var g,f,b,C,k,x,B,F=l.c,O=Ve;if(F){t:{for(g=1,C=F[0];C>=10;C/=10,g++);if(f=p-g,f<0)f+=N,b=p,k=F[x=0],B=nt(k/O[g-b-1]%10);else if(x=ze((f+1)/N),x>=F.length)if(c){for(;F.length<=x;F.push(0));k=B=0,g=1,f%=N,b=f-N+1}else break t;else{for(k=C=F[x],g=1;C>=10;C/=10,g++);f%=N,b=f-N+g,B=b<0?0:nt(k/O[g-b-1]%10)}if(c=c||p<0||F[x+1]!=null||(b<0?k:k%O[g-b-1]),c=d<4?(B||c)&&(d==0||d==(l.s<0?3:2)):B>5||B==5&&(d==4||c||d==6&&(f>0?b>0?k/O[g-b]:0:F[x-1])%10&1||d==(l.s<0?8:7)),p<1||!F[0])return F.length=0,c?(p-=l.e+1,F[0]=O[(N-p%N)%N],l.e=-p||0):F[0]=l.e=0,l;if(f==0?(F.length=x,C=1,x--):(F.length=x+1,C=O[N-f],F[x]=b>0?nt(k/O[g-b]%O[b])*C:0),c)for(;;)if(x==0){for(f=1,b=F[0];b>=10;b/=10,f++);for(b=F[0]+=C,C=1;b>=10;b/=10,C++);f!=C&&(l.e++,F[0]==lt&&(F[0]=1));break}else{if(F[x]+=C,F[x]!=lt)break;F[x--]=0,C=1}for(f=F.length;F[--f]===0;F.pop());}l.e>_?l.c=l.e=null:l.e<y&&(l.c=[l.e=0])}return l}function D(l){var p,d=l.e;return d===null?l.toString():(p=st(l.c),p=d<=u||d>=h?ue(p,d):mt(p,d,"0"),l.s<0?"-"+p:p)}return n.absoluteValue=n.abs=function(){var l=new m(this);return l.s<0&&(l.s=1),l},n.comparedTo=function(l,p){return wt(this,new m(l,p))},n.decimalPlaces=n.dp=function(l,p){var d,c,g,f=this;if(l!=null)return J(l,0,Y),p==null?p=o:J(p,0,8),E(new m(f),l+f.e+1,p);if(!(d=f.c))return null;if(c=((g=d.length-1)-at(this.e/N))*N,g=d[g])for(;g%10==0;g/=10,c--);return c<0&&(c=0),c},n.dividedBy=n.div=function(l,p){return e(this,new m(l,p),s,o)},n.dividedToIntegerBy=n.idiv=function(l,p){return e(this,new m(l,p),0,1)},n.exponentiatedBy=n.pow=function(l,p){var d,c,g,f,b,C,k,x,B,F=this;if(l=new m(l),l.c&&!l.isInteger())throw Error(it+"Exponent not an integer: "+D(l));if(p!=null&&(p=new m(p)),C=l.e>14,!F.c||!F.c[0]||F.c[0]==1&&!F.e&&F.c.length==1||!l.c||!l.c[0])return B=new m(Math.pow(+D(F),C?l.s*(2-oe(l)):+D(l))),p?B.mod(p):B;if(k=l.s<0,p){if(p.c?!p.c[0]:!p.s)return new m(NaN);c=!k&&F.isInteger()&&p.isInteger(),c&&(F=F.mod(p))}else{if(l.e>9&&(F.e>0||F.e<-1||(F.e==0?F.c[0]>1||C&&F.c[1]>=24e7:F.c[0]<8e13||C&&F.c[0]<=9999975e7)))return f=F.s<0&&oe(l)?-0:0,F.e>-1&&(f=1/f),new m(k?1/f:f);T&&(f=ze(T/N+2))}for(C?(d=new m(.5),k&&(l.s=1),x=oe(l)):(g=Math.abs(+D(l)),x=g%2),B=new m(a);;){if(x){if(B=B.times(F),!B.c)break;f?B.c.length>f&&(B.c.length=f):c&&(B=B.mod(p))}if(g){if(g=nt(g/2),g===0)break;x=g%2}else if(l=l.times(d),E(l,l.e+1,1),l.e>14)x=oe(l);else{if(g=+D(l),g===0)break;x=g%2}F=F.times(F),f?F.c&&F.c.length>f&&(F.c.length=f):c&&(F=F.mod(p))}return c?B:(k&&(B=a.div(B)),p?B.mod(p):f?E(B,T,o,b):B)},n.integerValue=function(l){var p=new m(this);return l==null?l=o:J(l,0,8),E(p,p.e+1,l)},n.isEqualTo=n.eq=function(l,p){return wt(this,new m(l,p))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(l,p){return wt(this,new m(l,p))>0},n.isGreaterThanOrEqualTo=n.gte=function(l,p){return(p=wt(this,new m(l,p)))===1||p===0},n.isInteger=function(){return!!this.c&&at(this.e/N)>this.c.length-2},n.isLessThan=n.lt=function(l,p){return wt(this,new m(l,p))<0},n.isLessThanOrEqualTo=n.lte=function(l,p){return(p=wt(this,new m(l,p)))===-1||p===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(l,p){var d,c,g,f,b=this,C=b.s;if(l=new m(l,p),p=l.s,!C||!p)return new m(NaN);if(C!=p)return l.s=-p,b.plus(l);var k=b.e/N,x=l.e/N,B=b.c,F=l.c;if(!k||!x){if(!B||!F)return B?(l.s=-p,l):new m(F?b:NaN);if(!B[0]||!F[0])return F[0]?(l.s=-p,l):new m(B[0]?b:o==3?-0:0)}if(k=at(k),x=at(x),B=B.slice(),C=k-x){for((f=C<0)?(C=-C,g=B):(x=k,g=F),g.reverse(),p=C;p--;g.push(0));g.reverse()}else for(c=(f=(C=B.length)<(p=F.length))?C:p,C=p=0;p<c;p++)if(B[p]!=F[p]){f=B[p]<F[p];break}if(f&&(g=B,B=F,F=g,l.s=-l.s),p=(c=F.length)-(d=B.length),p>0)for(;p--;B[d++]=0);for(p=lt-1;c>C;){if(B[--c]<F[c]){for(d=c;d&&!B[--d];B[d]=p);--B[d],B[c]+=lt}B[c]-=F[c]}for(;B[0]==0;B.splice(0,1),--x);return B[0]?P(l,B,x):(l.s=o==3?-1:1,l.c=[l.e=0],l)},n.modulo=n.mod=function(l,p){var d,c,g=this;return l=new m(l,p),!g.c||!l.s||l.c&&!l.c[0]?new m(NaN):!l.c||g.c&&!g.c[0]?new m(g):(A==9?(c=l.s,l.s=1,d=e(g,l,0,3),l.s=c,d.s*=c):d=e(g,l,0,A),l=g.minus(d.times(l)),!l.c[0]&&A==1&&(l.s=g.s),l)},n.multipliedBy=n.times=function(l,p){var d,c,g,f,b,C,k,x,B,F,O,G,j,K,q,V=this,H=V.c,Q=(l=new m(l,p)).c;if(!H||!Q||!H[0]||!Q[0])return!V.s||!l.s||H&&!H[0]&&!Q||Q&&!Q[0]&&!H?l.c=l.e=l.s=null:(l.s*=V.s,!H||!Q?l.c=l.e=null:(l.c=[0],l.e=0)),l;for(c=at(V.e/N)+at(l.e/N),l.s*=V.s,k=H.length,F=Q.length,k<F&&(j=H,H=Q,Q=j,g=k,k=F,F=g),g=k+F,j=[];g--;j.push(0));for(K=lt,q=kt,g=F;--g>=0;){for(d=0,O=Q[g]%q,G=Q[g]/q|0,b=k,f=g+b;f>g;)x=H[--b]%q,B=H[b]/q|0,C=G*x+B*O,x=O*x+C%q*q+j[f]+d,d=(x/K|0)+(C/q|0)+G*B,j[f--]=x%K;j[f]=d}return d?++c:j.splice(0,1),P(l,j,c)},n.negated=function(){var l=new m(this);return l.s=-l.s||null,l},n.plus=function(l,p){var d,c=this,g=c.s;if(l=new m(l,p),p=l.s,!g||!p)return new m(NaN);if(g!=p)return l.s=-p,c.minus(l);var f=c.e/N,b=l.e/N,C=c.c,k=l.c;if(!f||!b){if(!C||!k)return new m(g/0);if(!C[0]||!k[0])return k[0]?l:new m(C[0]?c:g*0)}if(f=at(f),b=at(b),C=C.slice(),g=f-b){for(g>0?(b=f,d=k):(g=-g,d=C),d.reverse();g--;d.push(0));d.reverse()}for(g=C.length,p=k.length,g-p<0&&(d=k,k=C,C=d,p=g),g=0;p;)g=(C[--p]=C[p]+k[p]+g)/lt|0,C[p]=lt===C[p]?0:C[p]%lt;return g&&(C=[g].concat(C),++b),P(l,C,b)},n.precision=n.sd=function(l,p){var d,c,g,f=this;if(l!=null&&l!==!!l)return J(l,1,Y),p==null?p=o:J(p,0,8),E(new m(f),l,p);if(!(d=f.c))return null;if(g=d.length-1,c=g*N+1,g=d[g]){for(;g%10==0;g/=10,c--);for(g=d[0];g>=10;g/=10,c++);}return l&&f.e+1>c&&(c=f.e+1),c},n.shiftedBy=function(l){return J(l,-Ue,Ue),this.times("1e"+l)},n.squareRoot=n.sqrt=function(){var l,p,d,c,g,f=this,b=f.c,C=f.s,k=f.e,x=s+4,B=new m("0.5");if(C!==1||!b||!b[0])return new m(!C||C<0&&(!b||b[0])?NaN:b?f:1/0);if(C=Math.sqrt(+D(f)),C==0||C==1/0?(p=st(b),(p.length+k)%2==0&&(p+="0"),C=Math.sqrt(+p),k=at((k+1)/2)-(k<0||k%2),C==1/0?p="5e"+k:(p=C.toExponential(),p=p.slice(0,p.indexOf("e")+1)+k),d=new m(p)):d=new m(C+""),d.c[0]){for(k=d.e,C=k+x,C<3&&(C=0);;)if(g=d,d=B.times(g.plus(e(f,g,x,1))),st(g.c).slice(0,C)===(p=st(d.c)).slice(0,C))if(d.e<k&&--C,p=p.slice(C-3,C+1),p=="9999"||!c&&p=="4999"){if(!c&&(E(g,g.e+s+2,0),g.times(g).eq(f))){d=g;break}x+=4,C+=4,c=1}else{(!+p||!+p.slice(1)&&p.charAt(0)=="5")&&(E(d,d.e+s+2,1),l=!d.times(d).eq(f));break}}return E(d,d.e+s+1,o,l)},n.toExponential=function(l,p){return l!=null&&(J(l,0,Y),l++),v(this,l,p,1)},n.toFixed=function(l,p){return l!=null&&(J(l,0,Y),l=l+this.e+1),v(this,l,p)},n.toFormat=function(l,p,d){var c,g=this;if(d==null)l!=null&&p&&typeof p=="object"?(d=p,p=null):l&&typeof l=="object"?(d=l,l=p=null):d=R;else if(typeof d!="object")throw Error(it+"Argument not an object: "+d);if(c=g.toFixed(l,p),g.c){var f,b=c.split("."),C=+d.groupSize,k=+d.secondaryGroupSize,x=d.groupSeparator||"",B=b[0],F=b[1],O=g.s<0,G=O?B.slice(1):B,j=G.length;if(k&&(f=C,C=k,k=f,j-=f),C>0&&j>0){for(f=j%C||C,B=G.substr(0,f);f<j;f+=C)B+=x+G.substr(f,C);k>0&&(B+=x+G.slice(f)),O&&(B="-"+B)}c=F?B+(d.decimalSeparator||"")+((k=+d.fractionGroupSize)?F.replace(new RegExp("\\d{"+k+"}\\B","g"),"$&"+(d.fractionGroupSeparator||"")):F):B}return(d.prefix||"")+c+(d.suffix||"")},n.toFraction=function(l){var p,d,c,g,f,b,C,k,x,B,F,O,G=this,j=G.c;if(l!=null&&(C=new m(l),!C.isInteger()&&(C.c||C.s!==1)||C.lt(a)))throw Error(it+"Argument "+(C.isInteger()?"out of range: ":"not an integer: ")+D(C));if(!j)return new m(G);for(p=new m(a),x=d=new m(a),c=k=new m(a),O=st(j),f=p.e=O.length-G.e-1,p.c[0]=Ve[(b=f%N)<0?N+b:b],l=!l||C.comparedTo(p)>0?f>0?p:x:C,b=_,_=1/0,C=new m(O),k.c[0]=0;B=e(C,p,0,1),g=d.plus(B.times(c)),g.comparedTo(l)!=1;)d=c,c=g,x=k.plus(B.times(g=x)),k=g,p=C.minus(B.times(g=p)),C=g;return g=e(l.minus(d),c,0,1),k=k.plus(g.times(x)),d=d.plus(g.times(c)),k.s=x.s=G.s,f=f*2,F=e(x,c,f,o).minus(G).abs().comparedTo(e(k,d,f,o).minus(G).abs())<1?[x,c]:[k,d],_=b,F},n.toNumber=function(){return+D(this)},n.toPrecision=function(l,p){return l!=null&&J(l,1,Y),v(this,l,p,2)},n.toString=function(l){var p,d=this,c=d.s,g=d.e;return g===null?c?(p="Infinity",c<0&&(p="-"+p)):p="NaN":(l==null?p=g<=u||g>=h?ue(st(d.c),g):mt(st(d.c),g,"0"):l===10&&z?(d=E(new m(d),s+g+1,o),p=mt(st(d.c),d.e,"0")):(J(l,2,I.length,"Base"),p=i(mt(st(d.c),g,"0"),10,l,c,!0)),c<0&&d.c[0]&&(p="-"+p)),p},n.valueOf=n.toJSON=function(){return D(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,t!=null&&m.set(t),m}function at(t){var e=t|0;return t>0||t===e?e:e-1}function st(t){for(var e,i,r=1,n=t.length,a=t[0]+"";r<n;){for(e=t[r++]+"",i=N-e.length;i--;e="0"+e);a+=e}for(n=a.length;a.charCodeAt(--n)===48;);return a.slice(0,n+1||1)}function wt(t,e){var i,r,n=t.c,a=e.c,s=t.s,o=e.s,u=t.e,h=e.e;if(!s||!o)return null;if(i=n&&!n[0],r=a&&!a[0],i||r)return i?r?0:-o:s;if(s!=o)return s;if(i=s<0,r=u==h,!n||!a)return r?0:!n^i?1:-1;if(!r)return u>h^i?1:-1;for(o=(u=n.length)<(h=a.length)?u:h,s=0;s<o;s++)if(n[s]!=a[s])return n[s]>a[s]^i?1:-1;return u==h?0:u>h^i?1:-1}function J(t,e,i,r){if(t<e||t>i||t!==nt(t))throw Error(it+(r||"Argument")+(typeof t=="number"?t<e||t>i?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function oe(t){var e=t.c.length-1;return at(t.e/N)==e&&t.c[e]%2!=0}function ue(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function mt(t,e,i){var r,n;if(e<0){for(n=i+".";++e;n+=i);t=n+t}else if(r=t.length,++e>r){for(n=i,e-=r;--e;n+=i);t+=n}else e<r&&(t=t.slice(0,e)+"."+t.slice(e));return t}var Qa=Si(),ct=Qa,ts=class{key;left=null;right=null;constructor(t){this.key=t}},Kt=class extends ts{constructor(t){super(t)}},es=class{size=0;modificationCount=0;splayCount=0;splay(t){let e=this.root;if(e==null)return this.compare(t,t),-1;let i=null,r=null,n=null,a=null,s=e,o=this.compare,u;for(;;)if(u=o(s.key,t),u>0){let h=s.left;if(h==null||(u=o(h.key,t),u>0&&(s.left=h.right,h.right=s,s=h,h=s.left,h==null)))break;i==null?r=s:i.left=s,i=s,s=h}else if(u<0){let h=s.right;if(h==null||(u=o(h.key,t),u<0&&(s.right=h.left,h.left=s,s=h,h=s.right,h==null)))break;n==null?a=s:n.right=s,n=s,s=h}else break;return n!=null&&(n.right=s.left,s.left=a),i!=null&&(i.left=s.right,s.right=r),this.root!==s&&(this.root=s,this.splayCount++),u}splayMin(t){let e=t,i=e.left;for(;i!=null;){let r=i;e.left=r.right,r.right=e,e=r,i=e.left}return e}splayMax(t){let e=t,i=e.right;for(;i!=null;){let r=i;e.right=r.left,r.left=e,e=r,i=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let e=this.root,i=e,r=e.left;if(this.size--,r==null)this.root=e.right;else{let n=e.right;e=this.splayMax(r),e.right=n,this.root=e}return this.modificationCount++,i}addNewRoot(t,e){this.size++,this.modificationCount++;let i=this.root;if(i==null){this.root=t;return}e<0?(t.left=i,t.right=i.right,i.right=null):(t.right=i,t.left=i.left,i.left=null),this.root=t}_first(){let t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){let t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},le=class Xt extends es{root=null;compare;validKey;constructor(e,i){super(),this.compare=e??this.defaultCompare(),this.validKey=i??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(let i of e)this.delete(i)}forEach(e){let i=this[Symbol.iterator](),r;for(;r=i.next(),!r.done;)e(r.value,r.value,this)}add(e){let i=this.splay(e);return i!=0&&this.addNewRoot(new Kt(e),i),this}addAndReturn(e){let i=this.splay(e);return i!=0&&this.addNewRoot(new Kt(e),i),this.root.key}addAll(e){for(let i of e)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let r=i.right;for(;r!=null;)i=r,r=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let r=i.left;for(;r!=null;)i=r,r=i.left;return i.key}retainAll(e){let i=new Xt(this.compare,this.validKey),r=this.modificationCount;for(let n of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){let i=new Xt(this.compare,this.validKey);for(let r of this)e.has(r)&&i.add(r);return i}difference(e){let i=new Xt(this.compare,this.validKey);for(let r of this)e.has(r)||i.add(r);return i}union(e){let i=this.clone();return i.addAll(e),i}clone(){let e=new Xt(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function i(n,a){let s,o;do{if(s=n.left,o=n.right,s!=null){let u=new Kt(s.key);a.left=u,i(s,u)}if(o!=null){let u=new Kt(o.key);a.right=u,n=o,a=u}}while(o!=null)}let r=new Kt(e.key);return i(e,r),r}toSet(){return this.clone()}entries(){return new rs(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new is(this.wrap())}[Symbol.toStringTag]="[object Set]"},Fi=class{tree;path=new Array;modificationCount=null;splayCount;constructor(t){this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let i=this.tree.getRoot();for(;i!=null;)this.path.push(i),i=i.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},is=class extends Fi{getValue(t){return t.key}},rs=class extends Fi{getValue(t){return[t.key,t.key]}},ns=t=>t,as=t=>{if(t){let e=new le(Ne(t)),i=new le(Ne(t)),r=(a,s)=>s.addAndReturn(a),n=a=>({x:r(a.x,e),y:r(a.y,i)});return n({x:new ct(0),y:new ct(0)}),n}return ns},Ke=t=>({set:e=>{yt=Ke(e)},reset:()=>Ke(t),compare:Ne(t),snap:as(t),orient:Za(t)}),yt=Ke(),qt=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),qe=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;let i=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,r=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,n=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,a=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:i,y:n},ur:{x:r,y:a}}},he=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),Ti=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),pe=t=>Ti(t,t).sqrt(),ss=(t,e,i)=>{let r={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:i.x.minus(t.x),y:i.y.minus(t.y)};return he(n,r).div(pe(n)).div(pe(r))},os=(t,e,i)=>{let r={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:i.x.minus(t.x),y:i.y.minus(t.y)};return Ti(n,r).div(pe(n)).div(pe(r))},Ri=(t,e,i)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(i.minus(t.y))),y:i},Oi=(t,e,i)=>e.x.isZero()?null:{x:i,y:t.y.plus(e.y.div(e.x).times(i.minus(t.x)))},us=(t,e,i,r)=>{if(e.x.isZero())return Oi(i,r,t.x);if(r.x.isZero())return Oi(t,e,i.x);if(e.y.isZero())return Ri(i,r,t.y);if(r.y.isZero())return Ri(t,e,i.y);let n=he(e,r);if(n.isZero())return null;let a={x:i.x.minus(t.x),y:i.y.minus(t.y)},s=he(a,e).div(n),o=he(a,r).div(n),u=t.x.plus(o.times(e.x)),h=i.x.plus(s.times(r.x)),y=t.y.plus(o.times(e.y)),_=i.y.plus(s.times(r.y)),w=u.plus(h).div(2),A=y.plus(_).div(2);return{x:w,y:A}},dt=class Hi{point;isLeft;segment;otherSE;consumedBy;static compare(e,i){let r=Hi.comparePoints(e.point,i.point);return r!==0?r:(e.point!==i.point&&e.link(i),e.isLeft!==i.isLeft?e.isLeft?1:-1:ce.compare(e.segment,i.segment))}static comparePoints(e,i){return e.x.isLessThan(i.x)?-1:e.x.isGreaterThan(i.x)?1:e.y.isLessThan(i.y)?-1:e.y.isGreaterThan(i.y)?1:0}constructor(e,i){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=i}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let i=e.point.events;for(let r=0,n=i.length;r<n;r++){let a=i[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let i=0;i<e;i++){let r=this.point.events[i];if(r.segment.consumedBy===void 0)for(let n=i+1;n<e;n++){let a=this.point.events[n];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}getAvailableLinkedEvents(){let e=[];for(let i=0,r=this.point.events.length;i<r;i++){let n=this.point.events[i];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let i=new Map,r=n=>{let a=n.otherSE;i.set(n,{sine:ss(this.point,e.point,a.point),cosine:os(this.point,e.point,a.point)})};return(n,a)=>{i.has(n)||r(n),i.has(a)||r(a);let{sine:s,cosine:o}=i.get(n),{sine:u,cosine:h}=i.get(a);return s.isGreaterThanOrEqualTo(0)&&u.isGreaterThanOrEqualTo(0)?o.isLessThan(h)?1:o.isGreaterThan(h)?-1:0:s.isLessThan(0)&&u.isLessThan(0)?o.isLessThan(h)?-1:o.isGreaterThan(h)?1:0:u.isLessThan(s)?-1:u.isGreaterThan(s)?1:0}}},ls=0,ce=class Ce{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,i){let r=e.leftSE.point.x,n=i.leftSE.point.x,a=e.rightSE.point.x,s=i.rightSE.point.x;if(s.isLessThan(r))return 1;if(a.isLessThan(n))return-1;let o=e.leftSE.point.y,u=i.leftSE.point.y,h=e.rightSE.point.y,y=i.rightSE.point.y;if(r.isLessThan(n)){if(u.isLessThan(o)&&u.isLessThan(h))return 1;if(u.isGreaterThan(o)&&u.isGreaterThan(h))return-1;let _=e.comparePoint(i.leftSE.point);if(_<0)return 1;if(_>0)return-1;let w=i.comparePoint(e.rightSE.point);return w!==0?w:-1}if(r.isGreaterThan(n)){if(o.isLessThan(u)&&o.isLessThan(y))return-1;if(o.isGreaterThan(u)&&o.isGreaterThan(y))return 1;let _=i.comparePoint(e.leftSE.point);if(_!==0)return _;let w=e.comparePoint(i.rightSE.point);return w<0?1:w>0?-1:1}if(o.isLessThan(u))return-1;if(o.isGreaterThan(u))return 1;if(a.isLessThan(s)){let _=i.comparePoint(e.rightSE.point);if(_!==0)return _}if(a.isGreaterThan(s)){let _=e.comparePoint(i.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!a.eq(s)){let _=h.minus(o),w=a.minus(r),A=y.minus(u),T=s.minus(n);if(_.isGreaterThan(w)&&A.isLessThan(T))return 1;if(_.isLessThan(w)&&A.isGreaterThan(T))return-1}return a.isGreaterThan(s)?1:a.isLessThan(s)||h.isLessThan(y)?-1:h.isGreaterThan(y)?1:e.id<i.id?-1:e.id>i.id?1:0}constructor(e,i,r,n){this.id=++ls,this.leftSE=e,e.segment=this,e.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=e,this.rings=r,this.windings=n}static fromRing(e,i,r){let n,a,s,o=dt.comparePoints(e,i);if(o<0)n=e,a=i,s=1;else if(o>0)n=i,a=e,s=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let u=new dt(n,!0),h=new dt(a,!1);return new Ce(u,h,[r],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(i)?e:i},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(i)?e:i}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return yt.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let i=this.bbox(),r=e.bbox(),n=qe(i,r);if(n===null)return null;let a=this.leftSE.point,s=this.rightSE.point,o=e.leftSE.point,u=e.rightSE.point,h=qt(i,o)&&this.comparePoint(o)===0,y=qt(r,a)&&e.comparePoint(a)===0,_=qt(i,u)&&this.comparePoint(u)===0,w=qt(r,s)&&e.comparePoint(s)===0;if(y&&h)return w&&!_?s:!w&&_?u:null;if(y)return _&&a.x.eq(u.x)&&a.y.eq(u.y)?null:a;if(h)return w&&s.x.eq(o.x)&&s.y.eq(o.y)?null:o;if(w&&_)return null;if(w)return s;if(_)return u;let A=us(a,this.vector(),o,e.vector());return A===null||!qt(n,A)?null:yt.snap(A)}split(e){let i=[],r=e.events!==void 0,n=new dt(e,!0),a=new dt(e,!1),s=this.rightSE;this.replaceRightSE(a),i.push(a),i.push(n);let o=new Ce(n,s,this.rings.slice(),this.windings.slice());return dt.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),dt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),a.checkForConsuming()),i}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}consume(e){let i=this,r=e;for(;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let n=Ce.compare(i,r);if(n!==0){if(n>0){let a=i;i=r,r=a}if(i.prev===r){let a=i;i=r,r=a}for(let a=0,s=r.rings.length;a<s;a++){let o=r.rings[a],u=r.windings[a],h=i.rings.indexOf(o);h===-1?(i.rings.push(o),i.windings.push(u)):i.windings[h]+=u}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let i=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let o=0,u=this.rings.length;o<u;o++){let h=this.rings[o],y=this.windings[o],_=i.indexOf(h);_===-1?(i.push(h),r.push(y)):r[_]+=y}let a=[],s=[];for(let o=0,u=i.length;o<u;o++){if(r[o]===0)continue;let h=i[o],y=h.poly;if(s.indexOf(y)===-1)if(h.isExterior)a.push(y);else{s.indexOf(y)===-1&&s.push(y);let _=a.indexOf(h.poly);_!==-1&&a.splice(_,1)}}for(let o=0,u=a.length;o<u;o++){let h=a[o].multiPoly;n.indexOf(h)===-1&&n.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(de.type){case"union":{let r=e.length===0,n=i.length===0;this._isInResult=r!==n;break}case"intersection":{let r,n;e.length<i.length?(r=e.length,n=i.length):(r=i.length,n=e.length),this._isInResult=n===de.numMultiPolys&&r<n;break}case"xor":{let r=Math.abs(e.length-i.length);this._isInResult=r%2===1;break}case"difference":{let r=n=>n.length===1&&n[0].isSubject;this._isInResult=r(e)!==r(i);break}}return this._isInResult}},Ii=class{poly;isExterior;segments;bbox;constructor(t,e,i){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=yt.snap({x:new ct(t[0][0]),y:new ct(t[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let n=r;for(let a=1,s=t.length;a<s;a++){if(typeof t[a][0]!="number"||typeof t[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let o=yt.snap({x:new ct(t[a][0]),y:new ct(t[a][1])});o.x.eq(n.x)&&o.y.eq(n.y)||(this.segments.push(ce.fromRing(n,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),n=o)}(!r.x.eq(n.x)||!r.y.eq(n.y))&&this.segments.push(ce.fromRing(n,r,this))}getSweepEvents(){let t=[];for(let e=0,i=this.segments.length;e<i;e++){let r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}},hs=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ii(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,r=t.length;i<r;i++){let n=new Ii(t[i],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){let t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){let r=this.interiorRings[e].getSweepEvents();for(let n=0,a=r.length;n<a;n++)t.push(r[n])}return t}},Gi=class{isSubject;polys;bbox;constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new ct(Number.POSITIVE_INFINITY),y:new ct(Number.POSITIVE_INFINITY)},ur:{x:new ct(Number.NEGATIVE_INFINITY),y:new ct(Number.NEGATIVE_INFINITY)}};for(let i=0,r=t.length;i<r;i++){let n=new hs(t[i],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){let t=[];for(let e=0,i=this.polys.length;e<i;e++){let r=this.polys[e].getSweepEvents();for(let n=0,a=r.length;n<a;n++)t.push(r[n])}return t}},ps=class Ye{events;poly;_isExteriorRing;_enclosingRing;static factory(e){let i=[];for(let r=0,n=e.length;r<n;r++){let a=e[r];if(!a.isInResult()||a.ringOut)continue;let s=null,o=a.leftSE,u=a.rightSE,h=[o],y=o.point,_=[];for(;s=o,o=u,h.push(o),o.point!==y;)for(;;){let w=o.getAvailableLinkedEvents();if(w.length===0){let R=h[0].point,I=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${I.x}, ${I.y}].`)}if(w.length===1){u=w[0].otherSE;break}let A=null;for(let R=0,I=_.length;R<I;R++)if(_[R].point===o.point){A=R;break}if(A!==null){let R=_.splice(A)[0],I=h.splice(R.index);I.unshift(I[0].otherSE),i.push(new Ye(I.reverse()));continue}_.push({index:h.length,point:o.point});let T=o.getLeftmostComparator(s);u=w.sort(T)[0].otherSE;break}i.push(new Ye(h))}return i}constructor(e){this.events=e;for(let i=0,r=e.length;i<r;i++)e[i].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point,i=[e];for(let h=1,y=this.events.length-1;h<y;h++){let _=this.events[h].point,w=this.events[h+1].point;yt.orient(_,e,w)!==0&&(i.push(_),e=_)}if(i.length===1)return null;let r=i[0],n=i[1];yt.orient(r,e,n)===0&&i.shift(),i.push(i[0]);let a=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:i.length-1,o=this.isExteriorRing()?i.length:-1,u=[];for(let h=s;h!=o;h+=a)u.push([i[h].x.toNumber(),i[h].y.toNumber()]);return u}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let n=1,a=this.events.length;n<a;n++){let s=this.events[n];dt.compare(e,s)>0&&(e=s)}let i=e.segment.prevInResult(),r=i?i.prevInResult():null;for(;;){if(!i)return null;if(!r)return i.ringOut;if(r.ringOut!==i.ringOut)return r.ringOut?.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut?.enclosingRing();i=r.prevInResult(),r=i?i.prevInResult():null}}},ji=class{exteriorRing;interiorRings;constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){let t=this.exteriorRing.getGeom();if(t===null)return null;let e=[t];for(let i=0,r=this.interiorRings.length;i<r;i++){let n=this.interiorRings[i].getGeom();n!==null&&e.push(n)}return e}},cs=class{rings;polys;constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){let t=[];for(let e=0,i=this.polys.length;e<i;e++){let r=this.polys[e].getGeom();r!==null&&t.push(r)}return t}_composePolys(t){let e=[];for(let i=0,r=t.length;i<r;i++){let n=t[i];if(!n.poly)if(n.isExteriorRing())e.push(new ji(n));else{let a=n.enclosingRing();a?.poly||e.push(new ji(a)),a?.poly?.addInterior(n)}}return e}},ds=class{queue;tree;segments;constructor(t,e=ce.compare){this.queue=t,this.tree=new le(e),this.segments=[]}process(t){let e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),i;t.isLeft&&this.tree.add(e);let r=e,n=e;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(t.isLeft){let a=null;if(r){let o=r.getIntersection(e);if(o!==null&&(e.isAnEndpoint(o)||(a=o),!r.isAnEndpoint(o))){let u=this._splitSafely(r,o);for(let h=0,y=u.length;h<y;h++)i.push(u[h])}}let s=null;if(n){let o=n.getIntersection(e);if(o!==null&&(e.isAnEndpoint(o)||(s=o),!n.isAnEndpoint(o))){let u=this._splitSafely(n,o);for(let h=0,y=u.length;h<y;h++)i.push(u[h])}}if(a!==null||s!==null){let o=null;a===null?o=s:s===null?o=a:o=dt.comparePoints(a,s)<=0?a:s,this.queue.delete(e.rightSE),i.push(e.rightSE);let u=e.split(o);for(let h=0,y=u.length;h<y;h++)i.push(u[h])}i.length>0?(this.tree.delete(e),i.push(t)):(this.segments.push(e),e.prev=r)}else{if(r&&n){let a=r.getIntersection(n);if(a!==null){if(!r.isAnEndpoint(a)){let s=this._splitSafely(r,a);for(let o=0,u=s.length;o<u;o++)i.push(s[o])}if(!n.isAnEndpoint(a)){let s=this._splitSafely(n,a);for(let o=0,u=s.length;o<u;o++)i.push(s[o])}}}this.tree.delete(e)}return i}_splitSafely(t,e){this.tree.delete(t);let i=t.rightSE;this.queue.delete(i);let r=t.split(e);return r.push(i),t.consumedBy===void 0&&this.tree.add(t),r}},gs=class{type;numMultiPolys;run(t,e,i){Ht.type=t;let r=[new Gi(e,!0)];for(let u=0,h=i.length;u<h;u++)r.push(new Gi(i[u],!1));if(Ht.numMultiPolys=r.length,Ht.type==="difference"){let u=r[0],h=1;for(;h<r.length;)qe(r[h].bbox,u.bbox)!==null?h++:r.splice(h,1)}if(Ht.type==="intersection")for(let u=0,h=r.length;u<h;u++){let y=r[u];for(let _=u+1,w=r.length;_<w;_++)if(qe(y.bbox,r[_].bbox)===null)return[]}let n=new le(dt.compare);for(let u=0,h=r.length;u<h;u++){let y=r[u].getSweepEvents();for(let _=0,w=y.length;_<w;_++)n.add(y[_])}let a=new ds(n),s=null;for(n.size!=0&&(s=n.first(),n.delete(s));s;){let u=a.process(s);for(let h=0,y=u.length;h<y;h++){let _=u[h];_.consumedBy===void 0&&n.add(_)}n.size!=0?(s=n.first(),n.delete(s)):s=null}yt.reset();let o=ps.factory(a.segments);return new cs(o).getGeom()}},Ht=new gs,de=Ht,fs=(t,...e)=>de.run("intersection",t,e),_s=(t,...e)=>de.run("difference",t,e);yt.set;function ge(t){let e={type:"Feature"};return e.geometry=t,e}function fe(t){return t.type==="Feature"?t.geometry:t}function Ni(t){return t&&t.geometry&&t.geometry.coordinates?t.geometry.coordinates:t}function ms(t){return ge({type:"LineString",coordinates:t})}function ys(t){return ge({type:"MultiLineString",coordinates:t})}function zi(t){return ge({type:"Polygon",coordinates:t})}function Ui(t){return ge({type:"MultiPolygon",coordinates:t})}function Ls(t,e){let i=fe(t),r=fe(e),n=fs(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?zi(n[0]):Ui(n)}function vs(t,e){let i=fe(t),r=fe(e),n=_s(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?zi(n[0]):Ui(n)}function Vi(t){return Array.isArray(t)?1+Vi(t[0]):-1}function Cs(t){t instanceof L.Polyline&&(t=t.toGeoJSON(15));let e=Ni(t),i=Vi(e),r=[];return i>1?e.forEach(n=>{r.push(ms(n))}):r.push(t),r}function bs(t){let e=[];return t.eachLayer(i=>{e.push(Ni(i.toGeoJSON(15)))}),ys(e)}Z.Cut=Z.Polygon.extend({initialize(t){this._map=t,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape(){if(this._editedLayers=[],!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let t=this._layer.getLatLngs();if(t.length<=2)return;let e=L.polygon(t,this.options.pathOptions);e._latlngInfos=this._layer._latlngInfo,this.cut(e),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach(({layer:i,originalLayer:r})=>{this._fireCut(r,i,r),this._fireCut(this._map,i,r),r.pm._fireEdit()}),this._editedLayers=[],this.disable(),this.options.continueDrawing&&this.enable()},cut(t){let e=this._map._layers,i=t._latlngInfos||[];Object.keys(e).map(r=>e[r]).filter(r=>r.pm).filter(r=>!r._pmTempLayer).filter(r=>!L.PM.optIn&&!r.options.pmIgnore||L.PM.optIn&&r.options.pmIgnore===!1).filter(r=>r instanceof L.Polyline).filter(r=>r!==t).filter(r=>r.pm.options.allowCutting).filter(r=>this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0?this.options.layersToCut.indexOf(r)>-1:!0).filter(r=>!this._layerGroup.hasLayer(r)).filter(r=>{try{let n=!!Bt(t.toGeoJSON(15),r.toGeoJSON(15)).features.length>0;return n||r instanceof L.Polyline&&!(r instanceof L.Polygon)?n:!!Ls(t.toGeoJSON(15),r.toGeoJSON(15))}catch{return r instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}}).forEach(r=>{let n;if(r instanceof L.Polygon){n=L.polygon(r.getLatLngs());let u=n.getLatLngs();i.forEach(h=>{if(h&&h.snapInfo){let{latlng:y}=h,_=this._calcClosestLayer(y,[n]);if(_&&_.segment&&_.distance<this.options.snapDistance){let{segment:w}=_;if(w&&w.length===2){let{indexPath:A,parentPath:T,newIndex:R}=L.PM.Utils._getIndexFromSegment(u,w);(A.length>1?(0,$a.default)(u,T):u).splice(R,0,y)}}}})}else n=r;let a=this._cutLayer(t,n),s=L.geoJSON(a,r.options);s.getLayers().length===1&&([s]=s.getLayers()),this._setPane(s,"layerPane");let o=s.addTo(this._map.pm._getContainingLayer());if(o.pm.enable(r.pm.options),o.pm.disable(),r._pmTempLayer=!0,t._pmTempLayer=!0,r.remove(),r.removeFrom(this._map.pm._getContainingLayer()),t.remove(),t.removeFrom(this._map.pm._getContainingLayer()),o.getLayers&&o.getLayers().length===0&&this._map.pm.removeLayer({target:o}),o instanceof L.LayerGroup?(o.eachLayer(u=>{this._addDrawnLayerProp(u)}),this._addDrawnLayerProp(o)):this._addDrawnLayerProp(o),this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0){let u=this.options.layersToCut.indexOf(r);u>-1&&this.options.layersToCut.splice(u,1)}this._editedLayers.push({layer:o,originalLayer:r})})},_cutLayer(t,e){let i=L.geoJSON(),r;if(e instanceof L.Polygon)r=vs(e.toGeoJSON(15),t.toGeoJSON(15));else{let n=Cs(e);n.forEach(a=>{let s=Ia(a,t.toGeoJSON(15)),o;s&&s.features.length>0?o=L.geoJSON(s):o=L.geoJSON(a),o.getLayers().forEach(u=>{za(t.toGeoJSON(15),u.toGeoJSON(15))||u.addTo(i)})}),n.length>1?r=bs(i):r=i.toGeoJSON(15)}return r},_change:L.Util.falseFn}),Z.Text=Z.extend({initialize(t){this._map=t,this._shape="Text",this.toolbarButtonName="drawText"},enable(t){L.Util.setOptions(this,t),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(U("tooltips.placeText"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this._map.getContainer().classList.add("geoman-draw-cursor"),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker?.remove(),this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(t){this.enabled()?this.disable():this.enable(t)},_syncHintMarker(t){if(this._hintMarker.setLatLng(t.latlng),this.options.snappable){let e=t;e.target=this._hintMarker,this._handleSnapping(e)}},_createMarker(t){if(!t.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(t.latlng);let e=this._hintMarker.getLatLng();if(this.textArea=this._createTextArea(),this.options.textOptions?.className){let n=this.options.textOptions.className.split(" ");this.textArea.classList.add(...n)}let i=this._createTextIcon(this.textArea),r=new L.Marker(e,{textMarker:!0,_textMarkerOverPM:!0,icon:i});if(this._setPane(r,"markerPane"),this._finishLayer(r),r.pm||(r.options.draggable=!1),r.addTo(this._map.pm._getContainingLayer()),r.pm){r.pm.textArea=this.textArea,L.setOptions(r.pm,{removeIfEmpty:this.options.textOptions?.removeIfEmpty??!0});let n=this.options.textOptions?.focusAfterDraw??!0;r.pm._createTextMarker(n),this.options.textOptions?.text&&r.pm.setText(this.options.textOptions.text)}this._fireCreate(r),this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this.enable()},_createTextArea(){let t=document.createElement("textarea");return t.readOnly=!0,t.classList.add("pm-textarea","pm-disabled"),t},_createTextIcon(t){return L.divIcon({className:"pm-text-marker",html:t})}});var ks={enableLayerDrag(){if(!this.options.draggable||!this._layer._map)return;this.disable(),this._layerDragEnabled=!0,this._map||(this._map=this._layer._map),(this._layer instanceof L.Marker||this._layer instanceof L.ImageOverlay)&&L.DomEvent.on(this._getDOMElem(),"dragstart",this._stopDOMImageDrag),this._layer.dragging&&this._layer.dragging.disable(),this._tempDragCoord=null,At(this._layer)instanceof L.Canvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0;let t=this._getDOMElem();t&&(At(this._layer)instanceof L.Canvas?(this._layer.on("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._addTouchEvents(t)):L.DomEvent.on(t,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._fireDragEnable()},disableLayerDrag(){this._layerDragEnabled=!1,At(this._layer)instanceof L.Canvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._originalMapDragState&&this._dragging&&this._map.dragging.enable(),this._safeToCacheDragState=!1,this._layer.dragging&&this._layer.dragging.disable();let t=this._getDOMElem();t&&(At(this._layer)instanceof L.Canvas?(this._layer.off("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._removeTouchEvents(t)):L.DomEvent.off(t,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._layerDragged&&this._fireUpdate(),this._layerDragged=!1,this._fireDragDisable()},dragging(){return this._dragging},layerDragEnabled(){return!!this._layerDragEnabled},_simulateMouseDownEvent(t){let e=t.touches?t.touches[0]:t,i={originalEvent:e,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(e),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseDown(i),!1},_simulateMouseMoveEvent(t){let e=t.touches?t.touches[0]:t,i={originalEvent:e,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(e),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseMove(i),!1},_simulateMouseUpEvent(t){let e={originalEvent:t.touches?t.touches[0]:t,target:this._layer};return t.type.indexOf("touch")===-1&&(e.containerPoint=this._map.mouseEventToContainerPoint(t),e.latlng=this._map.containerPointToLatLng(e.containerPoint)),this._dragMixinOnMouseUp(e),!1},_dragMixinOnMouseDown(t){if(t.originalEvent.button>0)return;this._overwriteEventIfItComesFromMarker(t);let e=t._fromLayerSync,i=this._syncLayers("_dragMixinOnMouseDown",t);if(this._layer instanceof L.Marker&&(this.options.snappable&&!e&&!i?this._initSnappableMarkers():this._disableSnapping()),this._layer instanceof L.CircleMarker){let r="resizeableCircleMarker";this._layer instanceof L.Circle&&(r="resizableCircle"),this.options.snappable&&!e&&!i?this._layer.pm.options[r]||this._initSnappableMarkersDrag():this._layer.pm.options[r]?this._layer.pm._disableSnapping():this._layer.pm._disableSnappingDrag()}this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=t.latlng,L.DomEvent.on(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),L.DomEvent.on(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this)},_dragMixinOnMouseMove(t){this._overwriteEventIfItComesFromMarker(t);let e=this._getDOMElem();this._syncLayers("_dragMixinOnMouseMove",t),this._dragging||(this._dragging=!0,L.DomUtil.addClass(e,"leaflet-pm-dragging"),this._layer instanceof L.Marker||this._layer.bringToFront(),this._originalMapDragState&&this._map.dragging.disable(),this._fireDragStart()),this._tempDragCoord||(this._tempDragCoord=t.latlng),this._onLayerDrag(t),this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle()},_dragMixinOnMouseUp(t){let e=this._getDOMElem();return this._syncLayers("_dragMixinOnMouseUp",t),this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0,L.DomEvent.off(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this),L.DomEvent.off(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),this._dragging?(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),this._layerDragged=!0,window.setTimeout(()=>{this._dragging=!1,e&&L.DomUtil.removeClass(e,"leaflet-pm-dragging"),this._fireDragEnd(),this._fireEdit(),this._layerEdited=!0},10),!0):!1},_onLayerDrag(t){let{latlng:e}=t,i={lat:e.lat-this._tempDragCoord.lat,lng:e.lng-this._tempDragCoord.lng},r=n=>n.map(a=>{if(Array.isArray(a))return r(a);let s={lat:a.lat+i.lat,lng:a.lng+i.lng};return(a.alt||a.alt===0)&&(s.alt=a.alt),s});if(this._layer instanceof L.Circle&&this._layer.options.resizableCircle||this._layer instanceof L.CircleMarker&&this._layer.options.resizeableCircleMarker){let n=r([this._layer.getLatLng()]);this._layer.setLatLng(n[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.CircleMarker||this._layer instanceof L.Marker){let n=this._layer.getLatLng();this._layer._snapped&&(n=this._layer._orgLatLng);let a=r([n]);this._layer.setLatLng(a[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.ImageOverlay){let n=r([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(n),this._fireChange(this._layer.getBounds(),"Edit")}else{let n=r(this._layer.getLatLngs());this._layer.setLatLngs(n),this._fireChange(this._layer.getLatLngs(),"Edit")}this._tempDragCoord=e,t.layer=this._layer,this._fireDrag(t)},addDraggingClass(){let t=this._getDOMElem();t&&L.DomUtil.addClass(t,"leaflet-pm-draggable")},removeDraggingClass(){let t=this._getDOMElem();t&&L.DomUtil.removeClass(t,"leaflet-pm-draggable")},_getDOMElem(){let t=null;return this._layer._path?t=this._layer._path:this._layer._renderer&&this._layer._renderer._container?t=this._layer._renderer._container:this._layer._image?t=this._layer._image:this._layer._icon&&(t=this._layer._icon),t},_overwriteEventIfItComesFromMarker(t){t.target.getLatLng&&(!t.target._radius||t.target._radius<=10)&&(t.containerPoint=this._map.mouseEventToContainerPoint(t.originalEvent),t.latlng=this._map.containerPointToLatLng(t.containerPoint))},_syncLayers(t,e){if(this.enabled())return!1;if(!e._fromLayerSync&&this._layer===e.target&&this.options.syncLayersOnDrag){e._fromLayerSync=!0;let i=[];if(L.Util.isArray(this.options.syncLayersOnDrag))i=this.options.syncLayersOnDrag,this.options.syncLayersOnDrag.forEach(r=>{r instanceof L.LayerGroup&&(i=i.concat(r.pm.getLayers(!0)))});else if(this.options.syncLayersOnDrag===!0&&this._parentLayerGroup)for(let r in this._parentLayerGroup){let n=this._parentLayerGroup[r];n.pm&&(i=n.pm.getLayers(!0))}return L.Util.isArray(i)&&i.length>0&&(i=i.filter(r=>!!r.pm).filter(r=>!!r.pm.options.draggable),i.forEach(r=>{r!==this._layer&&r.pm[t]&&(r._snapped=!1,r.pm[t](e))})),i.length>0}return!1},_stopDOMImageDrag(t){return t.preventDefault(),!1}},Ms=ks,Es=_t(te());function Bs(t,e,i,r){return i.unproject(e.transform(i.project(t,r)),r)}function Ki(t,e,i){let r=i.getMaxZoom();if(r===1/0&&(r=i.getZoom()),L.Util.isArray(t)){let n=[];return t.forEach(a=>{n.push(Ki(a,e,i))}),n}return t instanceof L.LatLng?Bs(t,e,i,r):null}function Tt(t,e){e instanceof L.Layer&&(e=e.getLatLng());let i=t.getMaxZoom();return i===1/0&&(i=t.getZoom()),t.project(e,i)}function _e(t,e){let i=t.getMaxZoom();return i===1/0&&(i=t.getZoom()),t.unproject(e,i)}var xs={_onRotateStart(t){this._preventRenderingMarkers(!0),this._rotationOriginLatLng=this._getRotationCenter().clone(),this._rotationOriginPoint=Tt(this._map,this._rotationOriginLatLng),this._rotationStartPoint=Tt(this._map,t.target.getLatLng()),this._initialRotateLatLng=Ct(this._layer),this._startAngle=this.getAngle();let e=Ct(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._fireRotationStart(this._rotationLayer,e),this._fireRotationStart(this._map,e)},_onRotate(t){let e=Tt(this._map,t.target.getLatLng()),i=this._rotationStartPoint,r=this._rotationOriginPoint,n=Math.atan2(e.y-r.y,e.x-r.x)-Math.atan2(i.y-r.y,i.x-r.x);this._layer.setLatLngs(this._rotateLayer(n,this._initialRotateLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let a=this;function s(y,_=[],w=-1){if(w>-1&&_.push(w),L.Util.isArray(y[0]))y.forEach((A,T)=>s(A,_.slice(),T));else{let A=(0,Es.default)(a._markers,_);y.forEach((T,R)=>{A[R].setLatLng(T)})}}s(this._layer.getLatLngs());let o=Ct(this._rotationLayer);this._rotationLayer.setLatLngs(this._rotateLayer(n,this._rotationLayer.pm._rotateOrgLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let u=n*180/Math.PI;u=u<0?u+360:u;let h=u+this._startAngle;this._setAngle(h),this._rotationLayer.pm._setAngle(h),this._fireRotation(this._rotationLayer,u,o),this._fireRotation(this._map,u,o),this._rotationLayer.pm._fireChange(this._rotationLayer.getLatLngs(),"Rotation")},_onRotateEnd(){let t=this._startAngle;delete this._rotationOriginLatLng,delete this._rotationOriginPoint,delete this._rotationStartPoint,delete this._initialRotateLatLng,delete this._startAngle;let e=Ct(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._rotationLayer.pm._rotateOrgLatLng=Ct(this._rotationLayer),this._fireRotationEnd(this._rotationLayer,t,e),this._fireRotationEnd(this._map,t,e),this._rotationLayer.pm._fireEdit(this._rotationLayer,"Rotation"),this._preventRenderingMarkers(!1),this._layerRotated=!0},_rotateLayer(t,e,i,r,n){let a=Tt(n,i);return this._matrix=r.clone().rotate(t,a).flip(),Ki(e,this._matrix,n)},_setAngle(t){t=t<0?t+360:t,this._angle=t%360},_getRotationCenter(){if(this._rotationCenter)return this._rotationCenter;let t=L.polygon(this._layer.getLatLngs(),{stroke:!1,fill:!1,pmIgnore:!0}).addTo(this._layer._map),e=t.getCenter();return t.removeFrom(this._layer._map),e},enableRotate(){if(!this.options.allowRotation){this.disableRotate();return}this.rotateEnabled()&&this.disableRotate(),this._layer instanceof L.Rectangle&&this._angle===void 0&&this.setInitAngle(Ae(this._layer._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let t={fill:!1,stroke:!1,pmIgnore:!1,snapIgnore:!0};this._rotatePoly=L.polygon(this._layer.getLatLngs(),t),this._rotatePoly._pmTempLayer=!0,this._rotatePoly.addTo(this._layer._map),this._rotatePoly.pm._setAngle(this.getAngle()),this._rotatePoly.pm.setRotationCenter(this.getRotationCenter()),this._rotatePoly.pm.setOptions(this._layer._map.pm.getGlobalOptions()),this._rotatePoly.pm.setOptions({rotate:!0,snappable:!1,hideMiddleMarkers:!0}),this._rotatePoly.pm._rotationLayer=this._layer,this._rotatePoly.pm.enable(),this._rotateOrgLatLng=Ct(this._layer),this._rotateEnabled=!0,this._layer.on("remove",this.disableRotate,this),this._fireRotationEnable(this._layer),this._fireRotationEnable(this._layer._map)},disableRotate(){this.rotateEnabled()&&(this._rotatePoly.pm._layerRotated&&this._fireUpdate(),this._rotatePoly.pm._layerRotated=!1,this._rotatePoly.pm.disable(),this._rotatePoly.remove(),this._rotatePoly.pm.setOptions({rotate:!1}),this._rotatePoly=void 0,this._rotateOrgLatLng=void 0,this._layer.off("remove",this.disableRotate,this),this._rotateEnabled=!1,this._fireRotationDisable(this._layer),this._fireRotationDisable(this._layer._map))},rotateEnabled(){return!!this._rotateEnabled},rotateLayer(t){let e=this.getAngle(),i=this._layer.getLatLngs(),r=t*(Math.PI/180);this._layer.setLatLngs(this._rotateLayer(r,this._layer.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._layer._map)),this._rotateOrgLatLng=L.polygon(this._layer.getLatLngs()).getLatLngs(),this._setAngle(this.getAngle()+t),this.rotateEnabled()&&this._rotatePoly&&this._rotatePoly.pm.enabled()&&(this._rotatePoly.setLatLngs(this._rotateLayer(r,this._rotatePoly.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._rotatePoly._map)),this._rotatePoly.pm._initMarkers());let n=this.getAngle()-e;n=n<0?n+360:n,this._startAngle=e,this._fireRotation(this._layer,n,i,this._layer),this._fireRotation(this._map||this._layer._map,n,i,this._layer),delete this._startAngle,this._fireChange(this._layer.getLatLngs(),"Rotation")},rotateLayerToAngle(t){let e=t-this.getAngle();this.rotateLayer(e)},getAngle(){return this._angle||0},setInitAngle(t){this._setAngle(t)},getRotationCenter(){return this._getRotationCenter()},setRotationCenter(t){this._rotationCenter=t,this._rotatePoly&&this._rotatePoly.pm.setRotationCenter(t)}},ws=xs,Ds=L.Class.extend({includes:[Ms,yi,ws,ee],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,snapSegment:!0,syncLayersOnDrag:!1,draggable:!0,allowEditing:!0,allowRemoval:!0,allowCutting:!0,allowRotation:!0,addVertexOn:"click",removeVertexOn:"contextmenu",removeVertexValidation:void 0,addVertexValidation:void 0,moveVertexValidation:void 0,resizeableCircleMarker:!1,resizableCircle:!0},setOptions(t){L.Util.setOptions(this,t)},getOptions(){return this.options},applyOptions(){},isPolygon(){return this._layer instanceof L.Polygon},getShape(){return this._shape},_setPane(t,e){e==="layerPane"?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":e==="vertexPane"?t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":e==="markerPane"&&(t.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},remove(){(this._map||this._layer._map).pm.removeLayer({target:this._layer})},_vertexValidation(t,e){let i=e.target,r={layer:this._layer,marker:i,event:e},n="";return t==="move"?n="moveVertexValidation":t==="add"?n="addVertexValidation":t==="remove"&&(n="removeVertexValidation"),this.options[n]&&typeof this.options[n]=="function"&&!this.options[n](r)?(t==="move"&&(i._cancelDragEventChain=i.getLatLng()),!1):(i._cancelDragEventChain=null,!0)},_vertexValidationDrag(t){return t._cancelDragEventChain?(t._latlng=t._cancelDragEventChain,t.update(),!1):!0},_vertexValidationDragEnd(t){return t._cancelDragEventChain?(t._cancelDragEventChain=null,!1):!0}}),$=Ds;$.LayerGroup=L.Class.extend({initialize(t){this._layerGroup=t,this._layers=this.getLayers(),this._getMap(),this._layers.forEach(r=>this._initLayer(r));let e=r=>{if(r.layer._pmTempLayer)return;this._layers=this.getLayers();let n=this._layers.filter(a=>!a.pm._parentLayerGroup||!(this._layerGroup._leaflet_id in a.pm._parentLayerGroup));n.forEach(a=>{this._initLayer(a)}),n.length>0&&this._getMap()&&this._getMap().pm.globalEditModeEnabled()&&this.enabled()&&this.enable(this.getOptions())};this._layerGroup.on("layeradd",L.Util.throttle(e,100,this),this),this._layerGroup.on("layerremove",r=>{this._removeLayerFromGroup(r.target)},this);let i=r=>{r.target._pmTempLayer||(this._layers=this.getLayers())};this._layerGroup.on("layerremove",L.Util.throttle(i,100,this),this)},enable(t,e=[]){e.length===0&&(this._layers=this.getLayers()),this._options=t,this._layers.forEach(i=>{i instanceof L.LayerGroup?e.indexOf(i._leaflet_id)===-1&&(e.push(i._leaflet_id),i.pm.enable(t,e)):i.pm.enable(t)})},disable(t=[]){t.length===0&&(this._layers=this.getLayers()),this._layers.forEach(e=>{e instanceof L.LayerGroup?t.indexOf(e._leaflet_id)===-1&&(t.push(e._leaflet_id),e.pm.disable(t)):e.pm.disable()})},enabled(t=[]){return t.length===0&&(this._layers=this.getLayers()),!!this._layers.find(e=>e instanceof L.LayerGroup?t.indexOf(e._leaflet_id)===-1?(t.push(e._leaflet_id),e.pm.enabled(t)):!1:e.pm.enabled())},toggleEdit(t,e=[]){e.length===0&&(this._layers=this.getLayers()),this._options=t,this._layers.forEach(i=>{i instanceof L.LayerGroup?e.indexOf(i._leaflet_id)===-1&&(e.push(i._leaflet_id),i.pm.toggleEdit(t,e)):i.pm.toggleEdit(t)})},_initLayer(t){let e=L.Util.stamp(this._layerGroup);t.pm._parentLayerGroup||(t.pm._parentLayerGroup={}),t.pm._parentLayerGroup[e]=this._layerGroup},_removeLayerFromGroup(t){if(t.pm&&t.pm._layerGroup){let e=L.Util.stamp(this._layerGroup);delete t.pm._layerGroup[e]}},dragging(){return this._layers=this.getLayers(),this._layers?!!this._layers.find(t=>t.pm.dragging()):!1},getOptions(){return this.options},_getMap(){return this._map||this._layers.find(t=>!!t._map)?._map||null},getLayers(t=!1,e=!0,i=!0,r=[]){let n=[];return t?this._layerGroup.getLayers().forEach(a=>{n.push(a),a instanceof L.LayerGroup&&r.indexOf(a._leaflet_id)===-1&&(r.push(a._leaflet_id),n=n.concat(a.pm.getLayers(!0,!0,!0,r)))}):n=this._layerGroup.getLayers(),i&&(n=n.filter(a=>!(a instanceof L.LayerGroup))),e&&(n=n.filter(a=>!!a.pm),n=n.filter(a=>!a._pmTempLayer),n=n.filter(a=>!L.PM.optIn&&!a.options.pmIgnore||L.PM.optIn&&a.options.pmIgnore===!1)),n},setOptions(t,e=[]){e.length===0&&(this._layers=this.getLayers()),this.options=t,this._layers.forEach(i=>{i.pm&&(i instanceof L.LayerGroup?e.indexOf(i._leaflet_id)===-1&&(e.push(i._leaflet_id),i.pm.setOptions(t,e)):i.pm.setOptions(t))})}}),$.Marker=$.extend({_shape:"Marker",initialize(t){this._layer=t,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable(t={draggable:!0}){if(L.Util.setOptions(this,t),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._fireEnable()},disable(){this.enabled()&&(this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this._layer.off("contextmenu",this._removeMarker,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1)},enabled(){return this._enabled},toggleEdit(t){this.enabled()?this.disable():this.enable(t)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker(t){let e=t.target;e.remove(),this._fireRemove(e),this._fireRemove(this._map,e)},_onDragEnd(){this._fireEdit(),this._layerEdited=!0},_initSnappableMarkers(){let t=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,t.off("pm:drag",this._handleSnapping,this),t.on("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.on("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this),t.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let t=this._layer;t.off("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this)}});var Mt=_t(te()),Ps={filterMarkerGroup(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this.throttledApplyLimitFilters||(this.throttledApplyLimitFilters=L.Util.throttle(this.applyLimitFilters,100,this)),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),this._layer.on("remove",this._removeMarkerLimitEvents,this),this.options.limitMarkersToCount>-1&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.throttledApplyLimitFilters,this))},_removeMarkerLimitEvents(){this._map.off("mousemove",this.throttledApplyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache(){let t=[...this._markerGroup.getLayers(),...this.markerCache];this.markerCache=t.filter((e,i,r)=>r.indexOf(e)===i)},_removeFromCache(t){let e=this.markerCache.indexOf(t);e>-1&&this.markerCache.splice(e,1)},renderLimits(t){this.markerCache.forEach(e=>{t.includes(e)?this._markerGroup.addLayer(e):this._markerGroup.removeLayer(e)})},applyLimitFilters({latlng:t={lat:0,lng:0}}){if(this._preventRenderMarkers)return;let e=[...this._filterClosestMarkers(t)];this.renderLimits(e)},_filterClosestMarkers(t){let e=[...this.markerCache],i=this.options.limitMarkersToCount;return i===-1?e:(e.sort((r,n)=>{let a=r._latlng.distanceTo(t),s=n._latlng.distanceTo(t);return a-s}),e.filter((r,n)=>i>-1?n<i:!0))},_preventRenderMarkers:!1,_preventRenderingMarkers(t){this._preventRenderMarkers=!!t}},As=Ps;$.Line=$.extend({includes:[As],_shape:"Line",initialize(t){this._layer=t,this._enabled=!1},enable(t){if(L.Util.setOptions(this,t),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()&&this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:(this._layer.options.color!=="#f00000ff"?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),this._fireEnable()}},disable(){if(!this.enabled()||this._dragging)return;this._enabled=!1,this._markerGroup.clearLayers(),this._markerGroup.removeFrom(this._map),this._layer.off("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);let t=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(t,"leaflet-pm-draggable"),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()},enabled(){return this._enabled},toggleEdit(t){return this.enabled()?this.disable():this.enable(t),this.enabled()},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initMarkers(){let t=this._map,e=this._layer.getLatLngs();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0;let i=r=>{if(Array.isArray(r[0]))return r.map(i,this);let n=r.map(this._createMarker,this);return this.options.hideMiddleMarkers!==!0&&r.map((a,s)=>{let o=this.isPolygon()?(s+1)%r.length:s+1;return this._createMiddleMarker(n[s],n[o])}),n};this._markers=i(e),this.filterMarkerGroup(),t.addLayer(this._markerGroup)},_createMarker(t){let e=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._pmTempLayer=!0,this.options.rotate?(e.on("dragstart",this._onRotateStart,this),e.on("drag",this._onRotate,this),e.on("dragend",this._onRotateEnd,this)):(e.on("click",this._onVertexClick,this),e.on("dragstart",this._onMarkerDragStart,this),e.on("move",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||e.on(this.options.removeVertexOn,this._removeMarker,this)),this._markerGroup.addLayer(e),e},_createMiddleMarker(t,e){if(!t||!e)return!1;let i=L.PM.Utils.calcMiddleLatLng(this._map,t.getLatLng(),e.getLatLng()),r=this._createMarker(i),n=L.divIcon({className:"marker-icon marker-icon-middle"});return r.setIcon(n),r.leftM=t,r.rightM=e,t._middleMarkerNext=r,e._middleMarkerPrev=r,r.on(this.options.addVertexOn,this._onMiddleMarkerClick,this),r.on("movestart",this._onMiddleMarkerMoveStart,this),r},_onMiddleMarkerClick(t){let e=t.target;if(!this._vertexValidation("add",t))return;let i=L.divIcon({className:"marker-icon"});e.setIcon(i),this._addMarker(e,e.leftM,e.rightM)},_onMiddleMarkerMoveStart(t){let e=t.target;if(e.on("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidation("add",t)){e.on("move",this._onMiddleMarkerMovePrevent,this);return}e._dragging=!0,this._addMarker(e,e.leftM,e.rightM)},_onMiddleMarkerMovePrevent(t){let e=t.target;this._vertexValidationDrag(e)},_onMiddleMarkerMoveEnd(t){let e=t.target;if(e.off("move",this._onMiddleMarkerMovePrevent,this),e.off("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidationDragEnd(e))return;let i=L.divIcon({className:"marker-icon"});e.setIcon(i),setTimeout(()=>{delete e._dragging},100)},_addMarker(t,e,i){t.off("movestart",this._onMiddleMarkerMoveStart,this),t.off(this.options.addVertexOn,this._onMiddleMarkerClick,this);let r=t.getLatLng(),n=this._layer._latlngs;delete t.leftM,delete t.rightM;let{indexPath:a,index:s,parentPath:o}=L.PM.Utils.findDeepMarkerIndex(this._markers,e),u=a.length>1?(0,Mt.default)(n,o):n,h=a.length>1?(0,Mt.default)(this._markers,o):this._markers;u.splice(s+1,0,r),h.splice(s+1,0,t),this._layer.setLatLngs(n),this.options.hideMiddleMarkers!==!0&&(this._createMiddleMarker(e,t),this._createMiddleMarker(t,i)),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit"),this._fireVertexAdded(t,L.PM.Utils.findDeepMarkerIndex(this._markers,t).indexPath,r),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection(){return ne(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersectionOnVertexRemoval(){this._handleLayerStyle(!0)&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle(t){let e=this._layer,i,r;if(this.options.allowSelfIntersection?i=!1:(r=ne(this._layer.toGeoJSON(15)),i=r.features.length>0),i){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return i;t?this._flashLayer():(e.setStyle({color:"#f00000ff"}),this.isRed=!0),this._fireIntersect(r)}else e.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1);return i},_flashLayer(){this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout(()=>{this._layer.setStyle({color:this.cachedColor}),this.isRed=!1},200)},_updateDisabledMarkerStyle(t,e){t.forEach(i=>{Array.isArray(i)?this._updateDisabledMarkerStyle(i,e):i._icon&&(e&&!this._checkMarkerAllowedToDrag(i)?L.DomUtil.addClass(i._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(i._icon,"vertexmarker-disabled"))})},_removeMarker(t){let e=t.target;if(!this._vertexValidation("remove",t))return;this.options.allowSelfIntersection||(this._coordsBeforeEdit=Ct(this._layer,this._layer.getLatLngs()));let i=this._layer.getLatLngs(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);if(!r)return;let s=r.length>1?(0,Mt.default)(i,a):i,o=r.length>1?(0,Mt.default)(this._markers,a):this._markers;if(!this.options.removeLayerBelowMinVertexCount&&(s.length<=2||this.isPolygon()&&s.length<=3)){this._flashLayer();return}s.splice(n,1),this._layer.setLatLngs(i),this.isPolygon()&&s.length<=2&&s.splice(0,s.length);let u=!1;if(s.length<=1&&(s.splice(0,s.length),a.length>1&&r.length>1&&(i=ie(i)),this._layer.setLatLngs(i),this._initMarkers(),u=!0),Pe(i)||this._layer.remove(),i=ie(i),this._layer.setLatLngs(i),this._markers=ie(this._markers),!u&&(o=r.length>1?(0,Mt.default)(this._markers,a):this._markers,e._middleMarkerPrev&&(this._markerGroup.removeLayer(e._middleMarkerPrev),this._removeFromCache(e._middleMarkerPrev)),e._middleMarkerNext&&(this._markerGroup.removeLayer(e._middleMarkerNext),this._removeFromCache(e._middleMarkerNext)),this._markerGroup.removeLayer(e),this._removeFromCache(e),o)){let h,y;if(this.isPolygon()?(h=(n+1)%o.length,y=(n+(o.length-1))%o.length):(y=n-1<0?void 0:n-1,h=n+1>=o.length?void 0:n+1),h!==y){let _=o[y],w=o[h];this.options.hideMiddleMarkers!==!0&&this._createMiddleMarker(_,w)}o.splice(n,1)}this._fireEdit(),this._layerEdited=!0,this._fireVertexRemoved(e,r),this._fireChange(this._layer.getLatLngs(),"Edit")},updatePolygonCoordsFromMarkerDrag(t){let e=this._layer.getLatLngs(),i=t.getLatLng(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);(r.length>1?(0,Mt.default)(e,a):e).splice(n,1,i),this._layer.setLatLngs(e)},_getNeighborMarkers(t){let{indexPath:e,index:i,parentPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),n=e.length>1?(0,Mt.default)(this._markers,r):this._markers,a=(i+1)%n.length,s=(i+(n.length-1))%n.length,o=n[s],u=n[a];return{prevMarker:o,nextMarker:u}},_checkMarkerAllowedToDrag(t){let{prevMarker:e,nextMarker:i}=this._getNeighborMarkers(t),r=L.polyline([e.getLatLng(),t.getLatLng()]),n=L.polyline([t.getLatLng(),i.getLatLng()]),a=Bt(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=Bt(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return t.getLatLng()===this._markers[0][0].getLatLng()?s+=1:t.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(a+=1),!(a<=2&&s<=2)},_onMarkerDragStart(t){let e=t.target;if(this.cachedColor||(this.cachedColor=this._layer.options.color),!this._vertexValidation("move",t))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);this._fireMarkerDragStart(t,i),this.options.allowSelfIntersection||(this._coordsBeforeEdit=Ct(this._layer,this._layer.getLatLngs())),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(e):this._markerAllowedToDrag=null},_onMarkerDrag(t){let e=t.target;if(!this._vertexValidationDrag(e))return;let{indexPath:i,index:r,parentPath:n}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);if(!i)return;if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&this._markerAllowedToDrag===!1){this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),this._handleLayerStyle();return}this.updatePolygonCoordsFromMarkerDrag(e);let a=i.length>1?(0,Mt.default)(this._markers,n):this._markers,s=(r+1)%a.length,o=(r+(a.length-1))%a.length,u=e.getLatLng(),h=a[o].getLatLng(),y=a[s].getLatLng();if(e._middleMarkerNext){let _=L.PM.Utils.calcMiddleLatLng(this._map,u,y);e._middleMarkerNext.setLatLng(_)}if(e._middleMarkerPrev){let _=L.PM.Utils.calcMiddleLatLng(this._map,u,h);e._middleMarkerPrev.setLatLng(_)}this.options.allowSelfIntersection||this._handleLayerStyle(),this._fireMarkerDrag(t,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(t){let e=t.target;if(!this._vertexValidationDragEnd(e))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e),r=this.hasSelfIntersection();r&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(r=!1);let n=!this.options.allowSelfIntersection&&r;if(this._fireMarkerDragEnd(t,i,n),n){this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),this._fireLayerReset(t,i);return}!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_onVertexClick(t){let e=t.target;if(e._dragging)return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);this._fireVertexClick(t,i)}}),$.Polygon=$.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag(t){let{prevMarker:e,nextMarker:i}=this._getNeighborMarkers(t),r=L.polyline([e.getLatLng(),t.getLatLng()]),n=L.polyline([t.getLatLng(),i.getLatLng()]),a=Bt(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=Bt(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return!(a<=2&&s<=2)}}),$.Rectangle=$.Polygon.extend({_shape:"Rectangle",_initMarkers(){let t=this._map,e=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0,t.addLayer(this._markerGroup),this._markers=[],this._markers[0]=e.map(this._createMarker,this),[this._cornerMarkers]=this._markers,this._layer.getLatLngs()[0].forEach((i,r)=>{let n=this._cornerMarkers.find(a=>a._index===r);n&&n.setLatLng(i)})},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker(t,e){let i=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(i,"vertexPane"),i._origLatLng=t,i._index=e,i._pmTempLayer=!0,i.on("click",this._onVertexClick,this),this._markerGroup.addLayer(i),i},_addMarkerEvents(){this._markers[0].forEach(t=>{t.on("dragstart",this._onMarkerDragStart,this),t.on("drag",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||t.on("contextmenu",this._removeMarker,this)})},_removeMarker(){return null},_onMarkerDragStart(t){if(!this._vertexValidation("move",t))return;let e=t.target,i=this._cornerMarkers;e._oppositeCornerLatLng=i.find(n=>n._index===(e._index+2)%4).getLatLng(),e._snapped=!1;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);this._fireMarkerDragStart(t,r)},_onMarkerDrag(t){let e=t.target;if(!this._vertexValidationDrag(e)||e._index===void 0)return;this._adjustRectangleForMarkerMove(e);let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);this._fireMarkerDrag(t,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(t){let e=t.target;if(!this._vertexValidationDragEnd(e))return;this._cornerMarkers.forEach(r=>{delete r._oppositeCornerLatLng});let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);this._fireMarkerDragEnd(t,i),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_adjustRectangleForMarkerMove(t){L.extend(t._origLatLng,t._latlng);let e=L.PM.Utils._getRotatedRectangle(t.getLatLng(),t._oppositeCornerLatLng,this.getAngle(),this._map);this._layer.setLatLngs(e),this._adjustAllMarkers(),this._layer.redraw()},_adjustAllMarkers(){let t=this._layer.getLatLngs()[0];t&&t.length!==4&&t.length>0?(t.forEach((e,i)=>{this._cornerMarkers[i].setLatLng(e)}),this._cornerMarkers.slice(t.length).forEach(e=>{e.setLatLng(t[0])})):!t||!t.length?console.error("The layer has no LatLngs"):this._cornerMarkers.forEach(e=>{e.setLatLng(t[e._index])})},_findCorners(){this._angle===void 0&&this.setInitAngle(Ae(this._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let t=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(t[0],t[2],this.getAngle(),this._map||this)}}),$.CircleMarker=$.extend({_shape:"CircleMarker",initialize(t){this._layer=t,this._enabled=!1,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._updateHiddenPolyCircle()},enable(t={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,t),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._extendingEnable(),this._updateHiddenPolyCircle(),this._fireEnable()},_extendingEnable(){this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:drag",this._onMarkerDrag,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this)},disable(){this.dragging()||(this._map||(this._map=this._layer._map),this._map&&this.enabled()&&(this.layerDragEnabled()&&this.disableLayerDrag(),this.options[this._editableOption]?(this._helperLayers&&this._helperLayers.clearLayers(),this._map.off("move",this._syncMarkers,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this._extendingDisable(),this._layer.off("remove",this.disable,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1))},_extendingDisable(){this._layer.off("contextmenu",this._removeMarker,this)},enabled(){return this._enabled},toggleEdit(t){this.enabled()?this.disable():this.enable(t)},applyOptions(){this.options[this._editableOption]?(this._initMarkers(),this._map.on("move",this._syncMarkers,this),this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this),this._centerMarker.on("move",this._moveCircle,this)):this._disableSnapping()):(this.options.draggable&&this.enableLayerDrag(),this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this._initSnappableMarkersDrag():this._disableSnappingDrag()),this._extendingApplyOptions()},_extendingApplyOptions(){this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers(){let t=this._map;this._helperLayers&&this._helperLayers.clearLayers(),this._helperLayers=new L.FeatureGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(t);let e=this._layer.getLatLng(),i=this._layer._radius,r=this._getLatLngOnCircle(e,i);this._centerMarker=this._createCenterMarker(e),this._outerMarker=this._createOuterMarker(r),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle(t,e){let i=this._map.project(t),r=L.point(i.x+e,i.y);return this._map.unproject(r)},_createHintLine(t,e){let i=t.getLatLng(),r=e.getLatLng();this._hintline=L.polyline([i,r],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker(t){let e=this._createMarker(t);return this.options.draggable?L.DomUtil.addClass(e._icon,"leaflet-pm-draggable"):e.dragging.disable(),e},_createOuterMarker(t){let e=this._createMarker(t);return e.on("drag",this._resizeCircle,this),e},_createMarker(t){let e=new L.Marker(t,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(e,"vertexPane"),e._origLatLng=t,e._pmTempLayer=!0,e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),e.on("click",this._onVertexClick,this),this._helperLayers.addLayer(e),e},_moveCircle(t){if(t.target._cancelDragEventChain)return;let e=this._centerMarker.getLatLng();this._layer.setLatLng(e);let i=this._layer._radius,r=this._getLatLngOnCircle(e,i);this._outerMarker._latlng=r,this._outerMarker.update(),this._syncHintLine(),this._updateHiddenPolyCircle(),this._fireCenterPlaced("Edit"),this._fireChange(this._layer.getLatLng(),"Edit")},_syncMarkers(){let t=this._layer.getLatLng(),e=this._layer._radius,i=this._getLatLngOnCircle(t,e);this._outerMarker.setLatLng(i),this._centerMarker.setLatLng(t),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius(){let t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),i=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i),this._updateHiddenPolyCircle(),this._fireChange(this._layer.getLatLng(),"Edit")},_syncHintLine(){let t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng();this._hintline.setLatLngs([t,e])},_removeMarker(){this.options[this._editableOption]&&this.disable(),this._layer.remove(),this._fireRemove(this._layer),this._fireRemove(this._map,this._layer)},_onDragStart(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart(t){this._vertexValidation("move",t)&&this._fireMarkerDragStart(t)},_onMarkerDrag(t){let e=t.target;e instanceof L.Marker&&!this._vertexValidationDrag(e)||this._fireMarkerDrag(t)},_onMarkerDragEnd(t){this._extedingMarkerDragEnd();let e=t.target;this._vertexValidationDragEnd(e)&&(this.options[this._editableOption]&&(this._fireEdit(),this._layerEdited=!0),this._fireMarkerDragEnd(t))},_extedingMarkerDragEnd(){this._map.pm.Draw.CircleMarker._layerIsDragging=!1},_initSnappableMarkersDrag(){let t=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,t.off("pm:drag",this._handleSnapping,this),t.on("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.on("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this),t.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag(){let t=this._layer;t.off("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle(){let t=this._layer._map||this._map;if(t){let e=L.PM.Utils.pxRadiusToMeterRadius(this._layer.getRadius(),t,this._layer.getLatLng()),i=L.circle(this._layer.getLatLng(),this._layer.options);i.setRadius(e);let r=t&&t.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(i,200,!r).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(i,200,!r),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker(){let t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),i=this._distanceCalculation(t,e);return this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?e=re(this._map,t,e,this._getMinDistanceInMeter(t)):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(e=re(this._map,t,e,this._getMaxDistanceInMeter(t))),e},_handleOuterMarkerSnapping(){if(this._outerMarker._snapped){let t=this._centerMarker.getLatLng(),e=this._outerMarker.getLatLng(),i=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._outerMarker.setLatLng(this._outerMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_distanceCalculation(t,e){return this._map.project(t).distanceTo(this._map.project(e))},_getMinDistanceInMeter(t){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,t)},_getMaxDistanceInMeter(t){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,t)},_onVertexClick(t){t.target._dragging||this._fireVertexClick(t,void 0)}}),$.Circle=$.CircleMarker.extend({_shape:"Circle",initialize(t){this._layer=t,this._enabled=!1,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizableCircle",this._updateHiddenPolyCircle()},enable(t){L.PM.Edit.CircleMarker.prototype.enable.call(this,t||{})},_extendingEnable(){},_extendingDisable(){this._layer.off("remove",this.disable,this);let t=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(t,"leaflet-pm-draggable")},_extendingApplyOptions(){},_syncMarkers(){},_removeMarker(){},_onDragStart(){},_extedingMarkerDragEnd(){},_updateHiddenPolyCircle(){let t=this._map&&this._map.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200,!t).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200,!t),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_distanceCalculation(t,e){return this._map.distance(t,e)},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_onVertexClick(t){t.target._dragging||this._fireVertexClick(t,void 0)}}),$.ImageOverlay=$.extend({_shape:"ImageOverlay",initialize(t){this._layer=t,this._enabled=!1},toggleEdit(t){this.enabled()?this.disable():this.enable(t)},enabled(){return this._enabled},enable(t={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,t),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()||this.disable(),this.enableLayerDrag(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._otherSnapLayers=this._findCorners(),this._fireEnable()}},disable(){this._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this.enabled()||(this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()),this._enabled=!1)},_findCorners(){let t=this._layer.getBounds(),e=t.getNorthWest(),i=t.getNorthEast(),r=t.getSouthEast(),n=t.getSouthWest();return[e,i,r,n]}}),$.Text=$.extend({_shape:"Text",initialize(t){this._layer=t,this._enabled=!1},enable(t){if(L.Util.setOptions(this,t),!!this.textArea){if(!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._safeToCacheDragState=!0,this._focusChange(),this.textArea.readOnly=!1,this.textArea.classList.remove("pm-disabled"),this._layer.on("remove",this.disable,this),L.DomEvent.on(this.textArea,"input",this._autoResize,this),L.DomEvent.on(this.textArea,"focus",this._focusChange,this),L.DomEvent.on(this.textArea,"blur",this._focusChange,this),this._layer.on("dblclick",L.DomEvent.stop),L.DomEvent.off(this.textArea,"mousedown",this._preventTextSelection),this._enabled=!0,this._fireEnable()}},disable(){if(!this.enabled())return;this._layer.off("remove",this.disable,this),L.DomEvent.off(this.textArea,"input",this._autoResize,this),L.DomEvent.off(this.textArea,"focus",this._focusChange,this),L.DomEvent.off(this.textArea,"blur",this._focusChange,this),L.DomEvent.off(document,"click",this._documentClick,this),this._focusChange(),this.textArea.readOnly=!0,this.textArea.classList.add("pm-disabled");let t=document.activeElement;this.textArea.focus(),this.textArea.selectionStart=0,this.textArea.selectionEnd=0,L.DomEvent.on(this.textArea,"mousedown",this._preventTextSelection),t.focus(),this._disableOnBlurActive=!1,this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1},enabled(){return this._enabled},toggleEdit(t){this.enabled()?this.disable():this.enable(t)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initSnappableMarkers(){let t=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,t.off("pm:drag",this._handleSnapping,this),t.on("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.on("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this),t.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let t=this._layer;t.off("pm:drag",this._handleSnapping,this),t.off("pm:dragend",this._cleanupSnapping,this),t.off("pm:dragstart",this._unsnap,this)},_autoResize(){this.textArea.style.height="1px",this.textArea.style.width="1px";let t=this.textArea.scrollHeight>21?this.textArea.scrollHeight:21,e=this.textArea.scrollWidth>16?this.textArea.scrollWidth:16;this.textArea.style.height=`${t}px`,this.textArea.style.width=`${e}px`,this._layer.options.text=this.getText(),this._fireTextChange(this.getText())},_disableOnBlur(){this._disableOnBlurActive=!0,setTimeout(()=>{this.enabled()&&L.DomEvent.on(document,"click",this._documentClick,this)},100)},_documentClick(t){t.target!==this.textArea&&(this.disable(),!this.getText()&&this.options.removeIfEmpty&&this.remove())},_focusChange(t={}){let e=this._hasFocus;this._hasFocus=t.type==="focus",!e!=!this._hasFocus&&(this._hasFocus?(this._applyFocus(),this._focusText=this.getText(),this._fireTextFocus()):(this._removeFocus(),this._fireTextBlur(),this._focusText!==this.getText()&&(this._fireEdit(),this._layerEdited=!0)))},_applyFocus(){this.textArea.classList.add("pm-hasfocus"),this._map.dragging&&(this._safeToCacheDragState&&(this._originalMapDragState=this._map.dragging._enabled,this._safeToCacheDragState=!1),this._map.dragging.disable())},_removeFocus(){this._map.dragging&&(this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0),this.textArea.classList.remove("pm-hasfocus")},focus(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.focus()},blur(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.blur(),this._disableOnBlurActive&&this.disable()},hasFocus(){return this._hasFocus},getElement(){return this.textArea},setText(t){this.textArea.value=t,this._autoResize()},getText(){return this.textArea.value},_initTextMarker(){if(this.textArea=L.PM.Draw.Text.prototype._createTextArea.call(this),this.options.className){let e=this.options.className.split(" ");this.textArea.classList.add(...e)}let t=L.PM.Draw.Text.prototype._createTextIcon.call(this,this.textArea);this._layer.setIcon(t),this._layer.once("add",this._createTextMarker,this)},_createTextMarker(t=!1){this._layer.off("add",this._createTextMarker,this),this._layer.getElement().tabIndex=-1,this.textArea.wrap="off",this.textArea.style.overflow="hidden",this.textArea.style.height=L.DomUtil.getStyle(this.textArea,"font-size"),this.textArea.style.width="1px",this._layer.options.text&&this.setText(this._layer.options.text),this._autoResize(),t===!0&&(this.enable(),this.focus(),this._disableOnBlur())},_preventTextSelection(t){t.preventDefault()}});var He=function(t,e,i,r,n,a){this._matrix=[t,e,i,r,n,a]};He.init=()=>new L.PM.Matrix(1,0,0,1,0,0),He.prototype={transform(t){return this._transform(t.clone())},_transform(t){let e=this._matrix,{x:i,y:r}=t;return t.x=e[0]*i+e[1]*r+e[4],t.y=e[2]*i+e[3]*r+e[5],t},untransform(t){let e=this._matrix;return new L.Point((t.x/e[0]-e[4])/e[0],(t.y/e[2]-e[5])/e[2])},clone(){let t=this._matrix;return new L.PM.Matrix(t[0],t[1],t[2],t[3],t[4],t[5])},translate(t){if(t===void 0)return new L.Point(this._matrix[4],this._matrix[5]);let e,i;return typeof t=="number"?(e=t,i=t):(e=t.x,i=t.y),this._add(1,0,0,1,e,i)},scale(t,e){if(t===void 0)return new L.Point(this._matrix[0],this._matrix[3]);let i,r;return e=e||L.point(0,0),typeof t=="number"?(i=t,r=t):(i=t.x,r=t.y),this._add(i,0,0,r,e.x,e.y)._add(1,0,0,1,-e.x,-e.y)},rotate(t,e){let i=Math.cos(t),r=Math.sin(t);return e=e||new L.Point(0,0),this._add(i,r,-r,i,e.x,e.y)._add(1,0,0,1,-e.x,-e.y)},flip(){return this._matrix[1]*=-1,this._matrix[2]*=-1,this},_add(t,e,i,r,n,a){let s=[[],[],[]],o=this._matrix,u=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]],h=[[t,i,n],[e,r,a],[0,0,1]],y;t&&t instanceof L.PM.Matrix&&(o=t._matrix,h=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]]);for(let _=0;_<3;_+=1)for(let w=0;w<3;w+=1){y=0;for(let A=0;A<3;A+=1)y+=u[_][A]*h[A][w];s[_][w]=y}return this._matrix=[s[0][0],s[1][0],s[0][1],s[1][1],s[0][2],s[1][2]],this}};var Ss=He,Fs={calcMiddleLatLng(t,e,i){let r=t.project(e),n=t.project(i);return t.unproject(r._add(n)._divideBy(2))},findLayers(t){let e=[];return t.eachLayer(i=>{(i instanceof L.Polyline||i instanceof L.Marker||i instanceof L.Circle||i instanceof L.CircleMarker||i instanceof L.ImageOverlay)&&e.push(i)}),e=e.filter(i=>!!i.pm),e=e.filter(i=>!i._pmTempLayer),e=e.filter(i=>!L.PM.optIn&&!i.options.pmIgnore||L.PM.optIn&&i.options.pmIgnore===!1),e},circleToPolygon(t,e=60,i=!0){let r=t.getLatLng(),n=t.getRadius(),a=_i(r,n,e,0,i),s=[];for(let o=0;o<a.length;o+=1){let u=[a[o].lat,a[o].lng];s.push(u)}return L.polygon(s,t.options)},disablePopup(t){t.getPopup()&&(t._tempPopupCopy=t.getPopup(),t.unbindPopup())},enablePopup(t){t._tempPopupCopy&&(t.bindPopup(t._tempPopupCopy),delete t._tempPopupCopy)},_fireEvent(t,e,i,r=!1){t.fire(e,i,r);let{groups:n}=this.getAllParentGroups(t);n.forEach(a=>{a.fire(e,i,r)})},getAllParentGroups(t){let e=[],i=[],r=n=>{for(let a in n._eventParents)if(e.indexOf(a)===-1){e.push(a);let s=n._eventParents[a];i.push(s),r(s)}};return!t._pmLastGroupFetch||!t._pmLastGroupFetch.time||new Date().getTime()-t._pmLastGroupFetch.time>1e3?(r(t),t._pmLastGroupFetch={time:new Date().getTime(),groups:i,groupIds:e},{groupIds:e,groups:i}):{groups:t._pmLastGroupFetch.groups,groupIds:t._pmLastGroupFetch.groupIds}},createGeodesicPolygon:_i,getTranslation:U,findDeepCoordIndex(t,e,i=!0){let r,n=s=>(o,u)=>{let h=s.concat(u);if(i){if(o.lat&&o.lat===e.lat&&o.lng===e.lng)return r=h,!0}else if(o.lat&&L.latLng(o).equals(e))return r=h,!0;return Array.isArray(o)&&o.some(n(h))};t.some(n([]));let a={};return r&&(a={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),a},findDeepMarkerIndex(t,e){let i,r=a=>(s,o)=>{let u=a.concat(o);return s._leaflet_id===e._leaflet_id?(i=u,!0):Array.isArray(s)&&s.some(r(u))};t.some(r([]));let n={};return i&&(n={indexPath:i,index:i[i.length-1],parentPath:i.slice(0,i.length-1)}),n},_getIndexFromSegment(t,e){if(e&&e.length===2){let i=this.findDeepCoordIndex(t,e[0]),r=this.findDeepCoordIndex(t,e[1]),n=Math.max(i.index,r.index);return(i.index===0||r.index===0)&&n!==1&&(n+=1),{indexA:i,indexB:r,newIndex:n,indexPath:i.indexPath,parentPath:i.parentPath}}return null},_getRotatedRectangle(t,e,i,r){let n=Tt(r,t),a=Tt(r,e),s=i*Math.PI/180,o=Math.cos(s),u=Math.sin(s),h=(a.x-n.x)*o+(a.y-n.y)*u,y=(a.y-n.y)*o-(a.x-n.x)*u,_=h*o+n.x,w=h*u+n.y,A=-y*u+n.x,T=y*o+n.y,R=_e(r,n),I=_e(r,{x:_,y:w}),z=_e(r,a),m=_e(r,{x:A,y:T});return[R,I,z,m]},pxRadiusToMeterRadius(t,e,i){let r=e.project(i),n=L.point(r.x+t,r.y);return e.distance(e.unproject(n),i)}},Ts=Fs;L.PM=L.PM||{version:yn.version,Map:ua,Toolbar:ca,Draw:Z,Edit:$,Utils:Ts,Matrix:Ss,activeLang:"en",optIn:!1,initialize(t){this.addInitHooks(t)},setOptIn(t){this.optIn=!!t},addInitHooks(){function t(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this)),this.pm&&this.pm.setGlobalOptions({})}L.Map.addInitHook(t);function e(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))}L.LayerGroup.addInitHook(e);function i(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this))}L.Marker.addInitHook(i);function r(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))}L.CircleMarker.addInitHook(r);function n(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))}L.Polyline.addInitHook(n);function a(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))}L.Polygon.addInitHook(a);function s(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))}L.Rectangle.addInitHook(s);function o(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))}L.Circle.addInitHook(o);function u(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}L.ImageOverlay.addInitHook(u)},reInitLayer(t){t instanceof L.LayerGroup&&t.eachLayer(e=>{this.reInitLayer(e)}),t.pm||L.PM.optIn&&t.options.pmIgnore!==!1||t.options.pmIgnore||(t instanceof L.Map?t.pm=new L.PM.Map(t):t instanceof L.Marker?t.options.textMarker?(t.pm=new L.PM.Edit.Text(t),t.pm._initTextMarker(),t.pm._createTextMarker(!1)):t.pm=new L.PM.Edit.Marker(t):t instanceof L.Circle?t.pm=new L.PM.Edit.Circle(t):t instanceof L.CircleMarker?t.pm=new L.PM.Edit.CircleMarker(t):t instanceof L.Rectangle?t.pm=new L.PM.Edit.Rectangle(t):t instanceof L.Polygon?t.pm=new L.PM.Edit.Polygon(t):t instanceof L.Polyline?t.pm=new L.PM.Edit.Line(t):t instanceof L.LayerGroup?t.pm=new L.PM.Edit.LayerGroup(t):t instanceof L.ImageOverlay&&(t.pm=new L.PM.Edit.ImageOverlay(t)))}},L.version==="1.7.1"&&L.Canvas.include({_onClick(t){let e=this._map.mouseEventToLayerPoint(t),i,r;for(let n=this._drawFirst;n;n=n.next)i=n.layer,i.options.interactive&&i._containsPoint(e)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(i))&&(r=i);r&&(L.DomEvent.fakeStop(t),this._fireEvent([r],t))}}),L.PM.initialize()})();let rt,be,qi=!1;function Rs(){if(!qi)try{const W=new URLSearchParams(window.location.search),ft=parseFloat(W.get("lat"))||-14.235004,Rt=parseFloat(W.get("lng"))||-51.92528,Lt=parseInt(W.get("zoom"))||4,vt=W.get("geojson")||JSON.stringify({type:"FeatureCollection",features:[]});rt=Le.map("map",{center:[ft,Rt],zoom:Lt,layers:[Le.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"})]}),be=new Le.FeatureGroup().addTo(rt),rt.pm.addControls({position:"topleft",drawCircle:!1});const Ot=JSON.parse(vt);Le.geoJSON(Ot).addTo(be),rt.on("pm:create",ve),rt.on("pm:remove",ve),rt.on("pm:edit",ve),rt.on("moveend",ve),console.log("Mapa inicializado com sucesso"),qi=!0}catch(W){console.error("Erro ao inicializar o mapa:",W)}}function ve(){if(!(!rt||!be))try{const W=rt.getCenter(),ft={latitude:W.lat,longitude:W.lng,zoom:rt.getZoom(),geojson:JSON.stringify(be.toGeoJSON())};window.opener&&typeof window.opener.postMessage=="function"?window.opener.postMessage(ft,"*"):console.log("Dados atualizados:",ft)}catch(W){console.error("Erro ao atualizar dados:",W)}}function Os(){if(!rt)return;const ft=rt.pm.getGeomanDrawLayers(!0).toGeoJSON(),Rt=JSON.stringify(ft,null,2),Lt=document.createElement("div");Lt.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[2000]",Lt.innerHTML=`
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full">
          <h2 class="text-2xl font-bold mb-4">GeoJSON Exportado</h2>
          <textarea id="geoJsonOutput" class="w-full h-64 p-2 border rounded mb-4" readonly></textarea>
          <div class="flex justify-between">
            <button id="copyButton" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">Copiar GeoJSON</button>
            <button id="closeButton" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition-colors">Fechar</button>
          </div>
        </div>
      `,document.body.appendChild(Lt);const vt=document.getElementById("geoJsonOutput");vt.value=Rt,vt.scrollTop=0,document.getElementById("copyButton").addEventListener("click",()=>{vt.select(),navigator.clipboard.writeText(vt.value).then(()=>{alert("GeoJSON copiado para a área de transferência!")}).catch(Ot=>{console.error("Erro ao copiar texto: ",Ot)})}),document.getElementById("closeButton").addEventListener("click",()=>{document.body.removeChild(Lt)})}function Is(W){console.error("Erro capturado:",W)}window.addEventListener("error",Is);document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{Rs(),rt&&rt.invalidateSize()},100)});window.exportGeoJSON=Os;
